import {clpp} from "./cl.core.js";let g={};const _ = clpp._;var f=function(window){'use strict';var Cz,Dz,Ez,Fz,Gz,Hz,Iz,Jz,Kz,Lz,Mz,Nz,Oz,Pz,Qz,Rz,Sz,Tz,Uz,Vz,Wz,Xz,Yz,Zz,$z,aA,bA,cA,dA,gA,hA,iA,jA,kA,lA,mA,nA,oA,pA,qA,sA,tA,uA,vA,xA,yA,zA,CA,DA,FA,GA,HA,IA,JA,KA,LA,OA,PA,UA,VA,WA,XA,YA,ZA,$A,bB,eB,fB,jB,mB,nB,oB,pB,rB,sB,tB,uB,vB,wB,xB,yB,zB,AB,BB,CB,EB,KB,NB,SB,UB,JB,VB,WB,XB,YB,ZB,$B,fC,gC,hC,iC,jC,lC,mC,nC,oC,kC,rC,uC,tC,vC,sC,wC,xC,yC,zC,DC,EC,FC,GC,HC,JC,KC,LC,MC,OC,PC,RC,QC,NC,XC,SC,TC,UC,VC,WC,YC,ZC,$C,cD,aD,bD,dD,eD,fD,gD,iD,jD,kD,lD,mD,oD,pD,rD,qD,sD,tD,uD,wD,vD,xD,FD,
ED,GD,HD,ID,JD,LD,MD,PD,ND,OD,QD,RD,SD,TD,VD,WD,XD,YD,$D,aE,cE,dE,fE,eE,ZD,bE,gE,hE,kE,iE,jE,mE,lE,oE,pE,qE,rE,sE,uE,tE,zE,AE,CE,DE,wE,xE,yE,EE,FE,RE,vE,SE,GE,TE,UE,VE,WE,PE,XE,YE,HE,IE,ZE,bF,eF,fF,gF,cF,dF,$E,aF,hF,iF,jF,kF,lF,mF,nF,oF,pF,qF,rF,sF,yD,zD,AD,BD,CD,DD,EF,GF,HF,MF,NF,KF,IF,PF,QF,UF,XF,aG,nG,pG,rG,sG,tG,uG,oG,JF,LF,BG,qG,RF,TF,VF,WF,wG,jG,$F,bG,cG,CF,eG,fG,iG,kG,lG,mG,ZF,uF,BF,IG,FG,UG,zF,AF,WG,vF,wF,xF,yF,CG,YG,GG,VG,EG,XG,ZG,KG,LG,JG,$G,DG,aH,bH,cH,dH,eH,fH,QA,iH,SF,QG,eC,pC,qC,lH,
mH,nH,MG,NG,PG,pH,xG;Cz=" buffer";Dz=" buffer. Range:";Ez=" is being or has been set up";Fz=" range:";Gz=" with element state: ";Hz="\x3c/DATA\x3e\x3c/WRMHEADER\x3e";Iz="Aborting operations for ";Jz="Appended audio segment ";Kz="Appended video segment ";Lz="Appending data to ";Mz="Buffer:";Nz="Choosing new streams after key status change";Oz="Done Aborting operations for ";Pz="Done Appending data to ";Qz="Done Flushing buffer for ";Rz="Done Removing data from ";Sz="Done Setting append window for ";
Tz="Done Setting timestamp offset for ";Uz="Failed to abort operations for ";Vz="Failed to append data for ";Wz="Failed to flush buffer for ";Xz="Failed to remove data from ";Yz="Failed to set append window for ";Zz="Failed to set timestamp offset for ";$z="Flushing buffer for ";aA="IterateSegmentReference";bA="Jumping forward";cA="MediaSource threw QuotaExceededError:";dA="No more scheduled operations for ";_.eA="No stream with id";_.fA="Player is in ERROR state and can not switch to ";gA="PrestoPlay TextTrack";
hA="QuotaExceededError";iA="Removing audio from variant - audio not compatible with platform";jA="Removing data from ";kA="Reset transmuxers.";lA="Setting append window for ";mA="Setting playback rate to\x3d";nA="Setting timestamp offset for ";oA="Skip buffer flush for ";pA="Starting next operation for ";qA="Update-End received for ";_.rA="Updating manifest...";sA="bufferBehind\x3d";tA="bufferedBehind\x3d";uA="calling onCanSwitch()...";vA="cannot find segment";_.wA="caption";xA="clpp.mse.Player";
yA="currentPeriod.startTime\x3d";zA="failed to get buffered range for ";_.AA="getSegmentNextReference";_.BA="iterateSegmentReference";CA="key-restriction";DA="manifest.start";_.EA="onChooseStreams_";FA="presentationTime:";GA="presentationTime\x3d";HA="reference.endTime\x3d";IA="reference.position\x3d";JA="reference.startTime\x3d";KA="sourceopen";LA="startstreaming";_.MA="subtitle";_.NA="subtitles";OA="switch: Stream ";
PA=function(a){const b=a.a+a.f.byteOffset;let c=void 0;for(;_.vl(a);)if(0===_.xl(a)){c=a.a+a.f.byteOffset-1;break}a=a.f.buffer.slice(b,c);return _.oi(a)};_.RA=function(a){const b=new Uint8Array(QA),c=4+b.byteLength+a.j.byteLength+4+a.f.byteLength,d=new _.Ol(c,!1);_.O(d,c);_.ul(d,b);_.ul(d,a.j);_.O(d,a.f.byteLength);_.ul(d,a.f);return _.J(d.buffer)};
_.SA=function(a,b,c,d){var e=_.Fi(b);if(8!==e.byteLength)e="";else{var f=_.Am(e);e=_.Ci(f);b:switch(f=f.byteLength,_.ih("Trying to create PlayReady header in version",a),a){case "4.0.0.0":e=[`<WRMHEADER xmlns="${"http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader"}" version="${a}">`,"\x3cDATA\x3e\x3cPROTECTINFO\x3e",`<KEYLEN>${f}</KEYLEN>`,"\x3cALGID\x3eAESCTR\x3c/ALGID\x3e\x3c/PROTECTINFO\x3e",`<KID>${e}</KID>`,c?`<CHECKSUM>${c}</CHECKSUM>`:"",d?`<LA_URL>${d}</LA_URL>`:"",Hz].join("");break b;
case "4.1.0.0":e=[`<WRMHEADER xmlns="${"http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader"}" version="${a}">`,'\x3cDATA\x3e\x3cPROTECTINFO\x3e\x3cKID ALGID\x3d"AESCTR" ',c?`CHECKSUM="${c}" `:"",`VALUE="${e}"`,"\x3e\x3c/KID\x3e\x3c/PROTECTINFO\x3e",d?`<LA_URL>${d}</LA_URL>`:"",Hz].join("");break b;case "4.2.0.0":case "4.3.0.0":e=[`<WRMHEADER xmlns="${"http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader"}" version="${a}">`,'\x3cDATA\x3e\x3cPROTECTINFO\x3e\x3cKIDS\x3e\x3cKID ALGID\x3d"AESCTR" ',
c?`CHECKSUM="${c}" `:"",`VALUE="${e}"`,"\x3e\x3c/KID\x3e\x3c/KIDS\x3e\x3c/PROTECTINFO\x3e",d?`<LA_URL>${d}</LA_URL>`:"",Hz].join("");break b;default:_.C("Cannot create PlayReady header in version",a),e=""}}if(!e)return null;_.ih("New payload",e);e=_.J(_.ti(e,!0));return new _.Dm(_.Em,b,d||null,e,a,c)};_.TA=function(a,b){return b===a.version?a:_.SA(b,a.a,a.l||void 0,a.h||void 0)};
UA=function(a,b){a:{if(b)for(const c of a.f.keys()){const d=a.f.get(c);for(let e=0;e<d.ab.length;e++)if(d.ab[e]===b){a=d;break a}}a=null}return a?a.Ka:null};VA=function(a,b){if(_.Wj("Edge/"))return!0;b=b.toLowerCase();if(_.Xj()&&b.includes('codecs\x3d"ac-3"')){const c=b.replace("ac-3",_.Sd);return a.H.has(b)||a.H.has(c)}return a.H.has(b)};WA=function(a,b){a=a.l.get(b);return!(!a||a!==_.Oe&&a!==_.ee)};
XA=function(a,b){var c=b.audio,d=b.video;if(c&&c.encrypted&&(c=_.Om(c),!VA(a,c))||d&&d.encrypted&&(d=_.Om(d),!VA(a,d)))return!1;const e=a.keySystem();return 0===b.drmInfos.length||b.drmInfos.some(f=>f.keySystem===e)};YA=function(a,b){return a.a.find(c=>c.getId()===b)||null};ZA=function(a,b){if(a.a.length)if(0>b)a.f=0;else{for(var c=0,d=a.a[c]||null;d&&b>d.rb()+d.getDuration();)c+=1,d=a.a[c]||null;a.f=d?c:a.a.length-1}else a.f=-1};$A=function(a,b){a.a=b.enabled};_.aB=function(a,b){return a.concat(b)};
bB=function(){};_.cB=function(a,b){if(0===b.length)return a;const c=b.map(d=>new _.Mh(d));return a.map(d=>new _.Mh(d)).map(d=>c.map(d.resolve.bind(d))).reduce(_.aB,[]).map(d=>d.toString())};_.dB=function(a,b,c){return{keySystem:a,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:b||[],keyIds:[],periodId:c?c:null}};
eB=function(a,b){a=_.bi(a);b=_.bi(b);a=a.split("-");b=b.split("-");return a[0]===b[0]&&1===a.length&&2===b.length};fB=function(a){return a.language?_.bi(a.language):a.audio&&a.audio.language?_.bi(a.audio.language):a.video&&a.video.language?_.bi(a.video.language):_.ag};
_.gB=function(a,b){a=_.bi(a);const c=new Set;for(var d of b)c.add(_.bi(d));for(const e of c)if(e===a)return e;for(const e of c)if(eB(e,a))return e;for(const e of c)if(d=e,b=a,d=_.bi(d),b=_.bi(b),d=d.split("-"),b=b.split("-"),b=2===d.length&&2===b.length&&d[0]===b[0])return e;for(const e of c)if(eB(a,e))return e;return null};
_.hB=function(a){if(typeof a!==_.Qf)return null;var b=a.trim().match(/^(\d+)x(\d+)$/);if(!b)return null;a=parseInt(b[1],10);b=parseInt(b[2],10);return 0>=a||0>=b?null:{Uc:a,ld:b,xh:a*b}};_.iB=function*(a){let b=-1,c=void 0,d=void 0;for(const e of a)0<=b&&(yield{rf:b,item:d,gh:c,next:e}),b++,c=d,d=e;-1!==b&&(yield{rf:b,gh:c,item:d,next:void 0})};jB=function(a,b){for(const c in b)if(b[c]===a)return c;return""};
_.kB=function(a,b){if(!a.length)return b;if(!b.length)return a;const c=[];for(let e=0;e<a.length;e++)for(var d=0;d<b.length;d++)if(a[e].keySystem===b[d].keySystem&&a[e].periodId===b[d].periodId){const f=a[e];d=b[d];let g=[];g=g.concat(f.initData||[]);g=g.concat(d.initData||[]);const h=[...f.keyIds||[]];d.keyIds&&d.keyIds.length&&d.keyIds.forEach(k=>{h.includes(k)||h.push(k)});c.push({keySystem:f.keySystem,licenseServerUri:f.licenseServerUri||d.licenseServerUri,distinctiveIdentifierRequired:f.distinctiveIdentifierRequired||
d.distinctiveIdentifierRequired,persistentStateRequired:f.persistentStateRequired||d.persistentStateRequired,videoRobustness:f.videoRobustness||d.videoRobustness,audioRobustness:f.audioRobustness||d.audioRobustness,serverCertificate:f.serverCertificate||d.serverCertificate,initData:g,keyIds:h,periodId:f.periodId});break}return c};_.lB=function(a,b){return a.length&&b.length?0<_.kB(a,b).length:!0};mB=function(a,b){let c=0;for(const d of a)c+=b(d)?1:0;return c};
nB=function(a,b){var c=_.Mj(b,a);if(!c)return!1;c=c();a=c.isMuxed(a,b);c.destroy();return a};oB=function(a){const b=[a.mimeType];for(const c of _.at){const [d,e]=c;{const f=a[d];null!=f&&b.push(e.trim()+'\x3d"'+String(f).trim()+'"')}}return b.join(";").replace(/\s/g,"")};pB=function(a){return a.split(",").map(b=>b.trim()).filter(b=>0<b.length)};_.qB=function(a){const b=[];for(const c of a.split(/\s*,\s*/)){{a=c.split(".");const d=a[0];a.shift();a=[d,a.join(".")]}b.push(a[0])}return b.sort().join(",")};
rB=function(a,b="total"){b=new _.et(void 0,b);for(const c of a)b.a.push(c);b.length=a.length;return b};sB=function(){return!!window.SourceBuffer&&!!SourceBuffer.prototype&&!!SourceBuffer.prototype.changeType};tB=function(a,b){return a.start-b.start};uB=function(a){return a.V.map(b=>({start:b.start,end:b.end,width:b.width,height:b.height,bandwidth:b.bandwidth,rendition:b.rendition}))};vB=function(a){a.player&&(a.player.off(_.yf,a.a),a.f&&a.player.off(_.Xf,a.a));a.player=null};
wB=function(a){a.player&&a.player.trigger(new _.E(_.Lc))};xB=function(a){a.player&&a.player.trigger(new _.E(_.Lc))};yB=function(a){if(a.player){var b=!1,c={};for(let d=0;d<a.V.length;d++){const e=a.V[d],f=e.width+"x"+e.height,g=c[f];if(g&&g!==e.bandwidth){b=!0;break}c[f]=e.bandwidth}b&&!a.f?(a.log.debug("Tracking timeupdates"),a.player.on(_.Xf,a.a,a),a.f=!0):!b&&a.f&&(a.log.debug("Stop tracking timeupdates"),a.player.off(_.Xf,a.a),a.f=!1)}};
zB=function(a,b,c){a.V=a.V.filter(d=>{if(d.end<=b||d.start>=c)return!1;d.start=Math.max(d.start,b);d.end=Math.min(d.end,c);return!0});a.player&&a.player.trigger(new _.E(_.ng))};AB=function(a,b){let c=null;for(const d of a)b>=d.startTime&&(c=d);return c};BB=function(a){const b=new Set;a.variants.forEach(c=>{c.audio&&b.add(c.audio);c.video&&(b.add(c.video),c.video.trickModeVideo&&b.add(c.video.trickModeVideo))});a.textStreams.forEach(c=>b.add(c));a.thumbStreams.forEach(c=>b.add(c));return b};
CB=function(a,b){for(let c=0;c<a.length;c++)if(BB(a[c]).has(b))return c;return-1};EB=function(a,b){Array.from(BB(a)).forEach(c=>{c.segmentIndex&&_.DB(c.segmentIndex,b)})};_.FB=function(a,b,c){const d=Math.pow(a.h,b);c=c*(1-d)+d*a.a;isNaN(c)||(a.a=c,a.f+=b)};_.GB=function(a){return a.a/(1-Math.pow(a.h,a.f))};
_.HB=function(a,b,c,d,e,f,g,h){a=_.Si(a);a.timeout=d.timeout;a.maxAttempts=d.maxAttempts;a.baseDelay=d.baseDelay;a.fuzzFactor=d.fuzzFactor;a.backoffFactor=d.backoffFactor;if(0!==b||null!=c)a.headers.Range=c?"bytes\x3d"+b+"-"+c:"bytes\x3d"+b+"-";e&&(a.startTime=e);f&&(a.endTime=f);g&&(a.contentType=g);h&&(a.timescale=h);return a};_.IB=function(a,b,c){a.h=b;a.a=c};KB=function(a){return 2===a.j.version?a.a.rb():JB(a,0)};_.LB=function(a,b){a.K={offsetDateTime:b-KB(a),seekRangeStartDateTime:b}};
_.MB=function(a,b){a.l=b;a.C=b;a.a.f=b};NB=function(a){return 2===a.j.version?a.a.f?a.a.a:null:a.l?a.f:a.C?a.o:null};_.OB=function(a,b){a.w=null==a.w?b:Math.min(a.w,b)};_.PB=function(a,b){a.o=Math.max(a.o||0,b)};_.QB=function(a,b,c){if(0!==b.length){var d=b[b.length-1].endTime+c;_.OB(a,b[0].startTime+c);a.h=b.reduce((e,f)=>Math.max(e,f.endTime-f.startTime),a.h);_.PB(a,d);null!=a.F&&a.L&&(a.F=(Date.now()+a.H)/1E3-(a.o||0)-a.h);a.g.debug("notifySegments: maxSegmentDuration\x3d"+a.h)}};
_.RB=function(a,b){a.h=Math.max(a.h,b);a.g.debug("notifyNewSegmentDuration: maxSegmentDuration\x3d"+a.h)};SB=function(a){if(2===a.j.version)a=a.a.a;else if(a.l)a=a.f;else if(a.C)a=a.o||0;else{if("startover"===a.B)var b=a.I||0;else b=(Date.now()+a.H)/1E3,b=a.N?Math.max(0,b-(a.h-a.G)-a.F):Math.max(0,b-a.h-a.F);a=Math.min(b,a.f)}return a};_.TB=function(a){return 2===a.j.version?a.a.rb():Infinity===a.A?0:Math.max(0,SB(a)-a.A)};
UB=function(a){const b=a.Zc()&&!a.C?a.J:0;return 2===a.j.version?a.a.a-b:Math.max(0,SB(a)-b)};JB=function(a,b){if(2===a.j.version)return a.a.rb();const c=Math.max(a.w,0);return Infinity===a.A?Math.ceil(1E3*c)/1E3:Math.max(c,Math.min(SB(a)-a.A+b,UB(a)))};VB=function(a,b=!1){b=b?a.offset:0;return{schemeIdUri:a.schemeIdUri,configurationId:a.configurationId,value:a.value,startTime:a.startTime+b,endTime:a.endTime+b,id:a.id,eventElement:a.eventElement,type:a.type,ta:a.ta}};WB=function(a,b){a.h=b};
XB=function(a,b){for(const c of b)a.f(c)};YB=function(a,b=!1){return Array.from(a.a.values()).map(c=>VB(c,b))};ZB=function(a){const b=a.a.jf(),c=a.h,d=b?b.id:null;(c?c.id:null)!==d&&b&&a.f(new _.E(_.Bf,{id:d}));a.h=b;"basic"===a.o.timeline&&(a.j.a=b)};$B=function(a){let b=a.h.get(a.a);if(!b)return null;0<b.a.length&&b.Ra().length&&a.f>=b.a.length&&(a.a+=1,a.f=0,b=a.h.get(a.a));return b&&0<b.a.length?b.a[a.f]||null:b};
_.DB=function(a,b){for(;a.a.length;)if(0>=a.a[0].endTime)a.a.shift();else break;0===a.a.length||a.a[a.a.length-1].startTime>=b||(a.a[a.a.length-1].endTime=b)};_.aC=function(a){return a.a.length?a.a[a.a.length-1].endTime:0};
_.cC=function(a,b){let c=[];const d=[];for(var e=0,f=0;e<a.a.length&&f<b.length;){var g=a.a[e];const h=b[f];g.startTime<h.startTime?(c.push(g),e++):(g.startTime>h.startTime?0===e?d.push(h):a.g.info("Refusing to rewrite original references on update!"):(.1<Math.abs(g.endTime-h.endTime)?c.push(new _.bC(g.position,h.startTime,h.endTime,h.Ra,h.xa,h.ma,h.Aa,h.keyInfo,h.xc,h.timescale,h.horizontalTiles,h.verticalTiles,h.durationPerTile)):c.push(g),e++),f++)}for(;e<a.a.length;)c.push(a.a[e++]);if(c.length)for(e=
c[c.length-1].position+1;f<b.length;)g=b[f++],g=new _.bC(e++,g.startTime,g.endTime,g.Ra,g.xa,g.ma,g.Aa,g.keyInfo,g.xc,g.timescale,g.horizontalTiles,g.verticalTiles,g.durationPerTile),c.push(g);else c=b;b=c;if(d.length&&c.length){b=[];f=c[0].position;e=d.length;for(const h of d)b.push(new _.bC(f-e--,h.startTime,h.endTime,h.Ra,h.xa,h.ma,h.Aa,h.keyInfo,h.xc,h.timescale,h.horizontalTiles,h.verticalTiles,h.durationPerTile));for(const h of c)b.push(h)}a.a=b};
_.dC=function(a,b){for(let c=0;c<a.a.length;++c)if(a.a[c].endTime>b)return a.a.splice(0,c);b=a.a;a.a=[];return b};fC=function(a,b){let c=a.find(b);c=null===c?-1:c-1;const d=a.get(c+1);let e=-1;if(d&&0<d.a.length)for(let f=d.a.length-1;0<=f;--f){let g=d.a[f];if(b>=g.startTime&&b<g.endTime){for(;f&&!g.h;)--f,g=d.a[f];if(!g.h)break;c+=1;e=f-1;break}}return new eC(a,c,e)};gC=function(a,b){a.f=b};
hC=function(a){if(a.a.paused||0===a.a.playbackRate||0===a.a.buffered.length)var b=!1;else a:{b=a.a.buffered;a=a.a.currentTime;for(let c=0;c<b.length;c++){const d=b.start(c),e=b.end(c);if(!(a<d-.1||a>e-(c+1===b.length?.5:.1))){b=!0;break a}}b=!1}return b};
iC=function(a){if(0!==a.a.readyState){if(a.a.seeking){if(!a.C)return}else a.C=!1;if(!a.a.paused&&!a.o){a.a.readyState!==a.I&&(a.j=!1,a.I=a.a.readyState);var b=a.l.smallGapLimit,c=a.a.currentTime,d=a.a.buffered;a:{var e=new _.et(d);var f=a.l.gapDetectionThreshold;if(e.length&&!(1===e.length&&1E-6>e.end(0)-e.start(0)))for(var g=0;g<e.length;g++)if(e.start(g)>c&&(0===g||e.end(g-1)-c<=f)){e=g;break a}e=null}if(null==e){if(a.f){a=a.f;d=a.h;c=hC(d);d=d.a.currentTime;b=Date.now()/1E3;if(a.a!==d||a.l!==c)a.j=
b,a.a=d,a.l=c;d=b-a.j;d>=a.o&&c&&a.f(a.a,d)}}else if((0!==e||a.A)&&a.H&&(f=d.start(e),!(f>=UB(a.G)))){g=f-c;b=g<=b;var h=!1;if(!(.001>g)){if(!b&&!a.j){a.j=!0;const k=new _.E("largegap",{detail:{currentTime:c,gapSize:g}});k.cancelable=!0;a.F(k);a.l.jumpLargeGaps&&!k.defaultPrevented?h=!0:_.hh("Ignoring large gap at",c,"size",g)}if(b||h)0===e?_.hh(bA,g,"seconds because of gap before start time of",f):_.hh(bA,g,"seconds because of gap starting at",d.end(e-1),"and ending at",f),a.B=!0,a.a.currentTime=
f}}}}};jC=function(a,b){a.h=a.f.currentTime;a.l=b;a.j=a.o;a.f.currentTime=b;a.a.kb(.1)};lC=function(a,b){a.w||(a.w=!0,a.o&&a.o());.001>Math.abs(a.a.currentTime-b)?kC(a):(a.f.one(a.a,_.Ff,()=>{kC(a)}),jC(a.h,0===a.a.currentTime?b:a.a.currentTime))};mC=function(a,b){a.A=b;a.f.off(a.a,_.se);a.f.one(a.a,_.se,()=>{lC(a,b)})};nC=function(a){return a.l?a.a.currentTime:a.A};oC=function(a,b){0<a.a.readyState?jC(a.h,b):mC(a,b)};kC=function(a){_.ck()&&!a.l&&a.j();a.l=!0;a.f.on(a.a,_.Ff,()=>a.j())};
rC=function(a,b,c){if(!c.stallEnabled)return null;const d=c.gapDetectionThreshold;let e=c.stallSkip;c=new pC(new qC(b),c.stallThreshold);gC(c,(f,g)=>{a.g.warn(`Stall detected at ${f} for ${g} seconds.`);if(e){g=new _.et(b.buffered);var h;if(h=_.Wj("Edge/")||_.Wj("Trident/")||_.Xj()||_.ck())a:{h=g;if(h.length&&!(1>=h.length))for(let k=0;k<h.length-1;k++)if(f>h.start(k)&&f<h.end(k)){h=h.start(k+1)-h.end(k)>=d;break a}h=!1}if(h){a:{if(g.length&&!(1>=g.length))for(h=0;h<g.length-1;h++)if(f>g.start(h)&&
f<g.end(h)){f=g.start(h+1)-f;break a}f=null}f&&(e=Math.min(f+.1,e))}a.g.warn(`Seeking forward ${e} seconds to break stall.`);b.currentTime+=e}else a.g.warn("Pausing and unpausing to break stall."),b.pause(),b.play()});return c};uC=function(a,b,c){null==b?b=Infinity>a.a.getDuration()||c?KB(a.a):UB(a.a):0>b&&(b=UB(a.a)+b);return sC(a,tC(a,b))};tC=function(a,b){const c=KB(a.a);if(b<c)return c;a=UB(a.a);return b>a?a:b};vC=function(a){const b=nC(a.f);return 0<a.h.readyState&&!a.h.paused?tC(a,b):b};
sC=function(a,b){const c=a.a.getDuration();return b>=c?c-a.l.durationBackoff:b};
wC=function(a,b){if("startover"===a.a.B)return b;var c=new _.et(a.h.buffered);c=c.tb.bind(c);var d=Math.max(a.B,a.l.rebufferingGoal);const e=a.l.safeSeekOffset;let f=KB(a.a);const g=UB(a.a),h=a.a.getDuration();3>g-f&&(f=g-3);const k=JB(a.a,d),l=JB(a.a,e);d=JB(a.a,d+e);if(b>=h)return a.g.debug("Playhead past duration."),sC(a,b);if(b>g)return a.g.debug("Playhead past end."),g;if(b<f){if(c(l))return a.g.debug("Playhead before start \x26 start is buffered"),l;a.g.debug("Playhead before start \x26 start is unbuffered");
return d}if(b>=k||c(b))return a.g.debug("Playhead in safe region or in buffered region."),b;a.g.debug("Playhead outside safe region \x26 in unbuffered region.");return d};xC=function(a,b,c=0){for(const d of a.a)d.l(a.f.currentTime,b,c)};yC=function(a,b){const c=a.offset||0;return b<a.startTime+c?1:b>a.endTime+c?3:2};zC=function(a,b,c,d){a.a=b;a.f=c;a.h=d};_.AC=function(a){_.Br[a]&&delete _.Br[a]};_.BC=function(a){_.zr[a]&&delete _.zr[a]};
_.CC=function(a){a=a.toLowerCase();return _.fs[a]||window.muxjs&&a===_.yc?!0:!1};DC=function(a,b){if(b!==_.yc){var c=_.fs[b];if(!c)throw new _.H(_.F,2,2012,"Text parser is unavailable for "+b);a.w=new c(a.C)}};
EC=function(a,b,c,d){return Promise.resolve().then(()=>{if(a.w&&a.j)if(null==c||null==d)a.w.parseInit(_.J(b));else{var e={periodStart:a.A,segmentStart:c,segmentEnd:d};e=a.w.parseMedia(_.J(b),e);var f=e.cues.filter(g=>g.startTime>=a.h&&g.startTime<a.l);a.j.append(f,e.styles);null==a.a&&(a.a=Math.max(c,a.h));a.f=Math.min(d,a.l)}})};FC=function(a,b,c){a.B=b;if(b=a.o.get(b))for(const d of b.keys()){let e=b.get(d);e&&(e=e.filter(f=>f.endTime<=c),a.j.append(e,[]))}};
GC=function(a,b,c,d,e){const f=c+" "+d,g=new Map;for(const h of b){b=h.stream;g.has(b)||g.set(b,new Map);g.get(b).has(f)||g.get(b).set(f,[]);h.startTime+=e;h.endTime+=e;if(!(h.startTime>=a.h&&h.startTime<a.l))continue;const k=new _.Bs(h.startTime,h.endTime,h.text);g.get(b).get(f).push(k);b===a.B&&a.j.append([k],[])}for(const h of g.keys()){a.o.has(h)||a.o.set(h,new Map);for(const k of g.get(h).keys())e=g.get(h).get(k),a.o.get(h).set(k,e)}a.a=null==a.a?Math.max(c,a.h):Math.min(a.a,Math.max(c,a.h));
a.f=Math.max(a.f,Math.min(d,a.l))};HC=function(a){const b=_.Nj(a.mimeType,a.codecs),c=oB(a);return _.CC(b)||_.Vp(c)||(_.Mj(b,a.type)?!0:!1)};JC=function(a,b){if(window.ManagedMediaSource){a.j.disableRemotePlayback=!0;var c=new ManagedMediaSource;a.l.one(c,KA,()=>{URL.revokeObjectURL(a.B);b.resolve()});a.l.on(c,LA,()=>{a.T=!0});a.l.on(c,"endstreaming",()=>{a.T=!1});a.B=IC(c);a.j.src=a.B;return c}c=new MediaSource;a.B=IC(c);a.l.one(c,KA,()=>{URL.revokeObjectURL(a.B);b.resolve()});a.j.src=a.B;return c};
KC=function(a,b){b.forEach((c,d)=>{c=a.o.addSourceBuffer(c);a.l.on(c,_.r,a.U.bind(a,d));a.l.on(c,"updateend",a.C.bind(a,d));a.f[d]=c;a.h[d]=[];a.H[d]=!1});a.O=b.has(_.p)&&b.has(_.w)};LC=function(a,b){try{return new _.et(a.f[b].buffered,b)}catch(c){return b in a.f&&a.g.error(zA+b,c),null}};MC=function(a,b){return a.f[b]?(a=LC(a,b))?a.toString():"":""};OC=function(a,b,c){if(a.J)return Promise.reject();c={start:c,p:new _.dn};a.h[b].push(c);1===a.h[b].length&&NC(a,b);return c.p};
PC=function(a,b,c,d,e){return[OC(a,b,a.lb.bind(a,b)),OC(a,b,a.la.bind(a,b,c)),OC(a,b,a.mb.bind(a,b,d,e))]};
RC=function(a,b){return _.x(function*(){if(a.J)return Promise.reject();const c=[];for(const d in a.f){const e=new _.dn,f={start:function(g){g.resolve()}.bind(null,e),p:e};a.h[d].push(f);c.push(e);1===a.h[d].length&&f.start()}try{yield Promise.all(c)}catch(d){for(const e in a.f)a.h[e].length&&a.h[e].shift();return Promise.reject(d)}for(const d in a.f);try{yield b()}catch(d){return Promise.reject(new _.H(_.F,3,3015,{mediaError:d}))}finally{for(const d in a.f)QC(a,d)}})};
QC=function(a,b){a.h[b].shift();NC(a,b)};NC=function(a,b){const c=a.h[b][0];if(c)try{a.g.debug(pA+b),c.start()}catch(d){d.name===hA?c.p.reject(new _.H(_.F,3,3017,{type:b})):c.p.reject(new _.H(_.F,3,3015,{mediaError:d})),QC(a,b)}else a.g.debug(dA+b)};
XC=function(a,b,c,d){var e=a.periods.flatMap(h=>h.variants);if(b.length||c.length)e=SC(e,b,c);e=TC(e,d);if(1<a.periods.length){const h=l=>{l=l.split(".");let m=l[0];1<l.length&&(m+="."+l[1]);return m.toLowerCase()};b=[];for(var f of a.periods){c=new Set;for(const l of f.variants)null!==l.audio&&c.add(h(l.audio.codecs));b.push(c)}let k=b[0];for(f=1;f<b.length;f++){const l=b[f];k=new Set([...k].filter(m=>l.has(m)))}e=e.filter(l=>0===k.size&&null===l.audio?!0:0<k.size&&null===l.audio?!1:k.has(h(l.audio.codecs)))}e=
UC(e);const g=VC(e);for(const h of a.periods)h.variants=h.variants.filter(k=>{if(WC(k)===g)return!0;_.ih("Dropping Variant (better codec available)",k);return!1})};
SC=function(a,b,c){if(!b.length&&!c.length)return a;const d=a.filter(g=>(g=g.audio)&&c.length&&(g=_.qB(g.codecs),c.includes(g))?!0:!1),e=a.filter(g=>(g=g.video)&&b.length&&(g=_.qB(g.codecs),b.includes(g))?!0:!1),f=a.filter(g=>d.length&&!e.length?d.includes(g):!d.length&&e.length?e.includes(g):d.includes(g)&&e.includes(g));return f.length?f:a};
TC=function(a,b){var c=a.filter(f=>f.audio&&f.audio.channelsCount);const d=new Map;for(var e of c)c=e.audio.channelsCount,d.has(c)||d.set(c,[]),d.get(c).push(e);e=Array.from(d.keys());if(0===e.length)return a;a=e.filter(f=>f<=b);return a.length?d.get(Math.max.apply(null,a)):d.get(Math.min.apply(null,e))};UC=function(a){const b=new _.ps;for(const c of a)a=WC(c),b.push(a,c);return b};
VC=function(a){let b="",c=Infinity;a.forEach((d,e)=>{e=e.reduce((f,g)=>f+g.bandwidth||0,0)/e.length;_.ih(_.sd,d,"avg bandwidth",e);e<c&&(b=d,c=e)});return b};WC=function(a){let b="";a.video&&(b=_.qB(a.video.codecs));let c="";a.audio&&(c=_.qB(a.audio.codecs));return b+"-"+c};YC=function(a,b,c,d){let e=a.periods.flatMap(f=>f.variants);if(b.length||c.length)e=SC(e,b,c);e=TC(e,d);for(const f of a.periods)f.variants=f.variants.filter(g=>e.includes(g))};
ZC=function(a,b,c){var d=a.video,e;if(e=d&&d.width&&d.height){e=d.width;if(e=e>=b.minWidth&&e<=Math.min(b.maxWidth,c.width))e=d.height,e=e>=b.minHeight&&e<=Math.min(b.maxHeight,c.height);if(c=e)d=d.width*d.height,c=d>=b.minPixels&&d<=b.maxPixels;e=!c}(d=e)||(a=a.bandwidth,d=!(a>=b.minBandwidth&&a<=b.maxBandwidth));return d?!1:!0};$C=function(a,b,c){let d=!1;for(const e of a)a=e.allowedByApplication,e.allowedByApplication=ZC(e,b,c),a!==e.allowedByApplication&&(d=!0);return d};
cD=function(a,b,c,d,e){e=void 0===e?!0:e;let f=!1;d.variants=d.variants.filter(g=>{if(a&&a.O&&!XA(a,g))return _.ih("Dropping variant - not compatible with key system",g),!1;let h=g.audio;const k=g.video;if(h&&!HC(h)){const l=h.codecs;0<=h.codecs.indexOf(_.Sd)?(_.ih("Trying to use AC-3 for EC-3"),h.codecs=h.codecs.replace(_.Sd,"ac-3"),HC(h)?_.hh("Using AC-3 instead of EC-3 for",aD(h)):(h.codecs=l,_.hh(iA,aD(h)),g.audio=null,f=!0,h=null)):(_.hh(iA,aD(h)),g.audio=null,f=!0,h=null)}return k&&!HC(k)?(_.hh("Dropping variant - video not compatible with platform",
aD(k)),!1):h&&b&&!bD(h,b,e)?(_.hh("Dropping variant - not compatible with active audio","active audio",aD(b),"variant.audio",aD(h)),!1):k&&c&&!bD(k,c,e)?(_.hh("Dropping variant - not compatible with active video","active video",aD(c),"variant.video",aD(k)),!1):!0});if(f){let g=!1,h=!1;for(const k of d.variants)!g&&k.video&&k.audio&&(g=!0),h||k.audio||!k.video||(h=!0);g&&h&&(d.variants=d.variants.filter(k=>k.video&&!k.audio?(_.hh("Dropping variant - not compatible with video + audio","variant.video",
aD(k.video)),!1):!0))}d.textStreams=d.textStreams.filter(g=>{const h=_.CC(_.Nj(g.mimeType,g.codecs));h||_.ih("Dropping text stream. Is not supported by the platform.",g);return h})};
aD=function(a){const b=oB(a);return a.type===_.p?"type\x3daudio mimeType\x3d"+a.mimeType+" codecs\x3d"+a.codecs+" codecInfo\x3d"+b+" bandwidth\x3d"+a.bandwidth+" channelsCount\x3d"+a.channelsCount:a.type===_.w?"type\x3dvideo mimeType\x3d"+a.mimeType+" codecs\x3d"+a.codecs+" codecInfo\x3d"+b+" bandwidth\x3d"+a.bandwidth+" frameRate\x3d"+a.frameRate+" width\x3d"+a.width+" height\x3d"+a.height:"unexpected stream type"};
bD=function(a,b,c){return a.mimeType!==b.mimeType||(void 0===c||c)&&a.codecs.split(".")[0]!==b.codecs.split(".")[0]?!1:!0};
dD=function(a){const b=a.audio,c=a.video,d=b?b.codecs:null,e=c?c.codecs:null,f=[];e&&f.push(e);d&&f.push(d);const g=c&&c.mimeType||null,h=b&&b.mimeType||null;var k=[];b&&k.push(b.kind);c&&k.push(c.kind);k=k[0]||null;const l=new Set,m=new Set;if(b)for(var n of b.roles)m.add(n);if(c)for(const q of c.roles)l.add(q);n=[c,b].map(q=>q?q.accessibility||[]:[]).reduce((q,u)=>q.concat(u),[]);a={id:a.id,active:!1,type:"variant",bandwidth:a.bandwidth,language:a.language,originalLanguage:a.language,label:null,
kind:k,width:null,height:null,frameRate:null,trickPlay:!1,mimeType:g,audioMimeType:h,codecs:f.join(", "),audioCodec:d,videoCodec:e,primary:a.primary,roles:Array.from(l),audioRoles:Array.from(m),videoId:null,audioId:null,channelsCount:null,spatialAudio:!1,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,accessibility:n,keyId:c?c.keyId:b?b.keyId:null};c&&(a.videoId=c.id,a.originalVideoId=c.originalId,a.width=c.width||null,a.height=c.height||null,
a.frameRate=c.frameRate||null,a.trickPlay=!!c.trickPlay,a.videoBandwidth=c.bandwidth||null);b&&(a.audioId=b.id,a.originalAudioId=b.originalId,a.originalLanguage=b.originalLanguage,a.channelsCount=b.channelsCount,a.audioBandwidth=b.bandwidth||null,a.label=b.label,a.audioRoles=b.roles);return a};
eD=function(a){return{id:a.id,active:!1,type:_.G,bandwidth:0,language:a.language,originalLanguage:a.originalLanguage,label:a.label,kind:a.kind||null,width:null,height:null,frameRate:null,trickPlay:!1,mimeType:a.mimeType,audioMimeType:null,codecs:a.codecs||null,audioCodec:null,videoCodec:null,primary:a.primary,roles:a.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,spatialAudio:!1,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:a.originalId,
accessibility:a.accessibility,keyId:null}};fD=function(a){return a.allowedByApplication&&a.allowedByKeySystem};
_.hD=function(a,b,c,d){b=_.Ah(b);let e=a;const f=a.filter(h=>h.primary);f.length&&(e=f);const g=e.length?e[0].language:"";e=e.filter(h=>h.language===g);b.some(h=>{const k=_.gB(_.bi(h),a.map(l=>l.language));return k?(e=a.filter(l=>_.bi(l.language)===k),!0):!1});e=e.filter(h=>d?h.kind===_.Wd:h.kind!==_.Wd);if(c){b=gD(e,c);if(b.length)return b;_.C("No exact match for the text role could be found.")}else if(b=e.filter(h=>0===h.roles.length),b.length)return b;b=e.map(h=>h.roles).reduce(_.aB,[]);return b.length?
gD(e,b[0]):e};gD=function(a,b){return a.filter(c=>c.roles.includes(b))};
iD=function(a,b){var c=String(_.gj++);c=new _.hj(c,a);c.mimeType=_.dj(b.mimeType);if(a===_.K||a===_.L)c.label=_.dj(b.label),c.language=_.dj(b.language),c.originalLanguage=_.dj(b.originalLanguage);a===_.N?(c.frameRate=b.frameRate,c.roles=b.roles,c.trickPlay=b.trickPlay):a===_.L?(c.channelsCount=b.channelsCount,c.roles=b.audioRoles||[],c.mimeType=_.dj(b.audioMimeType)):(c.kind=_.dj(b.kind),c.roles=b.roles);c.accessibility=a===_.N||a===_.L?(b.accessibility||[]).filter(d=>d.type===a):b.accessibility||
[];return c};
jD=function(a,b,c){const d=new _.pj(a===_.N?`${b.videoId}`:a===_.L?`${b.audioId}`:`${b.id}`,c);switch(a){case _.N:d.codec=_.dj(b.videoCodec);d.bandwidth=b.videoBandwidth||b.bandwidth;d.width=b.width;d.height=b.height;d.originalId=b.originalVideoId;d.drm={keyId:b.keyId||void 0};break;case _.L:d.codec=_.dj(b.audioCodec);d.bandwidth=b.audioBandwidth||b.bandwidth;d.originalId=b.originalAudioId;d.drm={keyId:b.keyId||void 0};break;default:d.codec=_.dj(b.codecs),d.originalId=b.originalTextId}(a=c.renditions.find(e=>
_.Yg(e,d,null,["id","track"])))||c.renditions.push(d);return a||d};kD=function(a,b){a=a.reduce((c,d)=>{b===_.N?null===d.videoId||c[d.videoId]&&!d.active||(c[d.videoId]=d):b===_.L&&(null===d.audioId||c[d.audioId]&&!d.active||(c[d.audioId]=d));return c},{});return Object.values(a)};lD=function(a,b){if(void 0!==b&&null!==b){const c=a.filter(d=>d.audio&&d.audio.id===b);if(0<c.length)return c}return a};
mD=function(a,b,c){function d(e,f){return null==e?null==f:f.id===e}for(let e=0;e<c.length;e++)if(d(a,c[e].audio)&&d(b,c[e].video))return c[e];return null};_.nD=function(a,b){a.forEach(c=>{c.startTime+=b;c.endTime+=b})};oD=function(a){const b=a.periods[0].startTime;a=a.periods[a.periods.length-1].endTime;if(null==a)throw Error("Period end time must be known");return{start:b,end:a}};pD=function(a){return Object.assign({},a,{periods:a.periods.map(b=>Object.assign({},b))})};
rD=function(a,b){try{if(1===a.length)return a[0];if(!a.every(qD))throw new _.Jh("Period durations must be finite");if(0===a.length)throw Error("Cannot concatenate 0 manifests");if(1===a.length)var c=a[0];else{var d=[...a[0].periods];for(let g=1;g<a.length;g++){const h=oD(a[g-1]).end;_.nD(a[g].periods,h);d.push(...a[g].periods)}d={adaptedPeriods:d,periods:d,presentationTimeline:b,minBufferTime:0};var e=oD(d).end;_.IB(b.a,0,e);var f=a[0].presentationTimeline.hc();f&&_.LB(b,f.seekRangeStartDateTime);
c=d}return c}catch(g){throw new _.H(_.F,7,7003,"Failed to join manifests into a continuous playlist!",g);}};qD=function(a){return a.periods.every(b=>null!=b.endTime&&0<=b.endTime&&isFinite(b.endTime))};sD=function(a,b){const c=b.periods[0].configurationId;var d=[...a.periods].filter(e=>e.configurationId!==c);a=a.presentationTimeline;d={adaptedPeriods:d,periods:d,presentationTimeline:a,minBufferTime:0};_.MB(a,b.presentationTimeline.l);return rD([d,b],a)};
tD=function(a,b){return a.h.filter(c=>c.type===b)};uD=function(a,b){return(a=a.a.get(b)||null)&&a.track};wD=function(a,b,c){if(!c||uD(a,c.type)!==c||a.m.ra())switch(b){case _.N:a.Ya(c&&c.renditions[0]);break;case _.L:a.hb(c&&c.renditions[0]);break;case _.K:a.ib(c&&c.renditions[0]);break;default:vD(a,b,c&&c.renditions[0])}};
vD=function(a,b,c,d){d=void 0===d?!1:d;if(a.m&&((a.a.get(b)||null)!==c||a.m.ra())){var e=a.m;if(c){if(0>a.h.indexOf(c.track))throw Error(`Unknown rendition with ID ${c.id}`);if(b!==c.track.type)throw Error("Types mismatch");a.g.debug(`Activate rendition type
          ${b} with ID: ${c.id}`);if(b===_.K){const g=e.ka().find(h=>h.id===parseInt(c.id,10));g&&(a.f.set(b,c),xD(a,c),e.trigger(new _.E(_.Kk)),yD(e,!0).then(()=>{zD(e,g)}).catch(h=>{a.g.warn("Error while activating track",h)}))}else if(b===_.L)a.f.set(b,c),AD(e,parseInt(c.id,10));else if(b===_.N){const g=a.a.get(_.L)||null;var f=null;if(g){const h=BD(e).filter(k=>k.videoId===parseInt(c.id,10));f=h.find(k=>k.audioId===parseInt(g.id,10))||null;if(!f){a.g.debug("Unable to find exact variant. Searching for equivalent");
const k=g.track.renditions.map(l=>l.id).filter(l=>l!==g.id);f=h.find(l=>k.find(m=>m===l.audioId))||null}}else f=BD(e).find(h=>h.videoId===parseInt(c.id,10))||null;f?(a.f.set(b,c),CD(e,f,d)):a.g.warn("Cannot find matching variant")}}else a.g.debug(_.Aa+b),(f=uD(a,b))&&(b===_.K?yD(e,!1).then(()=>{a.a.set(b,null);e.trigger(new _.E(_.Kk))}).catch(g=>{a.g.warn("Error while de-activating text tracks",g)}):b===_.L?a.g.info("Enabling ABR for audio is not supported"):b===_.N&&f.trickPlay?a.g.info("Enabling ABR for trick play tracks is not supported"):
CD(e,null,d))}};xD=function(a,b){a.a.set(b.track.type,b);b===(a.f.get(b.track.type)||null)&&a.f.set(b.track.type,null)};FD=function(a){if(a.m){a.g.debug("Track list change detected, updating track list");var b=[];for(var c of Object.values(_.Zs))a.a.set(c,null),a.f.set(c,null);for(var d of a.m.ka()){let e=iD(_.K,d);e=(c=b.find(g=>e.zc(g)))||e;const f=jD(_.K,d,e);d.active&&a.a.set(_.K,f);c||b.push(e)}DD(a.m)||a.a.set(_.K,null);d=BD(a.m);ED(a,b,d,_.N);ED(a,b,d,_.L);a.h=b}};
ED=function(a,b,c,d){c=kD(c,d);for(const e of c){let f=iD(d,e);f=(c=b.find(h=>f.zc(h)))||f;const g=jD(d,e,f);e.active&&a.a.set(d,g);c||b.push(f)}};GD=function(a,b,c){if(b){a.h.length||FD(a);var d=b.type,e=a.a.get(d)||null,f;for(const g of tD(a,d))if(f=g.renditions.find(h=>parseInt(h.id,10)===b.id))break;f&&e!==f&&(xD(a,f),d===_.L?a.m.trigger(new _.E(_.Jk)):d===_.N&&a.m.trigger(new _.E(_.rg,{details:{width:f.width||0,height:f.height||0,bandwidth:f.bandwidth,track:f.track,abrSelection:c}})))}};
HD=function(a,b){b=b.filter(c=>!(c.video&&c.video.trickPlay));a&&(b=b.filter(c=>ZC(c,a,{width:Infinity,height:Infinity})));return b.sort((c,d)=>c.bandwidth-d.bandwidth)};ID=function(a){return new _.H(_.F,7,7E3,a.a?"Another load operation was started while a load operation was in progress.":"Player was released while a load operation was in progress.")};JD=function(a,b){if(b&&(null==a.a||a.a!==b))throw ID(a);};LD=function(a,b){a.a.has(b)||a.a.set(b,new KD);return a.a.get(b)};
MD=function(a,b,c){LD(a,b).text=c};PD=function(a,b,c){c=void 0===c?!0:c;var d;if(!(d=!!a.audio!==!!b.audio||!!a.video!==!!b.video||a.language!==b.language)&&(d=a.audio&&b.audio)){d=a.audio;var e=b.audio;d=!(d.channelsCount===e.channelsCount&&(!c||ND(d,e))&&OD(d.roles,e.roles))}!d&&(d=a.video&&b.video)&&(a=a.video,b=b.video,d=!((!c||ND(a,b))&&OD(a.roles,b.roles)));return d?!1:!0};
ND=function(a,b){if(a.mimeType!==b.mimeType)return!1;a=pB(a.codecs).map(c=>_.qB(c));b=pB(b.codecs).map(c=>_.qB(c));if(a.length!==b.length)return!1;a.sort();b.sort();for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0};OD=function(a,b){a=new Set(a);b=new Set(b);a.delete(_.ue);b.delete(_.ue);if(a.size!==b.size)return!1;for(const c of a)if(!b.has(c))return!1;return!0};QD=function(a,b){let c=null;b.some(d=>{c=_.gB(_.bi(d),a.map(e=>fB(e)));return!!c});return c?a.filter(d=>c===fB(d)):[]};
RD=function(a,b){return a.filter(c=>{const d=c.audio;c=c.video;return d&&0<=d.roles.indexOf(b)||c&&0<=c.roles.indexOf(b)})};SD=function(a,b){return a.filter(c=>c.audio&&c.audio.spatialAudio!==b?!1:!0)};
TD=function(a){return 1>=a.a.chasingRate?(a.g.warn("chasingRate must be greater than 1."),!1):a.a.chaseJumpDistance<=a.a.startChasingAt?(a.g.warn("chaseJumpDistance must be greater than startChasingAt."),!1):a.a.startChasingAt<=a.a.stopChasingAt?(a.g.warn("startChasingAt must be greater than stopChasingAt."),!1):0>a.a.stopChasingAt?(a.g.warn("stopChasingAt must be greater than or equal to 0."),!1):!0};
VD=function(a,b){if(window.ManagedMediaSource){a.j.disableRemotePlayback=!0;var c=new ManagedMediaSource;a.l.one(c,KA,()=>{URL.revokeObjectURL(a.B);b.resolve()});a.l.on(c,LA,()=>{a.W=!0});a.l.on(c,"endstreaming",()=>{a.W=!1});a.B=UD(c);a.j.src=a.B;return c}c=new MediaSource;a.B=UD(c);a.l.one(c,KA,()=>{URL.revokeObjectURL(a.B);b.resolve()});a.j.src=a.B;return c};
WD=function(a,b){b.forEach((c,d)=>{const e=a.o.addSourceBuffer(c);a.l.on(e,_.r,a.U.bind(a,d));a.l.on(e,"updateend",a.C.bind(a,d));a.a[d]=e;a.H[d]=c;a.h[d]=[];a.I[d]=!1});a.T=b.has(_.p)&&b.has(_.w)};XD=function(a,b){try{return new _.et(a.a[b].buffered,b)}catch(c){return b in a.a&&a.g.error(zA+b,c),null}};YD=function(a,b){return a.a[b]?(a=XD(a,b))?a.toString():"":""};$D=function(a,b,c){if(a.O)return Promise.reject();c={start:c,p:new _.dn};a.h[b].push(c);1===a.h[b].length&&ZD(a,b);return c.p};
aE=function(a,b,c){0>c&&(c+=.001);try{a.g.debug(nA+b,c),a.a[b].timestampOffset=c}catch(d){throw a.g.warn(Zz+b,c,d),d;}a.g.debug(Tz+b,c);a.C(b)};cE=function(a,b,c,d){return _.x(function*(){const e=_.qB(_.Pj(a.H[b])),f=_.Oj(a.H[b]),g=_.Nj(c,d),h=_.qB(_.Pj(g)),k=_.Oj(g);if(e===h&&f===k)return!1;a.K.mediaSource.codecSwitchingStrategy===_.Kf&&sB()&&(yield bE(a,b,g));return!0})};
dE=function(a,b,c,d,e,f){return[f?Promise.resolve():$D(a,b,()=>{try{a.g.debug(Iz+b+Cz);const g=a.a[b].appendWindowStart,h=a.a[b].appendWindowEnd;a.a[b].abort();a.a[b].appendWindowStart=g;a.a[b].appendWindowEnd=h}catch(g){throw a.g.warn(Uz+b+Cz,g),g;}a.g.debug(Oz+b+Cz);a.C(b)}),$D(a,b,()=>aE(a,b,c)),$D(a,b,()=>{try{a.g.debug(lA+b,d,e),a.a[b].appendWindowStart=0,a.a[b].appendWindowEnd=e,a.a[b].appendWindowStart=d}catch(g){throw a.g.warn(Yz+b,d,e,g),g;}a.g.debug(Sz+b,d,e);a.C(b)})]};
fE=function(a,b){return _.x(function*(){if(a.O)return Promise.reject();const c=[];for(const d in a.a){const e=new _.dn,f={start:function(g){g.resolve()}.bind(null,e),p:e};a.h[d].push(f);c.push(e);1===a.h[d].length&&f.start()}try{yield Promise.all(c)}catch(d){for(const e in a.a)a.h[e].length&&a.h[e].shift();return Promise.reject(d)}for(const d in a.a);try{yield b()}catch(d){return Promise.reject(new _.H(_.F,3,3015,{mediaError:d}))}finally{for(const d in a.a)eE(a,d)}})};
eE=function(a,b){a.h[b].shift();ZD(a,b)};ZD=function(a,b){const c=a.h[b][0];if(c)try{a.g.debug(pA+b),c.start()}catch(d){d.name===hA?c.p.reject(new _.H(_.F,3,3017,{type:b})):c.p.reject(new _.H(_.F,3,3015,{mediaError:d})),eE(a,b)}else a.g.debug(dA+b)};bE=function(a,b,c){return $D(a,b,()=>{b===_.G?a.g.debug(`Change not supported for ${b}`):(a.g.debug(`Change Type: ${a.H[b]} -> ${c}`),sB()?(a.a[b].changeType(c),a.H[b]=c):a.g.debug("Change Type not supported"),a.C(b))})};gE=function(a,b){a.f=b};
hE=function(a,b){a.j=b;a.j.speedUpMode&&(a.w=a.j.speedUpMode)};kE=function(a,b){a.a.stop();a.l||(a.o=!1);const c=a.l?0:a.h;if((b?b:a.w)===_.Dd||0===c||1===c)try{iE(a,c)}catch(d){a.g.warn('Set playbackRate using "decoder" mode fails, due to unsupported range by platform. Fallback to "seek" mode.',d),jE(a)}else jE(a)};iE=function(a,b){if(a.f.nf()!==b){a.g.debug(mA,b,' using native playbackRate "decoder" mode.');try{a.f.rh(b)}catch(c){throw c;}}};
jE=function(a){a.g.debug(mA,a.h,' using "seek" mode.');iE(a,0);a.o=!0;a.a.kb(.25)};
mE=function(a){a=_.J(a);let b=!1,c;const d=[],e=h=>{d.push(h);_.Fl(h)},f=()=>{b=!0},g=[];(new _.Ml).M(_.Be,e).M(_.Yf,e).M(_.we,e).M(_.Ae,e).M(_.Pf,e).ca(_.Rf,h=>{c=h;d.push(h);_.Gl(h)}).ca("encv",f).ca("enca",f).ca("avc1",h=>{g.push({M:h,Gc:1701733238})}).ca("avc3",h=>{g.push({M:h,Gc:1701733238})}).ca("ac-3",h=>{g.push({M:h,Gc:1701733217})}).ca(_.Sd,h=>{g.push({M:h,Gc:1701733217})}).ca("mp4a",h=>{g.push({M:h,Gc:1701733217})}).parse(a);if(b)return _.hh("Init segment already indicates encryption."),
a;if(0===g.length||!c)throw _.jh("Failed to find boxes needed to fake encryption!"),_.jh("Failed init segment (hex):",_.Gi(a)),new _.H(_.F,3,14E3);g.reverse();for(const h of g)_.hh(`Inserting "${_.El(h.Gc)}" box into init segment.`),a=lE(a,c,h.M,d,h.Gc);return a};
lE=function(a,b,c,d,e){{var f=nE.value(),g=a.subarray(c.start,c.start+c.size);const k=_.li(g);var h=new Uint8Array(c.size+f.byteLength);h.set(g,0);g=_.li(h);g.setUint32(4,e);h.set(f,c.size);e=k.getUint32(4);g.setUint32(c.size+16,e);oE(h,0,h.byteLength);e=h}h=new Uint8Array(a.byteLength+e.byteLength);c=_.Wj("Xbox One")||_.Vj()?c.start:c.start+c.size;f=a.subarray(c);h.set(a.subarray(0,c));h.set(e,c);h.set(f,c+e.byteLength);for(const k of d)oE(h,k.start,k.size+e.byteLength);a=_.li(h,b.start);b=_.Il(b);
d=a.getUint32(b);a.setUint32(b,d+1);return h};oE=function(a,b,c){a=_.li(a,b);b=a.getUint32(0);0!==b&&(1===b?(a.setUint32(8,c>>32),a.setUint32(12,c&4294967295)):a.setUint32(0,c))};pE=function(a){return"("+a.type+":"+a.stream.id+")"};qE=function(a){return!a.fb&&null==a.$a&&!a.Mb&&!a.ac};rE=function(a){null!=a.$a&&(a.$a.stop(),a.$a=null)};sE=function(a){return _.x(function*(){a.Ib&&(yield a.Ib.abort())})};uE=function(a,b){return(b=AB(tE(a),b+_.Ms))?tE(a).indexOf(b):0};
tE=function(a){return a.j.adaptedPeriods||a.j.periods};zE=function(a,b,c,d,e){return _.x(function*(){var f=a.D.Db();const g=uE(a,f);f=new Map;const h=new Set;b&&(f.set(_.p,b),h.add(b));c&&(f.set(_.w,c),h.add(c));d&&(f.set(_.G,d),h.add(d));yield a.D.$.init(f,a.h.forceNativeTS,a.h.disableAudioTracks);a.f||(vE(a),yield wE(a,h),a.f||f.forEach((k,l)=>{a.a.has(l)||(k=xE(k,g,e),a.a.set(l,k),yE(a,k,0))}))})};AE=function(a){var b=a.a.get(_.w);return b?tE(a)[b.Gb]:(b=a.a.get(_.p))?tE(a)[b.Gb]:null};
_.BE=function(a,b){return(a=a.a.get(b))?a.Wb||a.stream:null};CE=function(a){return _.BE(a,_.p)};DE=function(a){return _.BE(a,_.w)};
wE=function(a,b){return _.x(function*(){var c=[];for(const d of b){const e=a.o.get(d.id);e?(a.g.debug("(all) Stream "+d.id+Ez),c.push(e.R)):(a.g.debug("(all) setting up Stream "+d.id),a.o.set(d.id,{R:new _.dn,Jb:!1}),c.push(d.createSegmentIndex(a.D.vb)))}try{if(yield Promise.all(c),a.f)return}catch(d){if(a.f)return;for(const e of b)a.o.get(e.id).R.catch(()=>{}),a.o.get(e.id).R.reject(),a.o.delete(e.id);throw d;}for(const d of b)c=a.o.get(d.id),c.Jb||(c.R.resolve(),c.Jb=!0,a.g.debug("(all) setup Stream "+
d.id))})};xE=function(a,b,c){return{stream:a,type:a.type,Ub:null,segmentIterator:null,pa:null,Wb:null,Gd:!0,Gb:b,endOfStream:!1,fb:!1,$a:null,Mb:!1,rd:0,Pd:!1,ac:!1,xe:!1,Cc:!1,Jf:c||0,Ib:null,td:!1,wf:0}};yE=function(a,b,c){a.g.debug(pE(b),"updating in "+c+" seconds");b.$a=(new _.bt(()=>_.x(function*(){try{yield a.Hb(b)}catch(d){if(a.D)a.D.onError(d)}}))).ha(c)};
EE=function(a,b){return _.x(function*(){yield a.D.$.clear(_.G);a.G++;a.H=!1;var c=a.G,d=a.D.$;const e=new Map,f=new Set;e.set(_.G,b);f.add(b);yield d.init(e,!1,a.h.disableAudioTracks);a.f||(yield wE(a,f),a.f||(d=d.getTextDisplayer().isTextVisible()||a.h.alwaysStreamText,a.G!==c||a.a.has(_.G)||a.H||!d||(c=a.D.Db(),c=uE(a,c),c=xE(b,c,0),a.a.set(_.G,c),yE(a,c,0))))})};FE=function(a){a.H=!0;const b=a.a.get(_.G);b&&(rE(b),sE(b).catch(()=>{}),a.a.delete(_.G))};
_.QE=function(a,b,c,d){const e=a.a.get(b.type);if(!e&&b.type===_.G&&a.h.ignoreTextStreamFailures)EE(a,b);else if(e){var f=CB(tE(a),b);if(c&&f!==e.Gb){a.g.debug("switch: switching to stream in another Period; clearing buffer and changing Periods");for(var g of a.a.values())GE(a,g)}else if(e.Wb&&(a.g.debug("switch during trick play mode",b),b.trickModeVideo?(e.Wb=b,b=b.trickModeVideo,a.g.debug("switch found trick play stream",b)):(e.Wb=null,a.g.debug("switch found no special trick play stream"))),(g=
a.l[f])&&g.Jb&&(g=a.o.get(b.id))&&g.Jb)if(e.stream!==b){g=a.j.presentationTimeline.getDuration();var h=a.D.Db();h=HE(a,e,h);!c&&(e.endOfStream||h>=g)?a.g.debug(OA+pE(e)+" already buffered to the end. Not switching."):(b.type===_.G&&a.D.$.A(_.Nj(b.mimeType,b.codecs)),e.stream=b,e.stream.segmentIterator=null,e.Gd=!0,a.g.debug("switch: switching to Stream "+pE(e)),IE(a,e,f)&&(a.g.info("Aborting current segment request to switch."),e.Ib.abort()),c&&(e.ac?e.Pd=!0:e.fb?(e.Mb=!0,e.rd=d,e.Pd=!0):(rE(e),PE(a,
e,!0,d).catch(k=>{if(a.D)a.D.onError(k)}))))}else a.g.debug(OA+pE(e)+" already active")}};RE=function(a,b,c,d){b.video&&_.QE(a,b.video,c,d);b.audio&&_.QE(a,b.audio,c,d)};vE=function(a){const b=a.j.presentationTimeline.getDuration();Infinity>b?a.D.$.Z(b):a.D.$.Z(Math.pow(2,32))};SE=function(a,b){a.j.adaptedPeriods=b.adaptedPeriods;a.j.periods=b.periods;vE(a)};
GE=function(a,b){const c=pE(b);b.ac?a.g.debug(c,"clear: already clearing the buffer"):b.Mb?a.g.debug(c,"clear: already waiting"):b.fb?(a.g.debug(c,"clear: currently updating"),b.Mb=!0,b.rd=0):null==a.D.$.Ga(b.type)?(a.g.debug(c,"clear: nothing buffered"),null==b.$a&&yE(a,b,0)):(a.g.debug(c,"clear: handling right now"),rE(b),PE(a,b,!1,0).catch(d=>{if(a.D)a.D.onError(d)}))};
TE=function(a){const b=a.D.Db(),c=g=>a.D.$.tb(g,b,0);let d=!1;const e=uE(a,b);if(_.di(a.a.values(),g=>g.Gb===e))for(const g of a.a.keys()){var f=a.a.get(g);f.stream.segmentIterator=null;c(g)||(GE(a,f),d=!0)}else if(!_.di(a.a.keys(),c)){a.g.debug("(all): seeked: unbuffered seek: clearing all buffers");for(f of a.a.values())GE(a,f);d=!0}d||a.g.debug("(all): seeked: buffered seek: presentationTime\x3d"+b)};
UE=function(a,b){b=void 0===b?!1:b;if(a.f)a.g.error("Unable to retry after StreamingEngine is destroyed!");else if(a.A)a.g.error("Unable to retry after StreamingEngine encountered a fatal error!");else for(const c of a.a.values()){const d=pE(c);if(c.Cc||b&&qE(c))a.g.info(d,"Retrying after failure..."),c.Cc=!1,yE(a,c,.1)}};VE=function(a){return Array.from(a.a.values()).some(b=>null!==b.$a)};WE=function(a){const b=Array.from(a.a.values());return a.B&&b.every(c=>c.endOfStream)};
PE=function(a,b,c,d){return _.x(function*(){const e=pE(b);b.Mb=!1;b.Pd=!1;b.rd=0;b.ac=!0;b.stream.segmentIterator=null;a.g.debug(e,"clearing buffer");if(d){var f=a.D.Db();const g=a.D.$.getDuration();f=a.D.$.remove(b.type,f+d,g)}else f=a.D.$.clear(b.type).then(()=>!a.f&&c?a.D.$.flush(b.type):null);yield f;a.f||(a.g.debug(e,"cleared buffer"),b.Ub=null,b.pa=null,b.ac=!1,b.endOfStream=!1,b.td=!1,yE(a,b,0))})};
XE=function(a){return _.x(function*(){const b=[];for(const c of a.a.values())rE(c),c.fb&&c.Ib&&(c.fb=!1,b.push(c.Ib.abort())),c.Mb&&b.push(PE(a,c,!0,0));yield Promise.all(b)})};YE=function(a,b,c){(a=a.a.get(b))&&c&&(rE(a),a.stream=c,a.Ub=c,a.pa&&(a.pa=c.getSegmentReference(a.pa.position)),a.pa||(a.Ub=null))};HE=function(a,b,c){if(!b.Ub||!b.pa)return Math.max(c,b.Jf);c=CB(tE(a),b.Ub);return tE(a)[c].startTime+b.pa.endTime};
IE=function(a,b,c){if(!b.Ib)return!1;const d=a.D.Db(),e=a.D.$.ja(b.type);c=(c=ZE(a,b,d,e,c))?c.Tc():null;if(null==c)return!1;var f=b.stream.initSegmentReference;f&&(c+=f.Tc()||0);f=a.D.vd().getBandwidthEstimate();if(8*c/f<(null===e?0:e-d)-Math.max(a.j.minBufferTime||0,a.h.rebufferingGoal))return!0;a=b.Ib;a=a.j?a.j.bytesRemaining:-1;return 0>a||a>c?!0:!1};
ZE=function(a,b,c,d,e){if(b.stream.segmentLookupStrategy===_.BA)b.stream.segmentIterator?a=$B(b.stream.segmentIterator):b.pa||d?(c=b.pa?b.pa.endTime:d,a.g.info(aA,"looking up segment from new stream endTime:",c),b.stream.segmentIterator=fC(b.stream.segmentIndex,c),e=b.stream.segmentIterator.next().value,null===e&&(b.stream.segmentIterator=null,a.g.warn(aA,vA,"endTime:",c,b.pa)),a=e):(e=Math.max(0,c-tE(a)[e].startTime),a.g.info(aA,"looking up segment","lookupTime:",e,FA,c),d=null,d||(b.stream.segmentIterator=
fC(b.stream.segmentIndex,e),d=b.stream.segmentIterator.next().value),null===d&&a.g.warn(aA,vA,"lookupTime:",e,FA,c),a=d);else{var f=pE(b);if(b.pa&&b.stream===b.Ub)c=b.pa.position+1,a.g.debug(f,"next position known:","position\x3d"+c),a=$E(a,b,e,c);else{if(b.pa){a.g.debug(f,"next position unknown: another Stream buffered");f=CB(tE(a),b.Ub);var g=aF(a,b,tE(a)[f].startTime+b.pa.endTime,e)}else a.g.debug(f,"next position unknown: nothing buffered"),g=aF(a,b,d||c,e);if(null==g)a=null;else if(f=$E(a,b,
e,g),null==f)a=null;else{var h=null==a.h?!1:a.h.ignoreDrift;null==d&&!h&&f.Aa+f.startTime+2>c&&(a=$E(a,b,e,Math.max(0,g-1)))&&(f=a);a=f}}}return a};
bF=function(a,b){let c=a.l[b];if(c)return a.g.debug("(all) Period "+b+Ez),c.R;a.g.debug("(all) setting up Period "+b);c={R:new _.dn,Jb:!1};a.l[b]=c;const d=new Set;for(const e of tE(a)[b].variants)e.video&&d.add(e.video),e.video&&e.video.trickModeVideo&&d.add(e.video.trickModeVideo),e.audio&&d.add(e.audio);for(const e of tE(a)[b].textStreams)d.add(e);a.F=a.F.then(()=>a.f?null:wE(a,d)).then(()=>{a.f||(a.l[b].R.resolve(),a.l[b].Jb=!0,a.g.debug("(all) setup Period "+b))}).catch(e=>{a.f||(a.l[b].R.catch(()=>
{}),a.l[b].R.reject(),delete a.l[b],a.g.warn("(all) failed to setup Period "+b),a.D.onError(e))});return c.R};
eF=function(a,b){if(b.type===_.G&&b.stream.mimeType===_.yc)return a.D.$.Fa(b.stream.originalId||""),null;b.type===_.G&&a.D.$.ga();if(!a.D.$.Ma()&&b.type!==_.G)return a.h.bufferLimitUpdateInterval?a.h.bufferLimitUpdateInterval/2:.5;var c=pE(b);const d=a.D.Db(),e=HE(a,b,d);a.g.debug(c,"timeNeeded\x3d"+e);const f=CB(tE(a),b.stream);var g=uE(a,e),h=a.D.$.ya(b.type,d);a.g.debug(c,"update_:",GA+d,"bufferedAhead\x3d"+h);const k=Math.max(a.j.minBufferTime||0,a.h.rebufferingGoal,a.h.bufferingGoal)*a.w,l=NB(a.j.presentationTimeline);
if(null!=l&&e>=l&&!b.td)return cF(a,b),null;b.endOfStream=!1;b.Gb=g;if(g!==f)return a.g.debug(c,"need Period "+g,GA+d,"timeNeeded\x3d"+e,"currentPeriodIndex\x3d"+f),null;if(h>=k)return a.g.debug(c,"buffering goal met"),a.h.bufferLimitUpdateInterval||.5;g=a.D.$.ja(b.type);g=ZE(a,b,d,g,f);if(!g)return a.j.presentationTimeline.isLive()||b.type===_.G?a.h.bufferLimitUpdateInterval||1:(a.g.debug("Media state "+c+": no next segment found. Assuming EOS."),cF(a,b),null);c=Infinity;for(const m of a.a.values())if(m.type!==
_.G||m.stream.mimeType!==_.yc)h=HE(a,m,d),c=Math.min(c,h);if(e>=c+a.j.presentationTimeline.h)return a.h.bufferLimitUpdateInterval||1;b.Jf=0;dF(a,b,d,f,g).catch(()=>{});return null};fF=function(a,b){return _.x(function*(){if(!a.f){if(a.D.Kf)try{yield a.D.Kf(b)}catch(c){c.cause=b,b=c}if(!b.f)a.D.onError(b)}})};
gF=function(a,b){const c=pE(b),d=CB(tE(a),b.stream);if(b.Gb!==d){var e=b.Gb,f=Array.from(a.a.values());f.every(g=>g.Gb===e)?f.every(qE)?(a.g.debug(c,"all need Period "+e),bF(a,e).then(()=>{if(!a.f)if(a.D.$.Na(),f.every(l=>{const m=qE(l),n=CB(tE(a),l.stream);return m&&l.Gb===e&&n!==e})){var g=tE(a)[e];a.g.debug(c,"Streaming period",e,g);a.g.debug(c,"calling onChooseStreams()...");var h=a.D.oe(g);a.C=!h.variant&&!!h.text;var k=new Map;h.variant&&h.variant.video&&k.set(_.w,h.variant.video);h.variant&&
h.variant.audio&&k.set(_.p,h.variant.audio);h.text&&k.set(_.G,h.text);for(const l of a.a.keys())if(!k.has(l)&&l!==_.G){a.g.error(c,"invalid Streams chosen: missing "+l+" Stream");a.D.onError(new _.H(_.F,5,5005));return}for(const l of Array.from(k.keys()))if(!a.a.has(l))if(l===_.G)zE(a,null,null,k.get(_.G),g.startTime),k.delete(l);else{a.g.error(c,"invalid Streams chosen: unusable "+l+" Stream");a.D.onError(new _.H(_.F,5,5005));return}for(const l of Array.from(a.a.keys()))(g=k.get(l))?(_.QE(a,g,!1,
0),yE(a,a.a.get(l),0)):a.a.delete(l);a.g.debug(c,uA);a.D.ne()}else a.g.debug(c,"ignoring transition to Period",e,"since another is happening")}).catch(bB)):a.g.debug(c,"all MediaStates need Period "+e+", but not all MediaStates are idle"):a.g.debug(c,"not all MediaStates need Period "+e)}};cF=function(a,b){a.g.debug(pE(b),"buffered to end of presentation");b.endOfStream=!0;b.type===_.w&&(a=a.a.get(_.G))&&a.stream.mimeType===_.yc&&(a.endOfStream=!0)};
dF=function(a,b,c,d,e){return _.x(function*(){const f=pE(b),g=tE(a)[d];a.g.debug(f,"fetchAndAppend_:",GA+c,yA+g.startTime,IA+e.position,JA+e.startTime,HA+e.endTime);const h=b.stream,k=b.stream.segmentIterator;var l=a.j.presentationTimeline.getDuration();const m=tE(a)[d+1];l=hF(a,b,d,Math.max(0,g.startTime-.1),m?m.startTime+.01:l,e);b.fb=!0;b.Gd=!1;a.g.debug(f,"fetching segment");let n=!1;const q=(v,y)=>{if(a.f||a.A)return null;n=!0;return iF(a,b,c,g,h,e,v,y)},u=a.D.$.ja(b.type)||0;l.then(()=>a.f||
a.A?null:jF(a,b,e,!1,v=>q(v.data,!0))).then(v=>a.f||a.A?null:n||null===v?(kF(a,b,u,e,h),null):q(v,!1)).then(()=>{if(!a.f&&!a.A){kF(a,b,u,e,h);b.fb=!1;b.xe=!1;b.Mb||a.D.Kd();if(k){const v=k.next().value;v&&a.g.debug("New iterated segment",v)}yE(a,b,0);lF(a,b,h);a.g.debug(f,"finished fetch and append")}}).catch(v=>_.x(function*(){a.f||a.A||(b.fb=!1,b.type===_.G&&a.h.ignoreTextStreamFailures?(1001===v.code?a.g.warn(f,"Text stream failed to download. Proceeding without it."):a.g.warn(f,"Text stream failed to parse. Proceeding without it."),
a.a.delete(_.G)):7001===v.code?(b.fb=!1,b.$a=null,yE(a,b,0)):3017===v.code?mF(a,b,v):1001===v.code&&v.data&&404===v.data[1]?(a.g.warn(f,"request for segment failed","segment not available on server",IA+e.position,JA+e.startTime,HA+e.endTime,"error\x3d"+v),b.fb=!1,b.$a=null,yE(a,b,1)):b.type===_.G?(v instanceof _.H&&v.a(1),rE(b),a.D.onError(new _.H(1,2,2010,v))):1001<=v.code&&1003>=v.code?yield nF(a,b,g,v):(a.g.error(f,"failed fetch and append: code\x3d"+v.code),b.Cc=!0,v instanceof _.H&&v.a(_.F),
yield fF(a,v)))}))})};$E=function(a,b,c,d){const e=pE(b);c=tE(a)[c];const f=b.stream.getSegmentReference(d);if(!f)return a.g.debug(e,"segment does not exist:",yA+c.startTime,"position\x3d"+d),null;var g=a.j.presentationTimeline;d=_.TB(g);g=SB(g);return!b.td&&(c.startTime+f.endTime<d||c.startTime+f.startTime>g)?(a.g.debug(e,"segment is not available:",yA+c.startTime,JA+f.startTime,HA+f.endTime,"availabilityStart\x3d"+d,"availabilityEnd\x3d"+g),null):f};
aF=function(a,b,c,d){const e=pE(b);d=tE(a)[d];const f=Math.max(0,c-d.startTime);b=b.stream.findSegmentPosition(f);a.g.debug(e,"Looked up segment:",GA+c,"lookupTime\x3d"+f,yA+d.startTime,"Result: segment position\x3d"+b);null==b&&a.g.warn(e,"cannot find segment:",yA+d.startTime,"lookupTime\x3d"+f);return b};
hF=function(a,b,c,d,e,f){return _.x(function*(){var g=tE(a)[c].startTime-f.Aa,h=b.Gd||f.initSegment!==(b.pa&&b.pa.initSegment);if(!h&&g===b.wf)return Promise.resolve();b.wf=g;const k=pE(b);a.g.debug(k,"setting timestamp offset to "+g);a.g.debug(k,"setting append window start to "+d);a.g.debug(k,"setting append window end to "+e);g=a.D.$.Oa(b.type,g,d,e,b.stream.mimeType,b.stream.codecs);if(!b.stream.initSegmentReference||!h)return g;a.g.debug(k,"fetching init segment");h=jF(a,b,f&&f.initSegment||
b.stream.initSegmentReference,!0).then(l=>{if(a.f)return null;a.g.debug(k,"appending init segment");return oF(a,l,b).then(()=>a.D.$.L(b.type,l,null,null,!!b.stream.closedCaptions&&0<b.stream.closedCaptions.size))}).catch(l=>{b.Gd=!0;return Promise.reject(l)});return Promise.all([g,h])})};
iF=function(a,b,c,d,e,f,g,h){h=void 0===h?!1:h;return _.x(function*(){const k=pE(b);if(e&&e.keyId&&a.D.Oc){var l=UA(a.D.Oc,e.keyId);if(l)try{yield l}catch(n){a.g.warn("DRM session load failed!",n)}else a.g.warn(`Unable to find DRM session for ${e.keyId}`)}if(e.encrypted&&e.keyId&&a.D.Oc&&WA(a.D.Oc,e.keyId))return rE(b),l=CB(tE(a),e),(l=pF(a,l))&&(yield l),l=a.D.Td(e,d,CA),a.g.warn(k,`Blocked append for ${f.startTime+d.startTime} - ${f.endTime+d.startTime}: ${l}. `+`Stream with Key ID ${e.keyId} has restrictions.`),
Promise.resolve();const m=e.closedCaptions&&0<e.closedCaptions.size;null!=e.emsgSchemeIdUris&&0<e.emsgSchemeIdUris.length&&(new _.Ml).ca("emsg",a.I.bind(a,d,f,e.emsgSchemeIdUris)).parse(g);return qF(a,b,c).then(()=>{if(a.f)return null;const n=f.startTime+d.startTime,q=f.endTime+d.startTime;a.g.debug(k,"Appending segment "+`with ${n.toFixed(3)} - ${q.toFixed(3)} `+`KeyID: ${e.keyId} `+`Width: ${e.width} Height: ${e.height} `+`Bitrate: ${_.zi(e.bandwidth)} `+`Fragment: ${h}`);return a.D.$.L(b.type,
g,n,q,m,e.id,h)}).then(()=>{a.f||(a.g.debug(k,"appended media segment"),b.Ub=e,b.pa=f)})})};
jF=function(a,b,c,d,e){d=void 0===d?!1:d;e=void 0===e?null:e;const f=_.HB(c.Ra(),c.xa,c.ma,a.h.attemptParameters,c.startTime,c.endTime,b.type,c.timescale);f.type=2;f.onFragment=c.xc?null:e;f.disableFragmentSupport=c.xc||a.h.disableFragmentSupport;f.disableMergedFragments=a.h.disableMergedFragments;if(e=c.f())f.keyInfo=e,f.onFragment=null;d&&(f.responseModifiers.push(g=>{rF(a,b,g.data)}),b.type===_.w&&a.h.overridePasp&&f.responseModifiers.push(a.J.bind(a)));a.g.debug("fetching: reference\x3d",c);c=
a.D.vb.fetch(f);b.Ib=c;return c.R.then(g=>{const h=a.D.vd(),k=g.timeMs,l=g.data.byteLength;k&&l&&!d&&h.segmentDownloaded(k,l);b.Ib=null;return g.data})};
kF=function(a,b,c,d,e){if(!a.j.presentationTimeline.isLive()&&b.type!==_.G){var f=pE(b);const g=(a.D.$.ja(b.type)||0)-c,h=d.endTime-d.startTime;c=g-h;if(Math.abs(c)>=Math.min(.01,h)&&Math.abs(c)<=Math.min(1,h))for(a.g.debug(f,"Adjusted segment",d.position,"with real duration",g,"and accounted for",c,"delta between segment duration and real duration"),b.td=!0,a=tE(a),b=c,e.adjustSegmentDurations(d.position,b),d=CB(a,e),f=a[d],e=e.getDuration(),EB(f,e),e=d+1;e<a.length;e++)a[e].startTime+=b}};
lF=function(a,b,c){if(!a.B){b=pE(b);var d=Array.from(a.a.values());1!==d.length||d[0].type!==_.G?a.B=d.every(e=>e.type===_.G||a.C?!0:!e.Mb&&!e.ac&&e.pa):a.C&&(a.B=!0);a.B&&(a.g.debug(b,"startup complete"),c=CB(tE(a),c),pF(a,c))}};
mF=function(a,b,c){const d=pE(b);if(Array.from(a.a.values()).some(e=>e!==b&&e.xe))a.g.debug(d,cA,"waiting for another stream to recover...");else{const e=Math.round(100*a.w);if(20<e)a.w-=.2;else if(4<e)a.w-=.04;else{a.g.error(d,"MediaSource threw QuotaExceededError too many times");b.Cc=!0;a.A=!0;a.D.onError(c);return}a.g.warn(d,cA,"reducing buffering goals by "+(100-Math.round(100*a.w))+"%");b.xe=!0}yE(a,b,4)};
nF=function(a,b,c,d){return _.x(function*(){let e=!0;1001===d.code&&500<=d.data.status||(e=!a.D.Td(b.stream,c));e&&(b.Cc=!0,d.a(_.F),yield fF(a,d))})};oF=function(a,b,c){return _.x(function*(){if(a.h.patchEdgeWhenMixedContent&&_.Vj()){const d=mE(b);yield a.D.$.L(c.type,d.buffer,null,null,!!c.stream.closedCaptions&&0<c.stream.closedCaptions.size)}})};
pF=function(a,b){let c=null;a.l[b]||(c=bF(a,b).then(()=>{a.f||(a.g.debug(uA),a.D.ne())}).catch(bB));for(b=0;b<tE(a).length;++b)bF(a,b).catch(bB);a.D.bh&&(a.g.debug("calling onStartupComplete()..."),a.D.bh());return c};
qF=function(a,b,c){if(a.f)return Promise.resolve();const d=pE(b);a.g.debug(d,"checking buffer length");const e=Math.max(a.h.bufferBehind,a.j.presentationTimeline.h),f=a.D.$.Ga(b.type);if(null==f)return a.g.debug(d,"buffer behind okay because nothing buffered:",GA+c,sA+e),Promise.resolve();const g=c-f,h=g-e;if(.01>=h)return a.g.debug(d,"buffer behind okay:",GA+c,tA+g,sA+e,"underflow\x3d"+Math.abs(h)),Promise.resolve();a.g.debug(d,"buffer behind too large:",GA+c,tA+g,sA+e,"overflow\x3d"+h);return a.D.$.remove(b.type,
f,f+h).then(()=>{a.f||a.g.debug(d,"evicted "+h+" seconds")})};rF=function(a,b,c){(new _.Ml).M(_.Be,_.Fl).M(_.Yf,_.Fl).M(_.we,_.Fl).M(_.Ae,_.Fl).M(_.Pf,_.Fl).ca(_.Rf,_.Gl).M("encv",d=>{d.reader.skip(78);_.Fl(d)}).M(_.Jf,_.Fl).M("schi",_.Fl).M("tenc",d=>{d.reader.skip(6);if(_.xl(d.reader)){d.reader.skip(1);const e=_.Gi(_.Cl(d.reader,16));e!==b.stream.keyId&&(a.g.debug(pE(b),"Key id from tenc mismatches with key id from manifest. Switching from "+`${b.stream.keyId} to ${e}.`),b.stream.keyId=e)}d.parser.stop()}).parse(c)};
sF=function(a){const b=c=>c.video&&c.audio||c.video&&c.video.codecs.includes(",");if(a.some(c=>c.variants.some(b))){_.ih("Found variant with audio and video content, so filtering out audio-only content in all periods.");for(const c of a)c.variants=c.variants.filter(b)}};
yD=function(a,b){return _.x(function*(){if(a.we!==b&&(a.we=b,a.F===tF&&(a.K.getTextDisplayer().setTextVisibility(b),!a.configuration.streaming.alwaysStreamText)))if(b){var c=uF(a);c=_.hD(c.textStreams,a.cc,a.Cd,a.bc);0<c.length&&(yield EE(a.a,c[0]))}else FE(a.a)})};zD=function(a,b){if(a.f&&a.a){const c=uF(a),d=c.textStreams.find(e=>e.id===b.id);d?(vF(a,c,d,!1),wF(a,d),a.cc=d.language,a.bc=d.kind===_.Wd):a.log.error(_.eA,b.id)}};
AD=function(a,b){if(a.configuration.streaming.disableAudioTracks)Promise.reject(Error("Audio tracks are disabled by config."));else{if(a.a&&(a.f||a.B)){var c=DE(a.a),d=CE(a.a),e=AB(a.f.periods,vC(a.B)),f=a.f.periods[e?a.f.periods.indexOf(e):0].variants.filter(h=>h.audio.id===b&&fD(h));e=!1;var g=void 0;if(c){if(g=f.find(h=>h.video.id===c.id),!g){a.log.debug("Cannot find exact variant, looking for anything else that matches with given audioId");e=!0;const h=a.getTrackManager().Ja();if(h){const k=h.renditions.map(l=>
l.id);g=f.find(l=>k.find(m=>m===String(l.video.id)))}}}else g=f[0];if(g){if(d.codecs.split(".")[0]===g.audio.codecs.split(".")[0]){d=g.audio;a.Va=d.id;a.h.setVariants(f);f=uF(a);xF(a,f,g,!1);e||a.X?yF(a,g,!0,0):_.QE(a.a,d,!0,0);Promise.resolve();return}a.log.warn("Target audio codecs not compatible with active audio codecs.")}}Promise.reject()}};BD=function(a){if(a.f&&a.B){const b=zF(a),c=[];for(const d of AF(a))a=dD(d),a.active=d===b,c.push(a);return c}return[]};
CD=function(a,b,c){var d=void 0===d?0:d;if(a.f&&a.a){const f=uF(a);if(a.configuration.abr.enabled&&b)a.log.info("Disable ABR and enable manual track selection to "+`select ${b.width}x${b.height}@${b.bandwidth}`),a.configuration.abr.enabled=!1,a.h.disable();else if(!a.configuration.abr.enabled&&!b){a.log.info("Enable ABR Selection");a.configuration.abr.enabled=!0;a.h.enable();a.T=null;c=BF(a,f.variants);null!=a.ea&&(a.Oa=a.ea,a.ea=null);null==c||a.X||CF(a,c);return}if(b){a.T=b.id;var e=f.variants.find(g=>
g.id===b.id);e?(a.T=e.video.id,fD(e)?(xF(a,f,e,!1),yF(a,e,c,d),null==a.ea&&(a.ea=a.Oa),a.Oa=new DF(e),BF(a,f.variants)):a.log.error("Unable to switch to restricted track",b.id)):a.log.error("No variant with id",b.id)}else a.T=null,null!=a.ea&&(a.Oa=a.ea,a.ea=null),c=BF(a,f.variants),null==c||a.X||CF(a,c)}};DD=function(a){const b=a.we;return a.f?a.K.getTextDisplayer().isTextVisible():b};
EF=function(a,b){a.j||(a.o.on(b,_.r,()=>{if(a.j.error){var c=a.j.error.code;if(1===c)c=null;else{var d=a.j.error.msExtendedCode;d&&(0>d&&(d+=Math.pow(2,32)),d=d.toString(16));c=new _.H(_.F,3,3016,{code:c,extendedError:d,message:a.j.error.message})}}else c=null;if(c)a.onError(c)}),a.j=b)};GF=function(a){return new _.FF(b=>{const c=a.getTrackManager(),d=[];if(c)for(const e of c.getVideoTracks())d.push(...e.renditions);return d.find(e=>e.id===b.toString())||null})};
HF=function(a,b){if(a.Fa!==b)if(a.Fa===_.Vn&&b!==_.Wn)b=jB(b,_.Un),a.log.info(_.fA+`${b}`);else{var c=a.He;c=0===c?0:Date.now()-c;var d=a.Fa;a.Fa=b;a.He=Date.now();null!==a.I&&(a.I.A=b===_.Yn);a.G&&_.Fn(a.G.a,a.Fa);b===_.Rn&&(a.Nf=a.ve?1:2);var e=a.Nf,f={currentState:a.Fa,previousState:d,timeSinceLastStateChangeMS:c,reason:b===_.Rn||d===_.Rn?e:void 0},g=jB(d,_.Un),h=jB(b,_.Un),k=b!==_.Rn?"":`[${jB(e,_.Tn)}]`;a.log.info(`Player state change: ${g} -> `+`${h}${k}`);a.trigger(new _.E(_.Nf,{detail:f}));
(b===_.On||b===_.Vn)&&a.Ma&&a.Ma.stop();b===_.Rn?a.trigger(new _.E(_.Uc,{detail:{bufferedTimeMS:-1,reason:e}})):d===_.Rn&&a.trigger(new _.E(_.Qc,{detail:{bufferedTimeMS:c,reason:e}}))}};MF=function(a){return _.x(function*(){IF(a);yield JF(a);KF(a);if(_.Xj(4)||_.Xj(5)){const b=a.getSurface().getMedia();EF(a,b);yield LF(a,b)}a.configuration=a.la})};
NF=function(a){return _.x(function*(){const b=a.l.a;a.l.a=null;b&&(yield b.catch(()=>{}));yield Object.getPrototypeOf(Object.getPrototypeOf(a)).release.call(a);yield a.unload();HF(a,_.Wn)})};KF=function(a){a.j&&(a.o.off(a.j,_.r),a.j=null)};IF=function(a){if(a.F===OF)throw new _.H(_.F,7,7E3,"Player is destroyed.");};PF=function(a){return a.aa?a.aa.catch(()=>{}):Promise.resolve()};
QF=function(a){const b=new _.tu;(a=a.playlist)&&a.cropTimeline&&(a.startTime||a.endTime)&&(b.h={start:a.startTime||null,end:a.endTime||null});return b};UF=function(a,b){return _.x(function*(){a.G=new _.yt;HF(a,_.Xn);a.S=new _.vu(a.getNetworkEngine());$A(a.S,{enabled:a.configuration.abr.useCmsd});const c=RF(a,a.configuration);yield LF(a,c);JD(a.l,b);a.H=new SF;WB(a.H,d=>{a.log.info("Timeline cue found",d);TF(a,_.uh,d)})})};
XF=function(a,b,c,d,e){return _.x(function*(){var f=_.bo(b)[c];const g=yield VF(a,f);JD(a.l,d);_.Hm(DA);f=yield WF(a,g,f,b.id||"");JD(a.l,d);e&&f.presentationTimeline.l&&(yield g.stop(),JD(a.l,d));_.Hm("manifest.end");_.Im("Fetch and parse manifest",DA,"manifest.end");return{parser:g,manifest:f}})};
aG=function(a,b,c){return _.x(function*(){_.Hm("initDrm.start");const d=new _.io({vb:a.getNetworkEngine(),onError:h=>a.onError(h),re:h=>{if(a.a){var k=uF(a),l=!1,m=Object.keys(h);0===m.length&&a.log.warn("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var n=1===m.length&&"00"===m[0];n&&a.log.warn("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");
if(m.length){m=a.getPeriods();for(let B=0;B<m.length;B++){const D=m[B];for(var q of D.variants){var u=q;var v=[];u.audio&&v.push(u.audio);u.video&&v.push(u.video);u=v;for(var y of u)u=q.allowedByKeySystem,y.keyId&&(v=h[n?"00":y.keyId],v=!!v&&!YF.includes(v),q.allowedByKeySystem=v),u!==q.allowedByKeySystem&&(v=y.type,y.type===_.w&&(v=`video ${y.width}x${y.height}@`+`${_.zi(y.bandwidth)}`),a.log.warn("DRM Key not available for "+`KID: '${y.keyId}'. Applying restrictions to ${v}`)),D===k&&u!==q.allowedByKeySystem&&
(l=!0)}}}if(h=AE(a.a)){q=CE(a.a);y=DE(a.a);a:{n=h.variants;for(m=0;m<n.length;m++)if(n[m].audio===q&&n[m].video===y){n=n[m];break a}n=null}if(!n||n.allowedByKeySystem)a.log.info(Nz),ZF(a),BF(a,h.variants)}l&&h!==k&&(a.log.info(Nz),ZF(a),BF(a,k.variants))}},qe:(h,k)=>{a.trigger(new _.E(_.Md,{expirationTime:k}))},onEvent:h=>a.ze(h),getConfiguration:()=>a.getConfiguration(),Bc:()=>a.Bc()});var e=_.ql(c);d.h=e;e=c?c.offlineId||"":"";let f=[];const g=_.wr(b.periods);if(e){const h=_.Zk(_.Qe);h&&(yield h.l(a,
g),f=yield h.j(e))}yield _.cn(d,g,f);a.w=d;$F(a,b.periods);_.Hm("initDrm.end");_.Im("Init DRM","initDrm.start","initDrm.end");return d})};
nG=function(a,b){return _.x(function*(){const c=a.j;bG(a,c);cG(a,a.f.periods);a.Oa=new dG(a.configuration.preferredAudioLanguage||[],a.configuration.preferredAudioRole,a.configuration.preferredAudioChannelCount,a.configuration.preferSpatialAudio,a.configuration.mediaSource.codecSwitchingStrategy);a.cc=a.configuration.preferredTextLanguage;a.Cd=a.configuration.preferredTextRole;a.bc=a.configuration.preferForcedSubtitles;yield _.tn(a.w,c);JD(a.l,b);a.h.configure(a.configuration.abr);a.S&&a.h.setCmsdManager(a.S);
a.h.init((f,g,h)=>{!a.X&&CF(a,f,g,h)});a.B=eG(a,c,a.configuration.startTime);a.lb=fG(a);a.I=new gG({nf:()=>c.playbackRate,rh:f=>{c.playbackRate=f},$g:f=>{c.currentTime+=f}});hE(a.I,a.configuration.trickPlay);a.isLive()&&a.configuration.streaming.enableLiveEdgeChasing&&(a.Dd=new hG(a));iG(a,Math.max(1E-4,a.configuration.streaming.rebufferingGoal));jG(a)?YC(a.f,_.Ah(a.configuration.preferredVideoCodec),_.Ah(a.configuration.preferredAudioCodec),a.configuration.preferredAudioChannelCount):XC(a.f,_.Ah(a.configuration.preferredVideoCodec),
_.Ah(a.configuration.preferredAudioCodec),a.configuration.preferredAudioChannelCount);var d=kG(a);d.h=a.configuration.streaming;a.a=d;a.F=tF;yield d.start();JD(a.l,b);a.configuration.streaming.startAtSegmentBoundary&&(d=lG(a,vC(a.B)),oC(a.B.f,d));for(var e of a.f.periods)mG(a,e);ZF(a);e=uF(a)||a.f.periods[0];d=e.variants.some(f=>f.primary);a.configuration.preferredAudioLanguage||d||a.log.warn("No preferred audio language set.  We will choose an arbitrary language initially");BF(a,e.variants)})};
pG=function(a,b){var c=a.getMediaPosition(),d=a.Na,e=b.periods;b=d.a;d.a=[];var f=null,g=null;for(var h of e)e=h.endTime-h.startTime,h.configurationId===f?g.a+=e:(f=h.configurationId||"",g=new _.ru(f||"",h.startTime,e,!1),d.a.push(g));d.h&&(f=d.h.start,h=d.h.end,g=d.a[0],null!=f&&g&&f>=g.f&&f<=g.f+g.a&&(e=f-g.f,e<g.a&&(g.f=f,g.a-=e)),f=d.a[d.a.length-1],null!=h&&f&&h>=f.f&&h<=f.f+f.a&&(f.a=h-f.f));ZA(d,c);a:if(c=b,d=d.a,c.length!==d.length)d=!1;else{for(b=0;b<c.length;b++)if(!c[b].zc(d[b])){d=!1;
break a}d=!0}!d&&a.trigger(new _.E(_.Df));ZB(a.Fd);oG(a)};rG=function(a,b,c){b=qG(a,b,c);c.catch(()=>{});c.reject(b);a.onError(b);throw b;};sG=function(a,b){return _.x(function*(){const c=yield XF(a,b,0,null,!0);try{const d=[a.f,pD(c.manifest)],e=rD(d,a.f.presentationTimeline);return{parser:c.parser,manifest:e}}catch(d){throw new _.H(_.F,7,7003,"Failed to append load manifest");}})};
tG=function(a,b){return _.x(function*(){if(a.W===_.tb){a.f=sD(a.f,pD(b));const c=a.configuration.playlist.endTime,d=a.f.presentationTimeline.a.a;c&&d>c&&(a.log.info("Reached end of playlist. Turning timeline static."),a.A.requestStop(),a.A=null,_.MB(a.f.presentationTimeline,!0),a.trigger(new _.E(_.ne)));pG(a,a.f)}})};uG=function(a){return _.x(function*(){a.A.requestStop();a.A=null;a.W===_.tb?a.trigger(new _.E(_.Cf)):a.trigger(new _.E(_.ne))})};
oG=function(a){if(a.H&&0<a.ec.length){a.ec.forEach(c=>{const d=YA(a.Na,c.configurationId);c.offset=d?d.rb():0});const b=a.ec.sort((c,d)=>(c.offset||0)-(d.offset||0));XB(a.H,b);a.ec=[]}};
JF=function(a){return _.x(function*(){a.F!==OF&&(a.F=vG);const b=a.j;b&&(a.o.off(b,_.re),a.o.off(b,_.df),a.o.off(b,_.Pe),a.o.off(b,_.Vd),a.o.off(b,_.tf),a.o.off(b,_.rf));a.H&&(a.H.release(),a.H=null);a.lb&&(a.lb.release(),a.lb=null);a.Ma&&(a.Ma.stop(),a.Ma=null);a.A&&(yield a.A.stop(),a.A=null);a.h&&(yield a.h.stop());a.a&&(yield a.a.destroy(),a.a=null);a.B&&(a.B.release(),a.B=null);a.I&&(a.I.release(),a.I=null);a.K&&(yield a.K.destroy(),a.K=null);a.Ob&&(a.Ob.release(),a.Ob=null);a.Dd&&(a.Dd.release(),
a.Dd=null);b&&b.src&&(b.removeAttribute("src"),b.load());a.w&&(yield a.w.destroy(),a.w=null);a.S&&(a.S.release(),a.S=null);a.N.clear();a.J=null;a.Ed.clear();a.f=null;a.G=null;a.X=!0;a.mb.clear();a.Qc=!1;wG(a)})};LF=function(a,b){return _.x(function*(){const c=window.muxjs?new xG:new _.yG,d=_.En(a.configuration,[_.be,"single-native"]).create(a);a.O=d;const e=GF(a);e.track(a);a.Ob=e;let f=null;jG(a)?f=new zG(b,c,d,e,a.configuration):f=new _.AG(b,c,d,e,a.configuration);yield f.open();a.K=f})};
BG=function(a,b,c){c=void 0===c?!0:c;return _.x(function*(){const d=Date.now()/1E3,e=new _.dn;a.l.a=e;try{IF(a);yield PF(a);JD(a.l,e);a.da=_.bo(b);a.configuration=_.Wk(a.la,b);a.log.info(_.fb,a.configuration);a.log.info(_.yb,a.da);yield UF(a,e);JD(a.l,e);const f=yield XF(a,b,a.getSourceIndex(),e,!1);JD(a.l,e);a.A=f.parser;a.f=f.manifest;a.w=yield aG(a,a.f,a.configuration.drm);JD(a.l,e);c&&(yield nG(a,e),JD(a.l,e),a.o.one(a.j,_.re,()=>{const g=Date.now()/1E3-d;a.G&&(a.G.A=g)}));e.resolve()}catch(f){rG(a,
f,e)}})};qG=function(a,b,c){var d=a.l;return null!=d.a&&d.a===c||b instanceof _.H&&7E3===b.code?b instanceof _.H?b:new _.H(_.F,7,7003,"Unexpected error.",b):ID(a.l)};RF=function(a,b){const c=a.getSurface().getMedia();c.loop=!!b.loop;_.A(b.volume)||a.setVolume(b.volume);_.A(b.muted)||a.setMuted(b.muted);EF(a,c);return c};TF=function(a,b,c){a.trigger(new _.E(b,{detail:VB(c,CG(a))}))};
VF=function(a,b){return _.x(function*(){var c=a.getNetworkEngine();c=yield _.yr(b.url,c,a.configuration.manifest.attemptParameters,b.type||null);c.configure(a.configuration.manifest);return c})};
WF=function(a,b,c,d){return(new _.lo(Promise.resolve().then(()=>_.x(function*(){let e=null;for(;!e;)try{{var f=b,g=c.url;const k=DG(a,d);var h=f.start(g,k)}e=yield h}catch(k){if(a.vc)if(f=yield a.vc(c.url,k))c.url=f;else throw k;else throw k;}if(0===e.periods.length)throw new _.H(_.F,4,4014);sF(e.periods);return e})),()=>{a.log.info("Aborting parser step...");return b.stop()})).R};
wG=function(a){if(a.G&&a.J&&a.B){var b=EG(a)===_.Rn,c=a.I;c.l=b;kE(c,c.o?"seek":void 0);a.B.j.o=b;FG(a);a.Fd&&(c=1>Math.abs(a.getMediaDuration()-a.getMediaPosition()),a=a.Fd,b&&c&&(b=a.a,b.a[b.a.length-1]&&a.f(new _.E(_.Af))))}};jG=function(a){return a.configuration.mediaSource.codecSwitchingStrategy===_.Kf&&(_.Xj(2)||_.Xj(3)||_.Xj(4)||_.Xj(5)||_.Xj(6)||_.ak()&&38===_.bk().major||_.ak()&&53===_.bk().major||_.ak()&&68===_.bk().major?!1:!0)};
$F=function(a,b){var c=a.a?CE(a.a):null;const d=a.a?DE(a.a):null,e=!jG(a);for(const g of b)cD(a.w,c,d,g,e);c=mB(b,g=>g.variants.some(fD));if(a.configuration.streaming.disableAudioTracks)for(var f of b)for(const g of f.variants)delete g.audio;if(a.configuration.streaming.disableVideoTracks)for(const g of b)for(const h of g.variants)(f=h.video)&&!nB(f.type,_.Nj(f.mimeType,f.codecs))&&delete h.video;if(0===c)throw new _.H(_.F,4,4032);if(c<b.length)throw new _.H(_.F,4,4011);for(const g of b)$C(g.variants,
a.configuration.restrictions,a.Sf)&&a.a&&uF(a)===g&&ZF(a),GG(a,g.variants)};bG=function(a,b){const c=d=>{a.j&&a.J&&(d.type===_.Ff&&a.Xc?(a.J.a=HG,wG(a)):d.type===_.vg&&a.getState()===_.Zn&&.1>a.getBufferInfo().ya(a.getMediaPosition())?(a.J.a=HG,wG(a)):a.J&&IG(a));FG(a)};a.o.on(b,_.df,c);a.o.on(b,_.Pe,c);a.o.on(b,_.Vd,c);a.o.on(b,_.Ff,c);a.o.on(b,_.Ef,c);a.o.on(b,_.rf,c);a.o.on(b,_.vg,c);a.o.on(b,_.tf,()=>{if(a.j){var d=a.j.playbackRate;0!==d&&a.I.set(d)}})};
cG=function(a,b){for(let c=0;c<b.length;c++){const d=b[c],e=new Map;for(const f of d.variants)if(f.video&&f.video.closedCaptions){const g=f.video;for(const h of g.closedCaptions.keys())if(!e.has(h)){const k={id:a.Oe++,originalId:h,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:()=>null,getSegmentReference:()=>null,initSegmentReference:null,Aa:0,mimeType:_.yc,codecs:"",kind:_.wA,encrypted:!1,keyId:null,language:g.closedCaptions.get(h),label:null,type:_.G,primary:!1,trickModeVideo:null,
emsgSchemeIdUris:null,roles:g.roles,channelsCount:null,spatialAudio:!1,closedCaptions:null};e.set(h,k)}}for(const f of e.values())d.textStreams.push(f)}};CF=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?0:d;if(a.configuration.abr.enabled){a.log.debug("switch_");var e=JG(a,b);KG(a,e,()=>xF(a,e,b,!0));e===uF(a)&&LG(a);a.a&&RE(a.a,b,c,d)}};eG=function(a,b,c){return new MG(b,a.f,a.configuration.streaming,c,d=>{a.lb&&xC(a.lb,!0,d);a.a&&TE(a.a)},d=>a.dispatchEvent(d),a.W===_.tb)};
fG=function(a){const b=new NG(a.j);var c=new OG(a.f);gE(c,()=>{ZF(a)});b.a.add(c);a.H&&(c=new PG(a.H),zC(c,d=>{d.Jd&&d.Jd();TF(a,_.wh,d)},d=>{d.pe&&d.pe();TF(a,_.xh,d)},(d,e)=>{e||(d.Jd&&d.Jd(),TF(a,_.wh,d),d.pe&&d.pe(),TF(a,_.xh,d))}),b.a.add(c));a.W===_.tb&&(c=new QG(a.Na,a.Vc,d=>a.trigger(d),a.configuration.playlist),b.a.add(c),a.Fd=c);return b};iG=function(a,b){a.J=new RG(b,Math.min(.5,b/2));a.J.a=HG;wG(a);a.Ma=(new _.Tj(()=>{IG(a)})).kb(.25)};
kG=function(a){const b={configuration:{Sg:a.W===_.tb},Db:()=>vC(a.B),$:a.K,vb:a.getNetworkEngine(),oe:a.Vf.bind(a),ne:a.Uf.bind(a),onError:a.onError.bind(a),zf:a.Wf.bind(a),onEvent:a.ze.bind(a),Cf:a.$f.bind(a),Kd:a.Xf.bind(a),vd:()=>a.h,Td:a.Tf.bind(a),Kf:a.Zf.bind(a),Oc:a.w};return new _.SG(a.f,b)};
lG=function(a,b){function c(g,h){if(!g)return null;h=g.findSegmentPosition(h-f.startTime);return null==h?null:(g=g.getSegmentReference(h))?g.startTime+f.startTime:null}const d=CE(a.a);var e=DE(a.a);const f=uF(a);a=c(d,b);e=c(e,b);return null!=e&&null!=a?Math.max(e,a):null!=e?e:null!=a?a:b};
mG=function(a,b){var c=a.a?CE(a.a):null;const d=a.a?DE(a.a):null,e=!jG(a);cD(a.w,c,d,b,e);c=b.variants;if(!c.some(fD))throw new _.H(_.F,4,4011);GG(a,b.variants);$C(c,a.configuration.restrictions,a.Sf)&&a.a&&uF(a)===b&&ZF(a);if(!_.Xj(2)&&(b=a.w?a.w.getDrmInfo():null))for(const f of c)for(const g of f.drmInfos)if(g.keySystem===b.keySystem)for(const h of g.initData||[])_.gn(a.w,h.keyId,h.initData)||_.jn(a.w,h.initDataType,h.initData,h.keyId)};
ZF=function(a){const b=a.getTrackManager();b&&a.F!==OF&&(b.m&&(FD(b),b.m.trigger(new _.E(_.dt))),LG(a))};uF=function(a){const b=vC(a.B);let c=null;for(const d of a.f.periods)d.startTime<=b&&(c=d);return c};
BF=function(a,b){try{GG(a,b)}catch(d){return a.onError(d),null}b=b.filter(d=>fD(d));b=lD(b,a.Va);var c=a.Oa.create(b);c=Array.from(c.values());a.h.setVariants(c);if(null!==a.T&&null!==a.Va&&(c=c.find(d=>d.video.id===a.T&&d.audio.id===a.Va),a.T=null,c))return c;if(a.configuration.abr.enabled||null===a.T)return a.h.chooseVariant();b=b.find(d=>null!==d.video&&d.video.id===a.T);return b?b:(a.log.warn("Selected video track not found. Falling back to ABR selection"),a.h.chooseVariant())};
IG=function(a){switch(a.F){case tF:a:if(a.j.ended||a.K.N())var b=!0;else{if(a.isLive()){b=SB(a.f.presentationTimeline);var c=a.getBufferInfo();if(null!==c&&(c=c.ja(),null!==c&&c>=b)){b=!0;break a}}b=!1}break;default:b=!1}if(a.K){var d=a.K.aa();c=d.video;d=d.audio;var e=a.j.currentTime;c&&d?(c=c.ya(e),d=d.ya(e),c=Math.min(c,d)):c=c?c.ya(e):d?d.ya(e):0}else c=0;if(d=a.J){{d=a.J;var f=b;const g=d.f.get(d.a);e=d.a;c=f||c>=g?TG:HG;d.a=c;d=e!==c}}c=d;d=UG(a);c||a.getState()===_.Rn&&!d?(a.log.debug("Buffering state changed. Is buffering",
d,"buffered to end",b,"state",a.getState()),wG(a)):a.Qc&&FG(a)};FG=function(a){HF(a,EG(a))};UG=function(a){return a.w&&a.w.B?!0:a.J?a.J.getState()===HG:!1};zF=function(a){const b=uF(a);return b&&LD(a.N,b).variant};AF=function(a){const b=uF(a);if(null==b)return[];VG(a);return b.variants.filter(c=>fD(c))};WG=function(a){const b=uF(a);if(null==b)return[];VG(a);return b.textStreams.filter(c=>!a.Ed.has(c))};
vF=function(a,b,c,d){MD(a.N,b,c);if(b=a.getTrackManager())GD(b,c,d),c=b.Ia(),a=a.G.B,a.h!==c&&(a.h=c,a.a.push({timestamp:Date.now()/1E3,id:c.id,trackId:c.track.id,type:c.track.type,fromAdaptation:d,width:null,height:null,bandwidth:null}))};wF=function(a,b){a.X?a.Z=b:_.QE(a.a,b,!0,0)};
xF=function(a,b,c,d){var e=a.getTrackManager();a.A&&a.A.setCurrentVariant(c);if(e){var f=a.G.B;if(c.video){GD(e,c.video,d);var g=e.oa(),h=f;h.j!==g&&(h.j=g,h.a.push({timestamp:Date.now()/1E3,id:g.id,trackId:g.track.id,type:g.track.type,fromAdaptation:d,width:g.width,height:g.height,bandwidth:g.bandwidth}))}c.audio&&(GD(e,c.audio,d),e=e.Qa(),f.f!==e&&(f.f=e,f.a.push({timestamp:Date.now()/1E3,id:e.id,trackId:e.track.id,type:e.track.type,fromAdaptation:d,width:null,height:null,bandwidth:e.bandwidth})))}LD(a.N,
b).variant=c};yF=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?0:d;a.X?(a.ga=b,a.Rf=c,a.Qf=d):RE(a.a,b,c,d)};CG=function(a){return a.W===_.tb&&"flat"===a.configuration.playlist.timeline};YG=function(a,b,c){c=void 0===c?!0:c;const d=BF(a,b.variants);a.Va=d&&d.audio&&d.audio.id;d&&(xF(a,b,d,!0),yF(a,d,c));(c=XG(a,b.textStreams))&&(a.configuration.streaming.alwaysStreamText||DD(a))&&(vF(a,b,c,!0),wF(a,c))};
GG=function(a,b){a=a.w?_.ah(a.w.W):{};var c=Object.keys(a);c=c.length&&"00"===c[0];let d=!1,e=!1;const f=[],g=[];for(const h of b){b=[];h.audio&&b.push(h.audio);h.video&&b.push(h.video);for(const k of b)k.keyId&&((b=a[c?"00":k.keyId])?YF.includes(b)&&(g.includes(b)||g.push(b)):f.includes(k.keyId)||f.push(k.keyId));h.allowedByApplication?h.allowedByKeySystem&&(d=!0):e=!0}if(!d)throw new _.H(_.F,4,4012,{hasAppRestrictions:e,missingKeys:f,restrictedKeyStatuses:g});};
VG=function(a){if(a.a&&a.f){var b=AE(a.a),c=uF(a);null!=b&&b===c&&(CE(a.a),DE(a.a),_.BE(a.a,_.G),LD(a.N,c),LD(a.N,c))}};EG=function(a){if(a.Xc)var b=!1;else if(a.j&&a.j.ended)b=!0;else{b=a.getMediaDuration();var c=a.getMediaPosition();b=a.Qc&&0<=c&&b<=c?!0:!1}return b?_.On:UG(a)||a.Xc?_.Rn:a.j&&a.j.paused?_.Yn:_.Zn};XG=function(a,b){return _.hD(b,a.cc,a.Cd,a.bc)[0]||null};
ZG=function(a,b){a.X=!0;a.h.disable();a.log.debug("Choosing new streams after period changed");let c=BF(a,b.variants),d=XG(a,b.textStreams);a.ga&&(b.variants.includes(a.ga)&&(c=a.ga),a.ga=null);a.Z&&(b.textStreams.includes(a.Z)&&(d=a.Z),a.Z=null);c&&KG(a,b,()=>xF(a,b,c,!0));d&&(a.configuration.streaming.alwaysStreamText||DD(a))&&KG(a,b,()=>vF(a,b,d,!0));b===uF(a)&&LG(a);return a.configuration.streaming.alwaysStreamText||DD(a)?{variant:c,text:d}:{variant:c,text:null}};
KG=function(a,b,c){a.mb.has(b)||a.mb.set(b,[]);a.mb.get(b).push(c)};LG=function(a){const b=uF(a);if(b){const c=a.mb.get(b)||[];for(a.mb.delete(b);c.length;)c.shift()()}};JG=function(a,b){for(const c of a.f.periods)if(c.variants.includes(b))return c;return null};
$G=function(a,b,c){return _.x(function*(){let d;try{d=yield _.yr(b.url,a.getNetworkEngine(),a.configuration.manifest.attemptParameters,b.type||null);d.configure(a.configuration.manifest);{var e=d,f=b.url;const D=DG(a,a.configuration.id||"");var g=e.start(f,D)}const h=yield g;sF(h.periods);if(!h.periods.length)throw new _.H(_.F,4,4014);yield a.A.stop();a.A=d;const k=c.audio&&c.audio.id,l=c.video&&c.video.id;a.f.periods=h.periods;const m=AB(h.periods,vC(a.B))||h.periods[0];jG(a)?YC(a.f,_.Ah(a.configuration.preferredVideoCodec),
_.Ah(a.configuration.preferredAudioCodec),a.configuration.preferredAudioChannelCount):XC(a.f,_.Ah(a.configuration.preferredVideoCodec),_.Ah(a.configuration.preferredAudioCodec),a.configuration.preferredAudioChannelCount);const n=mD(k,l,m.variants),q=XG(a,m.textStreams);BF(a,m.variants);const u=n&&n.video,v=n&&n.audio;g=[];const y=new Set;for(const D of m.variants)D.video&&y.add(D.video),D.audio&&y.add(D.audio);const B=a.getNetworkEngine();for(const D of[...y,...m.textStreams])g.push(D.createSegmentIndex(B));
yield Promise.all(g);YE(a.a,_.p,v);YE(a.a,_.w,u);YE(a.a,_.G,q);n&&xF(a,m,n,!1);a.log.info("Switch CDN successful.")}catch(h){throw d&&(yield d.stop()),h;}})};DG=function(a,b){return{networkingEngine:a.getNetworkEngine(),configurationId:b,filterNewPeriod:c=>mG(a,c),filterAllPeriods:c=>$F(a,c),onTimelineCueAdded:c=>{a.H&&(a.W===_.tb?a.ec.push(c):a.H.f(c))},onEvent:c=>a.ze(c),onError:c=>a.onError(c),onUpdate:c=>tG(a,c),onTurnedStatic:()=>uG(a)}};
aH=function(){const a=MediaSource.isTypeSupported,b=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=c=>{var d=c.split(/ *; */),e=d.shift();const f={};for(var g of d)d=g.split("\x3d"),f[d[0]]=d[1].replace(/"(.*)"/,"$1");g=f.codecs;if(!g)return a(c);let h=!1,k=!1;c=g.split(",").filter(l=>{b.test(l)&&(k=!0);/^(hev|hvc)1\.2/.test(l)&&(h=!0);return!0});k&&(h=!1);f.codecs=c.join(",");h&&(f.eotf="smpte2084");for(const l in f)e+="; "+l+'\x3d"'+f[l]+'"';return cast.__platform__.canDisplayType(e)}};
bH=function(){const a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=b=>"mp2t"===b.split(/ *; */)[0].split("/")[1].toLowerCase()?!1:a(b)};cH=function(){const a=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(...b){b=a.apply(this,b);b.abort=function(){};return b}};dH=function(){const a=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(b,c){return a.call(this,b,c-.001)}};
eH=function(){const a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=b=>"opus"!==_.qB(b)&&a(b)};fH=function(a,b){const c=a.mode;a.mode=c===_.Gf?_.Gf:_.$d;const d=a.cues;for(let e=d.length-1;0<=e;e--){const f=d[e];f&&b(f)&&a.removeCue(f)}a.mode=c};QA=[112,115,115,104,0,0,0,0];_.gH=class{constructor(a,b,c,d,e){this.Ra=a;this.xa=b;this.ma=c;this.keyInfo=d||null;this.xc=_.A(e)?!1:!!e}Tc(){return this.ma?this.ma-this.xa+1:null}f(){return this.keyInfo}};
_.bC=class{constructor(a,b,c,d,e,f,g,h=null,k=!1,l=null,m=null,n=null,q=null,u=[],v=null){this.position=a;this.startTime=b;this.endTime=c;this.Aa=g;this.Ra=d;this.xa=e;this.ma=f;this.keyInfo=h||null;this.xc=_.A(k)?!1:!!k;this.timescale=l;this.horizontalTiles=m;this.verticalTiles=n;this.durationPerTile=q;this.a=u||[];this.h=!1;this.initSegment=v}getPosition(){return this.position}Tc(){return this.ma?this.ma-this.xa+1:null}f(){return this.keyInfo}};
_.FF=class{constructor(a=null){this.j=a;this.log=new _.R("clpp.renditions");this.V=[];this.h=this.player=null;this.f=!1}track(a){null!=this.player&&vB(this);a&&(this.player=a,this.player.on(_.yf,this.a,this))}release(){vB(this);this.V=[];this.h=this.j=null}append(a,b,c=null){const d=this.j&&null!==c?this.j(c):null;d||this.log.debug("Unable to resolve rendition for ID",c);c={start:a,end:b,rendition:d,width:d?d.width:0,height:d?d.height:0,bandwidth:d?d.bandwidth:0};const e=this.V.find(f=>f.start>=a&&
f.end<=b);if(e)e.rendition=d,e.width=c.width,e.height=c.height,e.bandwidth=c.bandwidth,e.start=c.start,e.end=c.end;else{for(const f of this.V)a>=f.start&&a<f.end?f.end=a:b>=f.start&&b<f.end&&(f.start=b);this.V.push(c);this.V.sort(tB)}yB(this);this.a();this.player&&this.player.trigger(new _.E(_.ng))}clear(){this.V=[];yB(this);this.player&&(this.player.trigger(new _.E(_.ng)),this.player.trigger(new _.E(_.Lc)))}a(){if(this.player){var a=this.player.getMediaPosition();if(0<=a){a:{var b=this.V.length,
c=Number.MAX_SAFE_INTEGER;for(var d=0;d<b;d++){const e=this.V[d];c=Math.min(e.start,c);if(e.start<=a&&e.end>a){a=.1>e.end-a&&d<b-1?this.V[d+1].rendition:e.rendition;break a}if(e.start>a)break}a=0<b&&c>a&&.25>c-a?this.V[0].rendition:null}if(a&&this.h!==a&&(this.h=a,this.player)){c=b=-1;if(a)b=a.width||-1,c=a.height||-1;else if(d=this.player.getSurface().getMedia())b=d.videoWidth,c=d.videoHeight;this.player.trigger(new _.E(_.Nc,{detail:{width:b,height:c,bandwidth:a?a.bandwidth:null,rendition:a}}))}}}}};
_.hH=class{constructor(a){this.h=Math.exp(Math.log(.5)/a);this.f=this.a=0}};iH=class{constructor(a){this.a=this.h=0;this.f=a}rb(){return this.h}getDuration(){return this.f?this.a-this.h:Infinity}};
_.jH=class{constructor(a,b,c,d,e,f){f=void 0===f?!1:f;this.j=a;this.F=b;this.J=c;this.A=this.f=Infinity;this.h=1;this.G=0;this.o=this.w=null;this.H=0;this.C=this.l=d;this.L=void 0===e?!0:e;this.g=new _.R("clpp.media.PresentationTimeline");this.N=f;this.K=null;this.a=new iH(d);this.I=null;this.B=this.j.type||null}hc(){return this.K}getDuration(){return 2===this.j.version?this.a.getDuration():this.f}getPresentationStartTime(){return this.F}offset(a){null!=this.w&&(this.w+=a);null!=this.o&&(this.o+=
a)}isLive(){return 2===this.j.version?!this.a.f:Infinity===this.f&&!this.l}Zc(){return!this.l}};SF=class{constructor(){this.h=()=>{};this.a=new Set}release(){this.h=()=>{};this.a.clear()}clear(){this.a.clear()}f(a){a:{for(b of this.a)if(b.schemeIdUri===a.schemeIdUri&&b.startTime===a.startTime&&b.endTime===a.endTime&&b.configurationId===a.configurationId)break a;var b=null}null==b&&(this.a.add(a),this.h(a))}cues(){return this.a}};
QG=class{constructor(a,b,c,d){this.a=a;this.h=null;this.j=b;this.f=c;this.o=d;"flat"===d.timeline&&d.cropTimeline&&(a=d.startTime||0,this.j.a=new _.ru("crop",a,d.endTime?d.endTime-a:Infinity,!1))}release(){this.f=this.j=this.h=this.a=null}l(a){ZA(this.a,a);ZB(this)}};
eC=class{constructor(a,b,c){this.h=a;this.a=b;this.f=c;this.g=new _.R("clpp.media.SegmentIterator")}next(){var a=this.h.get(this.a);a&&0<a.a.length?(this.f+=1,a.Ra().length&&this.f===a.a.length&&(this.a+=1,this.f=0)):(this.a+=1,this.f=0);a=$B(this);return{value:a,done:!a}}};
_.kH=class{constructor(a){this.a=a;this.g=new _.R("clpp.media.SegmentIndex")}destroy(){this.a=[];return Promise.resolve()}find(a){for(var b=this.a.length-1;0<=b;--b){const c=this.a[b];if(a>=c.startTime&&a<c.endTime)return c.position}if(this.a.length&&a<this.a[0].startTime)return this.a[0].position;this.g.warn("No Segment found for "+a+". We have "+this.a.length+" references");for(a=0;a<this.a.length;a++)b=this.a[a],this.g.debug("SegmentIndex Ref "+a+" start: "+b.startTime+" end: "+b.endTime+" pos: "+
b.position);return null}get(a){if(0===this.a.length)return null;a-=this.a[0].position;return 0>a||a>=this.a.length?null:this.a[a]}offset(a){this.g.info("Apply offset"+a+" to segment index");for(const b of this.a)b.startTime+=a,b.endTime+=a,b.Aa-=a}f(a,b){a-=this.a[0].position;if(0<=a&&a<this.a.length)for(this.g.warn("Accounting for segment duration drift",b,"at",a),this.a[a].endTime+=b,a+=1;a<this.a.length;++a)this.a[a].startTime+=b,this.a[a].endTime+=b}getDuration(){return this.a[this.a.length-1].endTime-
this.a[0].startTime}replace(a){this.a=a}};pC=class{constructor(a,b){this.h=a;this.l=hC(a);this.a=a.a.currentTime;this.j=Date.now()/1E3;this.o=b;this.f=()=>{}}release(){this.h=null;this.f=()=>{}}};qC=class{constructor(a){this.a=a}};
lH=class{constructor(a,b,c,d,e){this.a=a;this.G=b;this.l=c;this.F=e;this.h=new _.ts;this.C=!1;this.I=a.readyState;this.j=!1;this.f=d;this.B=this.o=this.H=this.A=!1;this.h.on(a,_.vg,()=>iC(this));this.w=(new _.Tj(()=>{iC(this)})).kb(.25)}release(){this.h&&(this.h.release(),this.h=null);null!=this.w&&(this.w.stop(),this.w=null);this.f&&(this.f.release(),this.f=null);this.a=this.G=this.F=null;this.o=!1}Kd(){this.A=!0;iC(this)}};
mH=class{constructor(a,b){this.f=a;this.o=b;this.l=this.h=this.j=0;this.a=new _.Tj(()=>{0>=this.j?(_.C(["Failed to move playhead from",this.h,"to",this.l].join(" ")),this.a.stop()):this.f.currentTime!==this.h?this.a.stop():(this.f.currentTime=this.l,this.j--)})}release(){this.a&&(this.a.stop(),this.a=null);this.f=null}};
nH=class{constructor(a,b,c,d){this.a=a;this.j=b;this.o=d;this.A=c;this.l=!1;this.f=new _.ts;this.h=new mH(a,10);this.w=!1;0<a.readyState?lC(this,c):mC(this,c)}release(){this.f&&(this.f.release(),this.f=null);null!=this.h&&(this.h.release(),this.h=null);this.j=()=>{};this.a=null;this.o=()=>{};this.w=!1}};
MG=class{constructor(a,b,c,d,e,f,g){this.h=a;this.a=b.presentationTimeline;this.B=b.minBufferTime||0;this.l=c;this.A=e;this.w=null;this.j=new lH(a,b.presentationTimeline,c,rC(this,a,c),f);this.f=new nH(a,()=>{a:{var h=this.j;var k=h.B;h.B=!1;h.C=!0;h.A=!1;h.j=!1;h=k;k=nC(this.f);const l=wC(this,k);if(.001<Math.abs(l-k)){const m=(new Date).getTime()/1E3;if(!this.w||this.w<m-1){this.w=m;oC(this.f,l);h=void 0;break a}}this.g.debug("Seek to "+k);this.A(h?1:0);h=void 0}return h},uC(this,d,g),()=>{this.j.H=
!0});this.o=(new _.Tj(()=>{if(0!==this.h.readyState&&!this.h.paused){var h=nC(this.f),k=KB(this.a),l=UB(this.a);3>l-k&&(k=l-3);h<k&&(k=wC(this,h),this.g.info("Jumping forward "+(k-h)+" seconds to catch up with the seek range."),this.h.currentTime=k)}})).kb(.25);this.g=new _.R("clpp.mse.Playhead")}release(){this.f&&(this.f.release(),this.f=null);this.j&&(this.j.release(),this.j=null);this.o&&(this.o.stop(),this.o=null);this.h=this.f=this.a=this.l=null;this.A=()=>{}}};
NG=class{constructor(a){this.f=a;this.a=new Set;this.h=(new _.Tj(()=>{xC(this,!1)})).kb(.25)}release(){this.h.stop();for(const a of this.a)a.release();this.a.clear()}};
PG=class{constructor(a){this.j=a;this.o=new Map;this.a=()=>{};this.f=()=>{};this.h=()=>{};this.w=[{sc:null,rc:2,ic:(b,c)=>this.a(b,c)},{sc:1,rc:2,ic:(b,c)=>this.a(b,c)},{sc:3,rc:2,ic:(b,c)=>this.a(b,c)},{sc:2,rc:1,ic:(b,c)=>this.f(b,c)},{sc:2,rc:3,ic:(b,c)=>this.f(b,c)},{sc:1,rc:3,ic:(b,c)=>this.h(b,c)},{sc:3,rc:1,ic:(b,c)=>this.h(b,c)}]}release(){this.j=null;this.o.clear();this.a=()=>{};this.f=()=>{};this.h=()=>{}}l(a,b,c){if(this.j)for(const d of this.j.cues()){const e=this.o.get(d)||null,f=yC(d,
a);this.o.set(d,f);const g=this.w.find(h=>h.sc===e&&h.rc===f);g&&g.ic(d,b&&0===c)}}};_.oH=0;
pH=class{constructor(a,b){this.w=null;this.C=a;this.j=b;this.h=this.A=0;this.l=Infinity;this.f=this.a=null;this.B="";this.o=new Map}destroy(){this.j=this.w=null;this.o.clear();return Promise.resolve()}remove(a,b){return Promise.resolve().then(()=>{!this.j||!this.j.remove(a,b)||null==this.a||b<=this.a||a>=this.f||(a<=this.a&&b>=this.f?this.a=this.f=null:a<=this.a&&b<this.f?this.a=b:a>this.a&&b>=this.f&&(this.f=a))})}Ga(){return this.a}ja(){return this.f}tb(a){return null==this.a||null==this.f?!1:a>=
this.a&&a<this.f}ya(a){return null==this.f||this.f<a?0:this.f-Math.max(a,this.a)}};xG=class{constructor(){this.a=new muxjs.mp4.CaptionParser;this.l=[];this.j={}}init(a){const b=muxjs.mp4.probe;a=_.J(a);this.l=b.videoTrackIds(a);this.j=b.timescale(a)||{};this.a.init()}h(a,b){a=_.J(a);(a=this.a.parse(a,this.l,this.j))&&a.captions&&b(a.captions);this.a.clearParsedCaptions()}f(){this.a.resetCaptionStream()}};_.yG=class{init(){}h(){}f(){}};var IC;
_.AG=class{constructor(a,b,c,d,e){this.j=a;this.G=c;this.f={};this.O=!1;this.a=null;this.h={};this.l=new _.ts;this.J=!1;this.w={};this.I=b;this.F=d;this.S=e;this.Va=this.S.streaming.maxSegmentToMediaOffset||1;this.K=new _.dn;this.B="";this.H={};this.o=JC(this,this.K);this.T=!0;this.g=new _.R("clpp.mse.MediaSourceEngine")}destroy(){this.J=!0;const a=[];for(const c in this.h){const d=this.h[c];var b=d[0];this.h[c]=d.slice(0,1);b&&a.push(b.p.catch(bB));for(b=1;b<d.length;++b)d[b].p.catch(bB),d[b].p.reject()}this.a&&
a.push(this.a.destroy());this.G&&a.push(this.G.destroy());for(const c in this.w)this.w[c].destroy(),delete this.w[c];return Promise.all(a).then(()=>{this.l&&(this.l.release(),this.l=null);this.j&&(this.j.removeAttribute("src"),this.j.load(),this.j=null);this.B="";this.G=this.a=this.o=null;this.f={};this.w={};this.H={};this.I=null;this.O=!1;for(const c in this.h);this.h={}})}open(){return this.K}init(a,b,c){c=void 0===c?!1:c;const d=this;return _.x(function*(){yield d.K;a.forEach((e,f)=>{const g=_.Nj(e.mimeType,
e.codecs);if(f===_.G)d.A(g);else{var h=new Map;h.set(f,g);_.Vp(g)&&b&&!e.keyInfo||!_.Mj(g,f)||!(e=_.Mj(g))||(h=e(),d.w[f]=h,h=h.demuxMimeTypes(f,g),c&&h.delete(_.p));KC(d,h)}})})}Na(){this.g.debug(kA);Object.values(this.w).forEach(a=>a.reset())}Ma(){return this.S.streaming.ignoreManagedMediaSourceStreamingHints?!0:this.T}A(a){this.a||(this.a=new pH(this.S,this.G));DC(this.a,a)}N(){return this.o?this.o.readyState===_.Vd:!0}Ga(a){return a===_.G?this.a.Ga():(a=LC(this,a))?a.Ga():null}ja(a){return a===
_.G?this.a.ja():(a=LC(this,a))?a.ja():null}tb(a,b,c){return a===_.G?this.a.tb(b):(a=LC(this,a))?a.tb(b,!1,c):!1}ya(a,b){return a===_.G?this.a.ya(b):(a=LC(this,a))?a.ya(b):0}aa(){const a={};a.total=new _.et(this.j.buffered,"total");a.audio=LC(this,_.p);a.video=LC(this,_.w);let b=[];this.a&&(b=[{start:this.a.Ga(),end:this.a.ja()}]);a.text=rB(b,_.G);return a}L(a,b,c,d,e,f,g){g=void 0===g?!1:g;const h=this.f[a];let k=-1,l=0;h&&h.buffered&&(l=h.buffered.length);a===_.w&&null!==c&&null!==d&&g&&(k=0<l?h.buffered.end(l-
1):-1);a===_.G?b=EC(this.a,b,c,d):this.w[a]?(b=this.w[a].transmux(b),b.captions&&0<b.captions.length&&(this.a||this.A(_.Vf),GC(this.a,b.captions,c,d,this.f.video.timestampOffset)),e=[],0<b.audio.byteLength&&this.f.audio&&e.push(OC(this,_.p,this.W.bind(this,_.p,b.audio.buffer))),0<b.video.byteLength&&this.f.video&&e.push(OC(this,_.w,this.W.bind(this,_.w,b.video.buffer))),b=Promise.all(e)):(e&&window.muxjs&&(this.a||this.A(_.Vf),null==c&&null==d?this.I.init(b):this.I.h(b,m=>{m.length&&GC(this.a,m,c,
d,this.f.video.timestampOffset)})),b=OC(this,a,this.W.bind(this,a,b)));return b.then(()=>{if(a===_.w&&null!==c&&null!==d&&!g)this.F.append(c,d,f),null!==c&&null!==d&&this.g.debug(Kz,c,d,Mz,MC(this,a));else if(a===_.p&&null!==c&&null!==d)wB(this.F),null!==c&&null!==d&&this.g.debug(Jz,c,d,Mz,MC(this,a));else if(a===_.w&&null!==c&&null!==d&&g){var m=h.buffered.length,n=0<m?h.buffered.end(m-1):-1;0>k&&0<m&&(k=h.buffered.start(0));0<=k&&0<n&&this.F.append(k,n,f)}if(!this.H[a]&&h&&1===h.buffered.length){m=
h.buffered.start(0);const q=c-m;if(Math.abs(q)>this.Va&&0===h.timestampOffset)return this.g.warn(`Detected a delta of ${q} between `+`media times and segment times for ${a}. `+`The segment start time is ${c} and the media start time `+`is ${m}. Adjusting timestampOffset.`),m=OC(this,a,()=>{this.la(a,q)}),n=OC(this,a,this.X.bind(this,a,!1)),Promise.all([m,n])}null!==c&&null!==d&&(this.H[a]=!0)}).catch(m=>{throw m;})}Fa(a){const b=this.ja(_.w)||0;FC(this.a,a,b)}ga(){this.a&&FC(this.a,"",0)}remove(a,
b,c){return a===_.G?this.a.remove(b,c):OC(this,a,this.ea.bind(this,a,b,c)).then(()=>{if(a===_.w){const d=this.Ga(a),e=this.ja(a);null!==d&&null!==e&&zB(this.F,d,e)}else a===_.p&&xB(this.F)})}clear(a){if(a===_.G){if(!this.a)return Promise.resolve();this.I.f();return this.a.remove(0,Infinity)}return OC(this,a,this.ea.bind(this,a,0,this.o.duration))}flush(a){return a===_.G?Promise.resolve():OC(this,a,this.X.bind(this,a))}Oa(a,b,c,d){const e=this;return _.x(function*(){if(a===_.G){e.a.A=b;var f=e.a;f.h=
c;f.l=d}else f=PC(e,a,b,c,d),e.O&&(f=f.concat(PC(e,_.p,b,c,d))),yield Promise.all(f)})}endOfStream(a){return RC(this,()=>{this.N()||(a?this.o.endOfStream(a):this.o.endOfStream())})}Z(a){RC(this,()=>{this.o.duration=a})}getDuration(){return this.o.duration}W(a,b){this.g.debug(Lz+a+Cz);try{this.f[a].appendBuffer(b)}catch(c){throw this.g.warn(Vz+a,c),c;}this.g.debug(Pz+a+Cz)}ea(a,b,c){if(c<=b)this.C(a);else{this.g.debug(jA+a+Fz,b,c);try{this.f[a].remove(b,c)}catch(d){throw this.g.warn(Xz+a+Dz,b,c,d),
d;}this.g.debug(Rz+a+Fz,b,c)}}lb(a){try{this.g.debug(Iz+a+Cz);const b=this.f[a].appendWindowStart,c=this.f[a].appendWindowEnd;this.f[a].abort();this.f[a].appendWindowStart=b;this.f[a].appendWindowEnd=c}catch(b){throw this.g.warn(Uz+a+Cz,b),b;}this.g.debug(Oz+a+Cz);this.C(a)}X(a){try{this.j.readyState>HTMLMediaElement.HAVE_NOTHING?(this.g.debug($z+a),this.j.currentTime-=.001):this.g.warn(oA+a+Gz+this.j.readyState)}catch(b){throw this.g.warn(Wz+a,b),b;}this.g.debug(Qz+a);this.C(a)}la(a,b){0>b&&(b+=
.001);try{this.g.debug(nA+a,b),this.f[a].timestampOffset=b}catch(c){throw this.g.warn(Zz+a,b,c),c;}this.g.debug(Tz+a,b);this.C(a)}mb(a,b,c){try{this.g.debug(lA+a,b,c),this.f[a].appendWindowStart=0,this.f[a].appendWindowEnd=c,this.f[a].appendWindowStart=b}catch(d){throw this.g.warn(Yz+a,b,c,d),d;}this.g.debug(Sz+a,b,c);this.C(a)}U(a){this.h[a][0].p.reject(new _.H(_.F,3,3014,{mediaError:this.j.error?this.j.error.code:0}))}C(a){const b=this.h[a][0];b&&(b.p.resolve(),this.g.debug(qA+a),QC(this,a))}getTextDisplayer(){return this.G}};
IC=window.URL.createObjectURL;var V=class extends _.S{constructor(){super();this.g=new _.R("cl.api.mse.TrackManager");this.m=null;this.h=[];this.a=new Map;this.f=new Map}initialize(a){this.m=a}release(){this.h=[];this.a.clear();this.f.clear()}load(){}destroy(){this.release();this.m=null}getVideoTracks(){return tD(this,_.N)}getAudioTracks(){return tD(this,_.L)}ka(){return tD(this,_.K)}oa(){return this.a.get(_.N)||null}Qa(){return this.a.get(_.L)||null}Ia(){return this.a.get(_.K)||null}cb(){return this.f.get(_.N)||null}ob(){return this.f.get(_.L)||
null}pb(){return this.f.get(_.K)||null}Ja(){return uD(this,_.N)}na(){return uD(this,_.L)}ua(){return uD(this,_.K)}jb(a){wD(this,_.N,a)}wa(a){wD(this,_.L,a)}La(a){wD(this,_.K,a)}Ya(a,b){vD(this,_.N,a,void 0===b?!1:b)}hb(a,b){vD(this,_.L,a,void 0===b?!1:b)}ib(a,b){b=void 0===b?!1:b;let c=a;if(!a){const d=this.Ia();if(d&&d.track.kind!==_.Wd){a=this.ka().find(e=>e.kind===_.Wd&&e.language===d.track.language);if(!a){const e=this.na();e&&(a=this.ka().find(f=>f.kind===_.Wd&&f.language===e.language))}a&&(c=
a.renditions[0])}}vD(this,_.K,c,b)}addTextTrack(a){const b=this;return _.x(function*(){b.m&&(yield b.m.addTextTrack(a.url,a.language,a.kind,a.mimeType,a.codec,a.label))})}ra(){return!!this.m&&this.m.ra()}};V.prototype.isAbrEnabled=V.prototype.ra;V.prototype.addTextTrack=V.prototype.addTextTrack;V.prototype.setTextRendition=V.prototype.ib;V.prototype.setAudioRendition=V.prototype.hb;V.prototype.setVideoRendition=V.prototype.Ya;V.prototype.setTextTrack=V.prototype.La;V.prototype.setAudioTrack=V.prototype.wa;
V.prototype.setVideoTrack=V.prototype.jb;V.prototype.getTextTrack=V.prototype.ua;V.prototype.getAudioTrack=V.prototype.na;V.prototype.getVideoTrack=V.prototype.Ja;V.prototype.getLoadingTextRendition=V.prototype.pb;V.prototype.getLoadingAudioRendition=V.prototype.ob;V.prototype.getLoadingVideoRendition=V.prototype.cb;V.prototype.getTextRendition=V.prototype.Ia;V.prototype.getAudioRendition=V.prototype.Qa;V.prototype.getVideoRendition=V.prototype.oa;V.prototype.getTextTracks=V.prototype.ka;
V.prototype.getAudioTracks=V.prototype.getAudioTracks;V.prototype.getVideoTracks=V.prototype.getVideoTracks;var qH=class{constructor(){this.f=new _.hH(2);this.h=new _.hH(5);this.a=0}};_.rH=class{constructor(){this.g=new _.R("clpp.abr");this.w=null;this.h=!1;this.o=new qH;this.l=[];this.j=1;this.C=this.B=!1;this.A=this.a=this.f=null}stop(){this.w=null;this.h=!1;this.l=[];this.j=1;this.f=null;this.C=!1}init(a){this.w=a}chooseVariant(){var a=HD(!this.C&&this.a.initialRestrictions?this.a.initialRestrictions:this.a.restrictions,this.l);const b=this.getBandwidthEstimate();this.l.length&&!a.length&&(this.g.warn("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),
a=HD(null,this.l),a=[a[0]]);let c=a[0]||null;for(const {item:e,next:f}of _.iB(a)){var d=isNaN(this.j)||0===this.j?1:Math.abs(this.j);a=d*e.bandwidth;const g=a/this.a.bandwidthDowngradeTarget;d=d*(f||{bandwidth:Infinity}).bandwidth/this.a.bandwidthUpgradeTarget;this.g.debug("Bandwidth ranges:",(a/1E6).toFixed(3),(g/1E6).toFixed(3),(d/1E6).toFixed(3));b>=g&&b<=d&&(c=e)}this.f=Date.now();this.C=!0;return c}enable(){this.h=!0}disable(){this.h=!1}segmentDownloaded(a,b){this.g.debug("Segment downloaded:",
"deltaTimeMs\x3d"+a,"numBytes\x3d"+b,"lastTimeChosenMs\x3d"+this.f,"enabled\x3d"+this.h);var c=this.o;if(!(16E3>b)){var d=8E3*b/a;a/=1E3;c.a+=b;_.FB(c.f,a,d);_.FB(c.h,a,d)}if(null!=this.f&&this.h)a:{this.g.debug("Suggesting Streams...");if(!this.B){if(!(128E3<=this.o.a)){this.g.debug("Still waiting for a good estimate...");break a}this.B=!0;if(this.a.useSwitchIntervalForInitialSwitch&&Date.now()-this.f<1E3*this.a.switchInterval){this.g.debug("Skipping initial estimation switch due to switch interval...");
break a}}else if(Date.now()-this.f<1E3*this.a.switchInterval){this.g.debug("Still within switch interval...");break a}b=this.chooseVariant();c=this.getBandwidthEstimate();this.g.debug("Calling switch_(), bandwidth\x3d"+Math.round(c/1E3)+" kbps");b&&this.w(b)}}playbackRateChanged(a){this.j=a}getBandwidthEstimate(){var a=this.A&&this.A.kf();a||(a=this.o,a=128E3>a.a?this.a.defaultBandwidthEstimate:Math.min(_.GB(a.f),_.GB(a.h)));return a}setVariants(a){this.l=a}setCmsdManager(a){this.A=a}configure(a){this.a=
a}reset(){this.B=!1;this.o=new qH;const a=this.chooseVariant();a&&this.w(a)}};var sH=class{constructor(){this.a=null}};var tH=class{constructor(){this.a=new Map}clear(){this.a.clear()}},KD=class{constructor(){this.text=this.variant=null}};var uH=class{constructor(a,b){this.f=a;this.a=new Set([a]);b=b||[];for(const c of b)this.add(c)}add(a,b){b=void 0===b?!0:b;if(PD(this.f,a,void 0===b?!0:b))return this.a.add(a),!0;_.C("Dropping variant due to incompatible codecs for the current adaptation set. This may be because CodecSwitchingStrategy is set to PREVENT or SourceBuffer.changeType() is not available on this platform. Variant dropped:",a,"because it is not compatible with",this.f);return!1}values(){return this.a.values()}};var DF=class{constructor(a,b){b=void 0===b?_.of:b;this.f=a;this.a=b;this.h=new dG(a.language,"",a.audio&&a.audio.channelsCount?a.audio.channelsCount:0,!1,b)}create(a){const b=this.a===_.Kf&&sB(),c=a.filter(d=>PD(this.f,d,!b));return c.length?new uH(c[0],c):this.h.create(a)}},dG=class{constructor(a,b,c,d,e){this.j=_.Ah(a);this.a=b;this.f=c;this.l=void 0===d?!1:d;this.h=void 0===e?_.of:e}create(a){var b=QD(a,this.j);0<b.length&&(a=b);b=!1;if(this.a){var c=RD(a,this.a);0<c.length?(a=c,b=!0):_.C("No exact match for preferred variant role could be "+
`found. Role: ${this.a}`)}b||(b=a.filter(d=>d.primary),0<b.length&&(a=b));this.f&&(b=TC(a,this.f),b.length?a=b:_.C("No exact match for the channel count could be found."));b=SD(a,this.l);b.length?a=b:_.C("No exact match for spatial audio could be found.");b=this.h===_.Kf&&sB();c=new uH(a[0]);for(const d of a)c.add(d,!b);return c}};var RG=class{constructor(a,b){this.a=TG;this.f=(new Map).set(TG,b).set(HG,a)}getState(){return this.a}},HG=0,TG=1;var hG=class{constructor(a){this.D=a;this.a=a.getConfiguration().streaming;this.f=new _.ts;this.g=new _.R("clpp.mse.media.LiveEdgeObserver");TD(this)&&(a=this.D.getSurface().getMedia(),this.f.on(a,_.Xf,()=>{{var b=this.D.getPosition();const c=this.D.getSeekRange().end;b=c-b;const d=this.D.getPlaybackRate(),e=this.a.stopChasingAt;1<=d&&b>=this.a.chaseJumpDistance?(this.g.debug("Too far from edge, jump to beginning."),this.D.setPlaybackRate(1),this.D.seek(c)):1===d&&b>=this.a.startChasingAt?(this.g.debug("Not on live edge, increase playback rate."),
this.D.setPlaybackRate(this.a.chasingRate,_.Dd)):1<d&&b<=e&&(this.g.debug("On live edge, reduce playback rate."),this.D.setPlaybackRate(1))}}))}release(){this.f.release()}};var zG=class{constructor(a,b,c,d,e){this.j=a;this.G=c;this.a={};this.H={};this.T=!1;this.f=null;this.h={};this.l=new _.ts;this.O=!1;this.w={};this.J=b;this.F=d;this.K=e;this.Va=this.K.streaming.maxSegmentToMediaOffset||1;this.S=new _.dn;this.B="";this.I={};this.o=VD(this,this.S);this.W=!0;this.g=new _.R("clpp.mse.MediaSourceEngineSmooth")}destroy(){this.O=!0;const a=[];for(const c in this.h){const d=this.h[c];var b=d[0];this.h[c]=d.slice(0,1);b&&a.push(b.p.catch(bB));for(b=1;b<d.length;++b)d[b].p.catch(bB),
d[b].p.reject()}this.f&&a.push(this.f.destroy());this.G&&a.push(this.G.destroy());for(const c in this.w)this.w[c].destroy(),delete this.w[c];return Promise.all(a).then(()=>{this.l&&(this.l.release(),this.l=null);this.j&&(this.j.removeAttribute("src"),this.j.load(),this.j=null);this.B="";this.G=this.f=this.o=null;this.a={};this.w={};this.I={};this.J=null;this.T=!1;for(const c in this.h);this.h={}})}open(){return this.S}init(a,b,c){c=void 0===c?!1:c;const d=this;return _.x(function*(){yield d.S;a.forEach((e,
f)=>{const g=_.Nj(e.mimeType,e.codecs);if(f===_.G)d.A(g);else{var h=new Map;h.set(f,g);_.Vp(g)&&b&&!e.keyInfo||!_.Mj(g,f)||!(e=_.Mj(g))||(h=e(),d.w[f]=h,h=h.demuxMimeTypes(f,g),c&&h.delete(_.p));WD(d,h)}d.h[f]=[]})})}Na(){this.g.debug(kA);Object.values(this.w).forEach(a=>a.reset())}Ma(){return this.K.streaming.ignoreManagedMediaSourceStreamingHints?!0:this.W}A(a){this.f||(this.f=new pH(this.K,this.G));DC(this.f,a)}N(){return this.o?this.o.readyState===_.Vd:!0}Ga(a){return a===_.G?this.f.Ga():(a=XD(this,
a))?a.Ga():null}ja(a){return a===_.G?this.f.ja():(a=XD(this,a))?a.ja():null}tb(a,b,c){return a===_.G?this.f.tb(b):(a=XD(this,a))?a.tb(b,!1,c):!1}ya(a,b){return a===_.G?this.f.ya(b):(a=XD(this,a))?a.ya(b):0}aa(){const a={};a.total=new _.et(this.j.buffered,"total");a.audio=XD(this,_.p);a.video=XD(this,_.w);let b=[];this.f&&(b=[{start:this.f.Ga(),end:this.f.ja()}]);a.text=rB(b,_.G);return a}L(a,b,c,d,e,f,g){g=void 0===g?!1:g;const h=this.a[a];let k=-1,l=0;h&&h.buffered&&(l=h.buffered.length);a===_.w&&
null!==c&&null!==d&&g&&(k=0<l?h.buffered.end(l-1):-1);a===_.G?b=EC(this.f,b,c,d):this.w[a]?(b=this.w[a].transmux(b),b.captions&&0<b.captions.length&&(this.f||this.A(_.Vf),GC(this.f,b.captions,c,d,this.a.video.timestampOffset)),e=[],0<b.audio.byteLength&&this.a.audio&&e.push($D(this,_.p,this.X.bind(this,_.p,b.audio.buffer))),0<b.video.byteLength&&this.a.video&&e.push($D(this,_.w,this.X.bind(this,_.w,b.video.buffer))),b=Promise.all(e)):(e&&window.muxjs&&(this.f||this.A(_.Vf),null==c&&null==d?this.J.init(b):
this.J.h(b,m=>{m.length&&GC(this.f,m,c,d,this.a.video.timestampOffset)})),b=$D(this,a,this.X.bind(this,a,b)));return b.then(()=>{if(a===_.w&&null!==c&&null!==d&&!g)this.F.append(c,d,f),null!==c&&null!==d&&this.g.debug(Kz,c,d,Mz,YD(this,a));else if(a===_.p&&null!==c&&null!==d)wB(this.F),null!==c&&null!==d&&this.g.debug(Jz,c,d,Mz,YD(this,a));else if(a===_.w&&null!==c&&null!==d&&g){var m=h.buffered.length,n=0<m?h.buffered.end(m-1):-1;0>k&&0<m&&(k=h.buffered.start(0));0<=k&&0<n&&this.F.append(k,n,f)}if(!this.I[a]&&
h&&1===h.buffered.length){m=h.buffered.start(0);const q=c-m;if(Math.abs(q)>this.Va&&0===h.timestampOffset)return this.g.warn(`Detected a delta of ${q} between `+`media times and segment times for ${a}. `+`The segment start time is ${c} and the media start time `+`is ${m}. Adjusting timestampOffset.`),m=$D(this,a,()=>{aE(this,a,q)}),n=$D(this,a,this.ea.bind(this,a,!1)),Promise.all([m,n])}null!==c&&null!==d&&(this.I[a]=!0)}).catch(m=>{throw m;})}Fa(a){const b=this.ja(_.w)||0;FC(this.f,a,b)}ga(){this.f&&
FC(this.f,"",0)}remove(a,b,c){return a===_.G?this.f.remove(b,c):$D(this,a,this.la.bind(this,a,b,c)).then(()=>{if(a===_.w){const d=this.Ga(a),e=this.ja(a);null!==d&&null!==e&&zB(this.F,d,e)}else a===_.p&&xB(this.F)})}clear(a){if(a===_.G){if(!this.f)return Promise.resolve();this.J.f();return this.f.remove(0,Infinity)}return $D(this,a,this.la.bind(this,a,0,this.o.duration))}flush(a){return a===_.G?Promise.resolve():$D(this,a,this.ea.bind(this,a))}Oa(a,b,c,d,e,f){const g=this;return _.x(function*(){if(a===
_.G){g.f.A=b;var h=g.f;h.h=c;h.l=d}else{h=yield cE(g,a,e,f);var k=dE(g,a,b,c,d,h);g.T&&(k=k.concat(dE(g,_.p,b,c,d,h)));yield Promise.all(k)}})}endOfStream(a){return fE(this,()=>{this.N()||(a?this.o.endOfStream(a):this.o.endOfStream())})}Z(a){fE(this,()=>{this.o.duration=a})}getDuration(){return this.o.duration}X(a,b){this.g.debug(Lz+a+Cz);try{this.a[a].appendBuffer(b)}catch(c){throw this.g.warn(Vz+a,c),c;}this.g.debug(Pz+a+Cz)}la(a,b,c){if(c<=b)this.C(a);else{this.g.debug(jA+a+Fz,b,c);try{this.a[a].remove(b,
c)}catch(d){throw this.g.warn(Xz+a+Dz,b,c,d),d;}this.g.debug(Rz+a+Fz,b,c)}}ea(a){try{this.j.readyState>HTMLMediaElement.HAVE_NOTHING?(this.g.debug($z+a),this.j.currentTime-=.001):this.g.warn(oA+a+Gz+this.j.readyState)}catch(b){throw this.g.warn(Wz+a,b),b;}this.g.debug(Qz+a);this.C(a)}U(a){this.h[a][0].p.reject(new _.H(_.F,3,3014,{mediaError:this.j.error?this.j.error.code:0}))}C(a){const b=this.h[a][0];b&&(b.p.resolve(),this.g.debug(qA+a),eE(this,a))}getTextDisplayer(){return this.G}},UD=window.URL.createObjectURL;var OG=class{constructor(a){this.h=a;this.a=null;this.f=()=>{}}release(){this.a=this.h=null;this.f=()=>{}}l(a){const b=this.a;{const c=this.h.periods;a=AB(c,a)||c[0]}b!==a&&this.f(a);this.a=a}};var gG=class{constructor(a){this.f=a;this.o=this.A=this.l=!1;this.h=this.f.nf();this.w=_.Dd;this.j=null;this.a=new _.Tj(()=>{this.A||this.f.$g(.25*this.h)});this.g=new _.R("clpp.mse.media.PlayRateController")}getConfiguration(){return this.j}release(){this.a&&(this.a.stop(),this.a=null);this.f=null}set(a,b){this.h=a;kE(this,b)}};var nE=new _.zt(()=>new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));_.SG=class{constructor(a,b){this.D=b;this.j=a;this.h=null;this.w=1;this.F=Promise.resolve();this.l=[];this.o=new Map;this.a=new Map;this.H=this.f=this.A=this.B=!1;this.G=0;this.g=new _.R("clpp.mse.Streaming");this.C=!1}destroy(){const a=this;return _.x(function*(){const b=[];for(const c of a.a.values())rE(c),b.push(sE(c));yield Promise.all(b);a.a.clear();a.o.clear();a.D=null;a.j=null;a.F=null;a.l=null;a.h=null;a.f=!0})}start(){const a=this;return _.x(function*(){const b=a.D.Db();var c=uE(a,b);c=a.D.oe(tE(a)[c]);
if(!c.variant&&!c.text)throw a.g.error("start(): No streams chosen"),new _.H(_.F,5,5005,"No streams chosen.");a.C=!c.variant&&!!c.text;yield zE(a,c.variant?c.variant.audio:null,c.variant?c.variant.video:null,c.text,b);a.f||(a.g.debug("init: completed initial Stream setup"),a.D&&a.D.ah&&(a.g.debug("init: calling onInitialStreamsSetup()..."),a.D.ah()))})}resume(){if(!VE(this))for(const a of this.a.values())a.endOfStream=!1,yE(this,a,0)}Hb(a){const b=this;return _.x(function*(){if(!b.f){var c=pE(a);
if(!a.fb&&null!=a.$a&&!a.ac)if(a.$a=null,a.Mb)b.g.debug(c,"skipping update and clearing the buffer"),yield PE(b,a,a.Pd,a.rd);else{try{const d=eF(b,a);null!=d&&(yE(b,a,d),a.Cc=!1)}catch(d){yield fF(b,d);return}gF(b,a);if(WE(b))if(b.D.configuration.Sg){b.g.debug("End of stream reached, keeping MediaSource open.");for(const d of b.a.values())d.$a=null}else b.g.debug("End of stream reached, calling ms.endOfStream()."),yield b.D.$.endOfStream(),b.f||(c=b.D.$.getDuration(),c<b.j.presentationTimeline.getDuration()&&
(b.j.presentationTimeline.f=c),b.D.zf())}}})}I(a,b,c,d){const e=PA(d.reader),f=PA(d.reader),g=_.P(d.reader),h=_.P(d.reader),k=_.P(d.reader),l=_.P(d.reader);d=_.Cl(d.reader,d.reader.Ha()-d.reader.getPosition());a=a.startTime+b.startTime+h/g;c.includes(e)&&("urn:mpeg:dash:event:2012"===e?this.D.Cf():(c=new _.E("emsg",{detail:{startTime:a,endTime:a+k/g,schemeIdUri:e,value:f,timescale:g,presentationTimeDelta:h,eventDuration:k,id:l,messageData:d}}),this.D.onEvent(c)))}J(a){let b=!1,c=0;(new _.Ml).M(_.Be,
_.Fl).M(_.Yf,_.Fl).M(_.we,_.Fl).M(_.Ae,_.Fl).M(_.Pf,_.Fl).ca(_.Rf,_.Gl).M("encv",d=>{d.reader.skip(78);_.Fl(d)}).M("pasp",d=>{c=d.start+d.headerSize;const e=_.P(d.reader),f=_.P(d.reader);b=e!==f;this.g.debug(`hSpacing=${e}, vSpacing=${f}, updatePASP=${b}`);d.parser.stop()}).parse(a.data);b&&(a=new _.Ol(new DataView(a.data)),a.seek(c),_.O(a,1),_.O(a,1))}};var vH=class{constructor(){this.a=null}};var wH=class extends _.it{constructor(){super(xA);this.F=vG;this.j=this.aa=null;this.He=0;this.Nf=2;this.Ob=null;this.we=!1;this.o=new _.ts;this.Ma=this.Dd=this.I=this.lb=this.B=this.K=this.w=null;this.Qc=!1;this.f=this.A=this.a=this.H=this.J=null;this.h=new _.rH;this.S=null;this.Oe=1E9;this.Ed=new Set;this.X=!0;this.ga=null;this.Rf=!1;this.Qf=0;this.Z=null;this.N=new tH;this.Sf={width:Infinity,height:Infinity};this.G=null;this.Fa=_.Wn;this.Oa=new dG(this.configuration.preferredAudioLanguage||[],
this.configuration.preferredAudioRole,this.configuration.preferredAudioChannelCount,this.configuration.preferSpatialAudio,this.configuration.mediaSource.codecSwitchingStrategy);this.cc=this.configuration.preferredTextLanguage;this.l=new sH;this.T=this.Va=null;this.mb=new Map;this.ea=null;this.Cd=this.configuration.preferredTextRole;this.bc=this.configuration.preferForcedSubtitles;this.o.on(window,"online",()=>{this.F===tF&&UE(this.a)});this.Fd=this.Na=this.Hd=null;this.W=_.na;this.Vc=new vH;this.ec=
[]}init(a,b){const c=a.getMedia();super.init(a,b);EF(this,c)}namespace(){return xA}Pf(){return new V}getState(){return this.Fa}getDrmInfo(){return this.w?this.w.getDrmInfo():null}unload(){const a=this;return _.x(function*(){yD(a,!1);a.Qc=!1;if(a.da){a.log.debug("Unload player with source",a.da);var b=a.getTrackManager();b&&b.release();a.F!==OF&&(yield MF(a),a.da=null,a.He=0,a.Va=null,a.T=null)}})}release(){const a=this;return _.x(function*(){if(a.aa)return a.aa;a.aa=NF(a);a.aa.finally(()=>{a.aa=null});
return a.aa})}getBufferInfo(a){if(this.K){var b=this.K.aa();const c=new _.et(void 0,a);switch(a){case _.N:return b.video?b.video:c;case _.L:return b.audio?b.audio:c;case _.K:return b.text?b.text:c}return b.total?b.total:c}return this.Ob?(b=uB(this.Ob),rB(b,a)):super.getBufferInfo(a)}getPosition(){var a=this.Vc,b=this.getMediaPosition();a.a&&(a=a.a,b-=a.f,b=0>b?0:b>a.a?a.a:b);return b}getMediaPosition(){return this.B?vC(this.B):super.getMediaPosition()}seek(a){var b=this.Vc;b=b.a?a+b.a.rb():a;b!==
a&&this.log.info(`Seeking to ${a} s corresponding to `+`media time of ${b} s.`);return super.seek(b)}getPresentationStartTime(){return this.f?this.f.presentationTimeline.getPresentationStartTime():null}getDuration(){var a=this.Vc,b=this.getMediaDuration();return a.a?a.a.getDuration():b}getMediaDuration(){return this.f?this.f.presentationTimeline.getDuration():Infinity}destroy(){const a=this,b=()=>Object.getPrototypeOf(Object.getPrototypeOf(this)).destroy;return _.x(function*(){yield b().call(a);a.F!==
OF&&(a.log.debug("Destroying player..."),a.F=OF,KF(a),a.o&&(a.o.release(),a.o=null),a.S&&(a.S.release(),a.S=null),a.Na=null,a.h=null)})}getTimeline(){return this.Na}setupPlaylist(a){const b=this;return _.x(function*(){const c=new _.dn;b.l.a=c;try{IF(b);b.W=_.tb;yield PF(b);JD(b.l,c);const d=a[0];d.playlist&&d.playlist.startTime&&(d.startTime=d.playlist.startTime);b.da=_.bo(d);b.configuration=_.Wk(b.la,d);b.log.info("Loading playlist configurations",a);b.Na=QF(b.configuration);yield UF(b,c);JD(b.l,
c);const e=a.map(n=>XF(b,n,0,null,!0)),f=yield Promise.all(e),g=f.filter(n=>n.manifest.presentationTimeline.isLive()),h=g[0];h&&(b.A=h.parser);if(1<g.length)throw new _.H(_.F,7,7003,"Playlist of multiple live streams is not supported.");if(h){const n=b.configuration.playlist.content;if(n===_.Tb)throw new _.H(_.F,7,7003,"Cannot play live content in VOD mode.");if("IPR"===n&&h!==f[f.length-1])throw new _.H(_.F,7,7003,"Wrong order of playlist assets.");}const k=new _.jH({version:2},null,0,null==h),l=
f.map(n=>pD(n.manifest)),m=rD(l,k);b.f=m;b.w=yield aG(b,m,b.configuration.drm);JD(b.l,c);yield nG(b,c);JD(b.l,c);SE(b.a,m);pG(b,m);c.resolve()}catch(d){b.A&&(yield b.A.stop(),b.A=null),rG(b,d,c)}})}appendLoad(a){const b=this;return _.x(function*(){IF(b);if(b.W!==_.tb)throw new _.H(_.F,7,7003,"Cannot append-load to non-playlist player.");const c=yield sG(b,a);b.f=c.manifest;b.A=c.parser;SE(b.a,c.manifest);WE(b.a)&&b.a.resume();pG(b,c.manifest)})}seekWith(a){return this.seek(this.getPosition()+a)}Of(){const a=
this;return _.x(function*(){IF(a);a.Hd?(a.log.info("Loading preloaded asset",a.Hd),a.Hd=null,yield nG(a,null)):a.log.warn("No preloaded asset found")})}preload(a){const b=this;return _.x(function*(){IF(b);_.Hm("preload.start");b.log.info("Preloading asset",a);yield BG(b,a,!1);b.Hd=a;b.log.info("Preloaded asset",a);_.Hm("preload.end");_.Im("preload","preload.start","preload.end")})}load(a){return BG(this,a)}detach(){const a=this;return _.x(function*(){yield JF(a);a.configuration=a.la;KF(a)})}isLive(){var a;
this.f?(a=this.f.presentationTimeline.isLive())||(a=this.f.presentationTimeline,a=Infinity!==a.f&&!a.l):a=!1;return a}Pe(){this.log.debug("User seeking finished");this.J&&IG(this);FG(this)}getSeekRange(){var a={start:0,end:0};if(this.f){var b=this.f.presentationTimeline;a={start:KB(b),end:UB(b)}}b=this.Vc;b.a?(b=b.a.getDuration(),b>a.end&&(b=a.end),b={start:0,end:b}):b=a;return b}hc(){return this.f?this.f.presentationTimeline.hc():null}getPlaybackRate(){if(this.I){var a=this.I;a=a.l?0:a.h}else a=
0;return a}setPlaybackRate(a,b){if(0===a)this.log.warn("A trick play rate of 0 is unsupported!");else if(this.F===tF){if(_.Xj()){this.log.warn("Pausing and unpausing to mitigate playbackRate platform issue.");var c=this.getSurface().getMedia();c.pause();this.I.set(a,b);c.play()}else this.I.set(a,b);if((b=this.I.getConfiguration())&&b.preferTrickPlayTracks){b=this.a;var d=1<Math.abs(a);if(c=b.a.get(_.w)){var e=c.stream;if(e)if(b.g.debug("setTrickPlay",d),d)(d=e.trickModeVideo)&&!c.Wb&&(b.g.debug("Engaging trick mode stream",
d),_.QE(b,d,!1,0),c.Wb=e);else if(e=c.Wb)b.g.debug("Restoring non-trick-mode stream",e),c.Wb=null,_.QE(b,e,!0,0)}}this.h.playbackRateChanged(a)}}ka(){if(this.f&&this.B){var a=uF(this);if(null==a)a=null;else{if(!LD(this.N,a).text){var b=_.hD(a.textStreams,this.cc,this.Cd,this.bc);b.length&&MD(this.N,a,b[0])}a=LD(this.N,a).text}b=[];for(const c of WG(this)){const d=eD(c);d.active=c===a;b.push(d)}return b}return[]}getPeriods(){return this.f.periods}getStats(){if(this.F!==tF)return _.Jn();FG(this);var a=
this.j;if(a.getVideoPlaybackQuality){var b=a.getVideoPlaybackQuality();a=this.G;var c=Number(b.totalVideoFrames);a.l=Number(b.droppedVideoFrames);a.j=c}if(this.F===tF){if(b=zF(this))this.G.o=b.bandwidth;b&&b.video&&(a=this.G,c=b.video.height||NaN,a.w=b.video.width||NaN,a.h=c);a=this.h.getBandwidthEstimate();this.G.f=a}return this.G.getStats()}wd(){return this.H}getTimelineCues(){return this.H?YB(this.H,CG(this)):[]}resetAbr(){this.h&&this.h.reset()}vd(){return this.h}addTextTrack(a,b,c,d,e,f){const g=
this;return _.x(function*(){if(g.F!==tF)throw g.log.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");const h=uF(g);var k=g.f.periods.indexOf(h)+1;const l=(k>=g.f.periods.length?g.f.presentationTimeline.getDuration():g.f.periods[k].startTime)-h.startTime;if(Infinity===l)throw new _.H(1,4,4040);const m=new _.bC(1,0,l,()=>[a],0,null,0);k={id:g.Oe++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:()=>1,getSegmentReference:q=>
1===q?m:null,adjustSegmentDurations:()=>{},getDuration:()=>l,segmentLookupStrategy:_.AA,initSegmentReference:null,mimeType:d,codecs:e||"",kind:c,encrypted:!1,keyId:null,language:b,originalLanguage:b,label:f||null,type:_.G,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,spatialAudio:!1,closedCaptions:null};g.Ed.add(k);h.textStreams.push(k);yield EE(g.a,k);const n=_.BE(g.a,_.G);n&&MD(g.N,h,n);g.Ed.delete(k);g.log.debug("Choosing new streams after adding a text stream");
YG(g,h);ZF(g);return eD(k)})}Vf(a){this.log.debug(_.EA,a);try{this.log.debug("onChooseStreams_, choosing variant from ",a.variants);this.log.debug("onChooseStreams_, choosing text from ",a.textStreams);const b=ZG(this,a);this.log.debug("onChooseStreams_, chose variant ",b.variant);this.log.debug("onChooseStreams_, chose text ",b.text);return b}catch(b){return this.onError(b),{variant:null,text:null}}}Uf(){this.log.debug("canSwitch_");this.X=!1;this.configuration.abr.enabled&&this.h.enable();this.ga&&
(RE(this.a,this.ga,this.Rf,this.Qf),this.ga=null);this.Z&&(_.QE(this.a,this.Z,!0,0),this.Z=null)}$f(){this.A&&this.A.update()}Xf(){this.B&&this.B.j.Kd()}Tf(a,b,c){if((void 0===c?"":c)===CA)return ZF(this),this.ra()||(this.configuration.abr.enabled=!0,this.h.enable()),YG(this,b,!1),!0;if(c=b.variants.some(d=>{let e=!1;const f=d[a.type];f&&(e=d.allowedByApplication&&f.id!==a.id,a.type===_.p&&(e=e&&f.language===a.language));return e})&&this.ra()){for(const d of b.variants){const e=d[a.type];e&&e.id===
a.id&&(d.allowedByApplication=!1)}ZF(this);this.ra()||(this.configuration.abr.enabled=!0,this.h.enable());YG(this,b)}return c}Wf(){this.log.debug("endOfStream called by streaming engine");this.Qc=!0}onError(a){if(this.F!==OF&&7001!==a.code&&7E3!==a.code){var b=new _.E(_.r,{detail:a});a.severity===_.F&&HF(this,_.Vn);this.trigger(b);b.defaultPrevented&&(b.a=!0)}}ze(a){a.type===_.Pd?this.dispatchEvent(a):"largegap"!==a.type&&(a.type===_.wg?wG(this):"emsg"!==a.type&&(a instanceof _.E?this.dispatchEvent(a):
this.log.debug(_.Ob,a.type)))}ra(){return this.configuration.abr.enabled}Zf(a){const b=this;return _.x(function*(){if(b.vc){b.log.info("Attempt to switch CDN.");var c=b.getLoadedSource(),d=b.ra();if(c=yield b.vc(c.url,a)){c=_.Pg(b.getLoadedSource(),{url:c});d&&b.h.disable();yield XE(b.a);var e=zF(b);do{var f=!1;try{b.log.info(`Switching CDN to ${c.url}.`),yield $G(b,c,e)}catch(g){if(b.log.info("Switch failed"),f=yield b.vc(c.url,a))c.url=f,f=!0;else throw g;}}while(f);d&&b.h.enable();UE(b.a,!0);b.da[b.getSourceIndex()]=
c;a.f=!0;b.trigger(new _.E(_.Zc,{newManifest:c.url}))}}})}},OF=0,vG=1,tF=2,YF=[_.Oe,_.ee];
_.mh(new class{a(){return xA}canPlay(a,b){if(_.gk())return 0;const c=a.type||"",d=(window.ManagedMediaSource?!0:!1)||(window.MediaSource&&MediaSource.isTypeSupported?!0:!1);a=window.ManagedMediaSource||window.MediaSource&&MediaSource.isTypeSupported?c in _.zr||_.Ar(a.url)in _.Br?!0:!1:!1;if(d&&a){if(_.Xj(2))return 1;if(_.hk()&&c===_.Ok){if(b.streaming.preferNativeHlsOnSafari)return 1;_.C("Support for MSE + FairPlay on Apple is experimental. In case of issues, consider using native HLS.")}return 2}return 0}f(a){return a===_.na||
a===_.tb}create(){return new wH}});_.Jo(function(){_.ih("MediaSource.install");if(window.MediaSource)if(window.cast&&cast.__platform__&&cast.__platform__.canDisplayType)_.hh("Patching Chromecast MSE bugs."),aH();else if(_.hk()){var a=navigator.appVersion;a=0<=a.indexOf("Version")?parseInt(a.match(/Version\/(\d+)/)[1],10):13;bH();10>=a?(_.hh("Blacklisting MSE on Safari \x3c\x3d 10."),window.MediaSource=null):12>=a?(_.hh("Patching Safari 11 \x26 12 MSE bugs."),cH(),dH()):(_.hh("Patching Safari 13 MSE bugs."),cH())}else _.Xj(2)||_.Xj(3)||
_.Xj(4)?eH():_.hh("Using native MSE as-is.");else _.hh("No MSE implementation available.")});var xH=class extends _.zu{constructor(a){super(a);a=a.getSurface().getMedia();this.a=null;for(let b=0;b<a.textTracks.length;++b){const c=a.textTracks[b];c.mode=_.Fd;c.label===gA&&(this.a=c)}this.a||(this.a=a.addTextTrack(_.NA,gA));this.a.mode=_.$d}append(a){const b=[],c=d=>{if(d.startTime>=d.endTime)_.C("Invalid cue times: "+d.startTime+" - "+d.endTime),d=null;else{var e=d.payload||"";e=e.replace(/<br\s*\/?>/igm,"\n");e=_.Bi(e);e=new VTTCue(d.startTime,d.endTime,e);e.line=-1;try{e.align=_.ad}catch(f){e.align=
"middle"}d.writingMode===_.ig?e.vertical="lr":d.writingMode===_.jg&&(e.vertical="rl");d=e}d&&b.push(d)};for(const d of a)c(d);a=b.slice().sort((d,e)=>d.startTime!==e.startTime?d.startTime-e.startTime:d.endTime!==e.endTime?d.endTime-e.startTime:b.indexOf(e)-b.indexOf(d));for(const d of a)this.a.addCue(d)}remove(a,b){if(!this.a)return!1;fH(this.a,c=>c.startTime<b&&c.endTime>a);return!0}isTextVisible(){return this.a.mode===_.Gf}setTextVisibility(a){null!==this.a&&(this.a.mode=a?_.Gf:_.$d)}destroy(){this.a&&
fH(this.a,()=>!0);this.a=null;return Promise.resolve()}};_.Dn("single-native",new class{isSupported(){return!0}create(a){return new xH(a)}});};f.call(g, window);