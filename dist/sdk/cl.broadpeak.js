import {clpp} from "./cl.core.js";let g={};const _ = clpp._;var f=function(window){'use strict';var yU=function(){return!window.SmartLib||!window.GenericPlayerApi},zU=function(a,b){const c=b.analyticsAddress||null,d=b.nanoCDNHost||null,e=b.broadpeakDomainNames||"";b=b.uuid||null;a.h||(a.h=SmartLib.getInstance(),a.h.init(c,d,e),typeof b===_.Qf&&a.h.setUUID(b))},BU=function(a,b){b=b.customParameters||{};a.a=a.h.createStreamingSession();a.a.setOption(StreamingSessionOptions.SESSION_PRECACHE,!0);for(const c in b)a.a.setCustomParameter(c,b[c]);a.o.on(a.m,_.r,a.U.bind(a));a.l=AU(a.m);
a.a.attachPlayer(a.l)},CU=function(a,b){_.ph(a.o);a.f&&(a.f.release(),a.f=null);a.a&&(a.a.stopStreamingSession(b),a.a=null)},DU=class{constructor(a,b){this.m=a;this.f=b;this.a=new _.ts;this.h=!1}init(){const a=this.m,b=this.a;b.on(a,_.Nf,this.o.bind(this));b.on(a,_.Nc,this.j.bind(this));b.on(a,"seek",this.l.bind(this))}j(a){a=a.detail;typeof a.bandwidth===_.t&&this.f.notifyLayerSwitch(a.bandwidth/1E3)}o(a){const b=this.m,c=this.f;a=a.detail;const d=a.currentState;a.previousState===_.Rn&&c.notifyStallEnd(!b.isPaused());
switch(d){case _.Rn:c.notifyStallStart();break;case _.Zn:this.h?c.notifyResume():(c.notifyFirstImage(),this.h=!0);break;case _.Yn:c.notifyPause()}}l(){const a=1E3*this.m.getPosition();this.f.notifySeek(a)}release(){this.a&&(_.ph(this.a),this.a=null)}};var AU=a=>{class b extends GenericPlayerApi{constructor(c){super();this.m=c;this.a=_.vk()}getPlayerName(){return _.ra}getVersion(){return _.fa}getOSName(){return this.a.os}getDeviceVersion(){return this.a.osVersion.name}getDeviceType(){return"browser"}getTotalDuration(){return this.m.isLive()?0:1E3*this.m.getDuration()}getCurrentPosition(){return 1E3*this.m.getPosition()}getCurrentBitrate(){const c=this.m.getStats();return(c?c.streamBandwidth:0)/1E3}}return new b(a)};var EU=class extends _.Au{constructor(){super();this.l=this.f=this.a=this.h=this.m=null;this.o=new _.ts;this.j=!1}onPlayerCreated(a){this.m=a}onContentWillLoad(a,b){const c=a.getConfiguration().broadpeak;if(c){if(yU())return a.onError(new _.H(1,9,11E3));this.j=!0;zU(this,c);BU(this,c);return this.a.getURL(b.url).then(d=>{if(d.isError()){const e=d.getDetailedErrorCode();d=d.getDetailedErrorMessage();this.m.onError(new _.H(1,9,11001,{bpkErrorCode:e,message:d}));CU(this,void 0)}else b.url=d.getURL(),
this.f=new DU(this.m,this.l),this.f.init()})}}onContentLoaded(){!1!==this.j&&this.a.precacheEnded()}U(a){a=a.detail;if(7003===a.code)CU(this,SmartLib.BPFormatNotSupportedError);else if(a.severity===_.F)switch(a.category){case 3:CU(this,SmartLib.BPDecodingError);break;case 1:CU(this,SmartLib.BPNetworkingError);break;case 6:CU(this,SmartLib.BPAccessRightError);break;default:CU(this,SmartLib.BPUnspecifiedError)}}onPlayerWillRelease(){yU()||CU(this,SmartLib.BPSessionEndsNormally);this.j=!1}id(){return"broadpeak"}};
_.z("clpp.broadpeak.BroadpeakPlugin",EU);EU.isSdkMissing=yU;EU.Id="broadpeak";_.dp(new class{create(){return new EU}});};f.call(g, window);