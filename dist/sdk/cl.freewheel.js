import {clpp} from "./cl.core.js";let g={};const _ = clpp._;var f=function(window){'use strict';var dS="clpp-freewheel",eS="clpp.freewheel.AdsManagerFactory",fS="freewheel",gS=function(a){switch(a){case 0:return tv.freewheel.SDK.ADUNIT_PREROLL;case 1:return tv.freewheel.SDK.ADUNIT_MIDROLL;case 2:return tv.freewheel.SDK.ADUNIT_POSTROLL;default:return""}},hS=function(a){const b=[];typeof a.networkId!==_.t&&b.push("networkId");typeof a.serverUrl!==_.Qf&&b.push("serverUrl");typeof a.profileId!==_.Qf&&b.push("profileId");typeof a.videoAssetId!==_.Qf&&typeof a.videoAssetId!==_.t&&b.push("videoAssetId");
if(b.length)throw new _.H(1,9,12001,{missingKeys:b.join(", ")});},iS=function(){return _.x(function*(){var a=new _.qu;let b=tv.freewheel.SDK.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE;const c=yield a.canPlay(!1);a=yield a.canPlay(!0);c?b=tv.freewheel.SDK.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED:a&&(b=tv.freewheel.SDK.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED);return b})},jS=function(a){a.h.on(a.a,tv.freewheel.SDK.EVENT_REQUEST_COMPLETE,a.H.bind(a));a.h.on(a.a,tv.freewheel.SDK.EVENT_SLOT_STARTED,a.J.bind(a));a.h.on(a.a,
tv.freewheel.SDK.EVENT_SLOT_ENDED,a.I.bind(a));a.h.on(a.a,tv.freewheel.SDK.EVENT_AD,a.G.bind(a));a.h.on(a.m,_.Xf,a.F.bind(a));a.h.on(a.m,_.Nf,a.C.bind(a))},mS=function(a){return _.x(function*(){a.B.length?(kS(a),a.f=a.B.shift(),a.f.play()):(lS(a),yield a.m.a.play())})},lS=function(a){const b=a.m.gc(fS).Ac();b&&a.m.getSurface().hide(b);a.m.getSurface().showMediaElement()},kS=function(a){const b=a.m.gc(fS).Ac();b&&(a.m.getSurface().show(b),a.m.getSurface().hideMediaElement(),a.a.registerVideoDisplayBase(dS),
a.m.isMuted()?a.setVolume(0):a.setVolume(a.m.getVolume()||1))},nS=function(a){a.A.length?(kS(a),a.f=a.A.shift(),a.f.play()):lS(a)},oS=function(a,b,c){var d=null;a.a&&c&&(c.adInstance||c.slot)&&(c=(d=c.adInstance||null)?d.getSlot():c.slot,d={ad:new Y(a.a,c,d)});a.m.trigger(new _.E(b,d))},pS=class extends _.Au{constructor(){super();this.f=this.a=null}onPlayerCreated(a){if(window.tv&&tv.freewheel&&tv.freewheel.SDK)this.a=_.uo(_.Gd,{id:dS}),this.f=_.uo(_.w,{"class":_.ed}),this.a.appendChild(this.f),a.getSurface().addElementToContainer(this.a,
!0),a.getSurface().hide(this.a);else a.onError(new _.H(1,9,12E3))}onPlayerWillDestroy(a){this.a&&(a.getSurface().removeElementFromContainer(this.a),this.f=this.a=null)}id(){return fS}Ac(){return this.a}yg(){return this.f}};_.z("clpp.freewheel.FreeWheelPlugin",pS);pS.prototype.getAdVideo=pS.prototype.yg;pS.prototype.getAdContainer=pS.prototype.Ac;pS.Id=fS;pS.AD_CONTAINER_ID=dS;_.dp(new class{create(){return new pS}});var Y=class{constructor(a,b,c){this.h=a;this.f=b;this.a=c}yb(){return"FreeWheel AdManager SDK"}zb(){return tv.freewheel.SDK.version}Fb(){return 0}getId(){return this.a?this.a.getAdId():""}getCreativeId(){const a=(this.a||{})._creativeId;return typeof a===_.Qf?a:""}getApiFramework(){return this.a?this.a.getActiveCreativeRendition().getCreativeApi():""}getAdSystem(){return""}getAdvertiserName(){return""}getTitle(){return""}getDuration(){return this.a?this.a.getActiveCreativeRendition().getDuration():
0}getSkipTimeOffset(){return 0}kc(){return!1}Qb(){return this.a&&this.a.getEventCallbackUrls(tv.freewheel.SDK.EVENT_AD_CLICK,tv.freewheel.SDK.EVENT_TYPE_CLICK)[0]||""}getMediaUrl(){return this.a?this.a.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset().getUrl():""}Cb(){return this.a?this.a.getActiveCreativeRendition().getWidth():0}Bb(){return this.a?this.a.getActiveCreativeRendition().getHeight():0}qb(){return 0}eb(){switch(this.f.getTimePositionClass()){case tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL:return 0;
case tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL:return 2;default:return 1}}getPodIndex(){switch(this.eb()){case 0:return 0;case 2:return-1}return this.h.getSlotsByTimePositionClass(tv.freewheel.SDK.TIME_POSITION_CLASS_MIDROLL).indexOf(this.f)+1}Rb(){switch(this.eb()){case 0:return 0;case 2:return-1;default:return this.f.getTimePosition()}}Sb(){return this.a?this.f.getAdInstances().indexOf(this.a)+1:1}Eb(){return this.f.getAdCount()}getWrapperAdIds(){return[]}getWrapperAdSystems(){return[]}getWrapperCreativeIds(){return[]}};
Y.prototype.getWrapperCreativeIds=Y.prototype.getWrapperCreativeIds;Y.prototype.getWrapperAdSystems=Y.prototype.getWrapperAdSystems;Y.prototype.getWrapperAdIds=Y.prototype.getWrapperAdIds;Y.prototype.getSequenceLength=Y.prototype.Eb;Y.prototype.getPositionInSequence=Y.prototype.Sb;Y.prototype.getPodTimeOffset=Y.prototype.Rb;Y.prototype.getPodIndex=Y.prototype.getPodIndex;Y.prototype.getPodType=Y.prototype.eb;Y.prototype.getMediaBitrate=Y.prototype.qb;Y.prototype.getMediaHeight=Y.prototype.Bb;
Y.prototype.getMediaWidth=Y.prototype.Cb;Y.prototype.getMediaUrl=Y.prototype.getMediaUrl;Y.prototype.getClickThroughUrl=Y.prototype.Qb;Y.prototype.isBumper=Y.prototype.kc;Y.prototype.getSkipTimeOffset=Y.prototype.getSkipTimeOffset;Y.prototype.getDuration=Y.prototype.getDuration;Y.prototype.getTitle=Y.prototype.getTitle;Y.prototype.getAdvertiserName=Y.prototype.getAdvertiserName;Y.prototype.getAdSystem=Y.prototype.getAdSystem;Y.prototype.getApiFramework=Y.prototype.getApiFramework;
Y.prototype.getCreativeId=Y.prototype.getCreativeId;Y.prototype.getId=Y.prototype.getId;Y.prototype.getTechnology=Y.prototype.Fb;Y.prototype.getAdManagerVersion=Y.prototype.zb;Y.prototype.getAdManagerName=Y.prototype.yb;var qS=class{constructor(a){this.a=a}getCuePoints(){return this.a.getTemporalSlots().map(a=>{switch(a.getTimePositionClass()){case tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL:return 0;case tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL:return-1;default:return a.getTimePosition()}})}Tb(){return 0<this.a.getSlotsByTimePositionClass(tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL).length}sb(){return 0<this.a.getSlotsByTimePositionClass(tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL).length}};
qS.prototype.hasPostroll=qS.prototype.sb;qS.prototype.hasPreroll=qS.prototype.Tb;qS.prototype.getCuePoints=qS.prototype.getCuePoints;var rS=class{constructor(a){this.g=new _.R("clpp.freewheel.AdsManager");this.m=a;this.h=new _.ts;this.w=new tv.freewheel.SDK.AdManager;this.f=this.a=null;this.B=[];this.o=[];this.A=[];this.l=new _.dn;this.j=null}load(){const a=this;return _.x(function*(){const b=a.m.getConfiguration().freewheel||{};try{hS(b)}catch(d){return a.m.onError(d),a.l.resolve(),a.l}a.w.setNetwork(b.networkId);a.w.setServer(b.serverUrl);a.a=a.w.newContext();a.a.setProfile(b.profileId);typeof b.siteSectionId!==_.Qf&&typeof b.siteSectionId!==
_.t||a.a.setSiteSection(b.siteSectionId);const c=yield iS();a.a.setVideoAsset(b.videoAssetId,a.m.getDuration(),void 0,void 0,c);if(Array.isArray(b.pods))for(const d of b.pods)a.a.addTemporalSlot(d.id,gS(d.type),d.position,d.slotProfile,d.cuepointSequence,d.maxDuration,d.minDuration,d.acceptContentType);b.keyValues&&typeof b.keyValues===_.Fe&&Object.keys(b.keyValues).forEach(d=>a.a.addKeyValue(d,b.keyValues[d]));a.a.setParameter(tv.freewheel.SDK.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED,!1,tv.freewheel.SDK.PARAMETER_LEVEL_GLOBAL);
if(Array.isArray(b.parameters))for(const d of b.parameters)a.a.setParameter(d.name,d.value,d.level);jS(a);a.a.submitRequest();return a.l})}start(){const a=this;return _.x(function*(){yield mS(a)})}resume(){this.f&&this.f.resume()}pause(){this.f&&this.f.pause()}skip(){this.f&&this.f.skipCurrentAd()}getVolume(){return this.a?this.a.getAdVolume():1}setVolume(a){this.a&&this.a.setAdVolume(a)}getPosition(){return this.f?this.f.getPlayheadTime():-1}dispose(){const a=this;return _.x(function*(){a.h.release();
a.j&&(a.j.stop(),a.j=null);lS(a);a.a&&(a.a.dispose(),a.a=null)})}H(a){if(a.success)this.B=this.a.getSlotsByTimePositionClass(tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL),this.o=this.a.getSlotsByTimePositionClass(tv.freewheel.SDK.TIME_POSITION_CLASS_MIDROLL),this.A=this.a.getSlotsByTimePositionClass(tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL),this.m.trigger(new _.E(_.uc,{adsTimeline:new qS(this.a)})),this.j=new _.ou(this.m.getSurface(),(b,c)=>this.a.resize(b,c),this.m.gc(fS).f);else this.m.onError(new _.H(1,
9,10003,{errorType:0},void 0));this.l.resolve()}J(a){oS(this,_.cc,a);this.j.start()}I(a){this.f=null;a=a.slot;oS(this,_.dc);this.j.stop();if(a)switch(a.getTimePositionClass()){case tv.freewheel.SDK.TIME_POSITION_CLASS_PREROLL:mS(this);break;case tv.freewheel.SDK.TIME_POSITION_CLASS_MIDROLL:lS(this);this.m.play();break;case tv.freewheel.SDK.TIME_POSITION_CLASS_POSTROLL:nS(this)}}G(a){const b=a.subType;this.g.debug("ad event",b);switch(b){case tv.freewheel.SDK.EVENT_AD_IMPRESSION:oS(this,_.qc,a);oS(this,
_.ic,a);break;case tv.freewheel.SDK.EVENT_AD_IMPRESSION_END:oS(this,_.rc,a);break;case tv.freewheel.SDK.EVENT_AD_FIRST_QUARTILE:oS(this,_.hc,a);break;case tv.freewheel.SDK.EVENT_AD_MIDPOINT:oS(this,_.lc,a);break;case tv.freewheel.SDK.EVENT_AD_THIRD_QUARTILE:oS(this,_.sc,a);break;case tv.freewheel.SDK.EVENT_AD_COMPLETE:oS(this,_.gc,a);break;case tv.freewheel.SDK.EVENT_AD_CLICK:oS(this,_.fc,a);break;case tv.freewheel.SDK.EVENT_AD_PAUSE:oS(this,_.mc,a);break;case tv.freewheel.SDK.EVENT_AD_RESUME:oS(this,
_.oc,a);break;case tv.freewheel.SDK.EVENT_AD_SKIPPED:oS(this,_.pc,a);break;case tv.freewheel.SDK.EVENT_AD_BUFFERING_START:oS(this,_.ec,a);break;case tv.freewheel.SDK.EVENT_AD_BUFFERING_END:oS(this,_.nc,a);break;case tv.freewheel.SDK.EVENT_ERROR:this.m.onError(new _.H(1,9,10003,{errorType:1},{fwCode:a[tv.freewheel.SDK.INFO_KEY_ERROR_CODE],fwInfo:a[tv.freewheel.SDK.INFO_KEY_ERROR_INFO],fwModule:a[tv.freewheel.SDK.INFO_KEY_ERROR_MODULE]}))}}F(){if(!this.f){var a=this.m.getPosition();if(this.f=this.o.find(b=>
.5>Math.abs(a-b.getTimePosition()))||null){const b=this.o.findIndex(c=>c===this.f);this.o.splice(b,1);this.m.pause();kS(this);this.f.play()}}}C(a){if((a=a.detail)&&this.a)switch(a.currentState){case _.Zn:this.a.setVideoState(tv.freewheel.SDK.VIDEO_STATE_PLAYING);break;case _.Yn:this.a.setVideoState(tv.freewheel.SDK.VIDEO_STATE_PAUSED);break;case _.On:this.a.setVideoState(tv.freewheel.SDK.VIDEO_STATE_COMPLETED);nS(this);break;case _.Wn:case _.Vn:this.a.setVideoState(tv.freewheel.SDK.VIDEO_STATE_STOPPED)}}};
rS.prototype.getPosition=rS.prototype.getPosition;rS.prototype.setVolume=rS.prototype.setVolume;rS.prototype.getVolume=rS.prototype.getVolume;rS.prototype.skip=rS.prototype.skip;rS.prototype.pause=rS.prototype.pause;rS.prototype.resume=rS.prototype.resume;rS.prototype.start=rS.prototype.start;var sS=class{constructor(){this.a=new _.R(eS)}name(){return eS}isSupported(a,b){return a.namespace()===_.kd?!1:window.tv&&tv.freewheel&&tv.freewheel.SDK?!(!b||!b.freewheel):(this.a.warn("FreeWheel SDK is not loaded."),!1)}create(a){return new rS(a)}};sS.prototype.create=sS.prototype.create;sS.prototype.isSupported=sS.prototype.isSupported;sS.prototype.name=sS.prototype.name;_.ro(new sS);};f.call(g, window);