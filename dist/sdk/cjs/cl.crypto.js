(function(){var g={}; var _ = _ || {}
var f=function(window){var zT=function(){this.B=[0,1,2,4,8,16,32,64,128,27,54];this.D=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.l=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.A=new Uint32Array(256);this.o=new Uint32Array(256);this.w=new Uint32Array(0);this.h=this.a=this.j=this.f=null;var a=this.A,b=this.o,c=this.D,d=c[0],e=c[1],f=c[2];c=c[3];var g=this.l,h=g[0],l=g[1],m=g[2];g=g[3];var n=new Uint32Array(256),p=0,q=0,u;for(u=0;256>
u;u++)n[u]=128>u?u<<1:u<<1^283;for(u=0;256>u;u++){var v=q^q<<1^q<<2^q<<3^q<<4;v=v>>>8^v&255^99;a[p]=v;b[v]=p;var z=n[p],A=n[z],G=n[A],F=257*n[v]^16843008*v;d[p]=F<<24|F>>>8;e[p]=F<<16|F>>>16;f[p]=F<<8|F>>>24;c[p]=F;F=16843009*G^65537*A^257*z^16843008*p;h[v]=F<<24|F>>>8;l[v]=F<<16|F>>>16;m[v]=F<<8|F>>>24;g[v]=F;p?(p=z^n[n[n[G^z]]],q^=n[n[q]]):p=q=1}},AT=function(a){a=_.vj(a);for(var b=new Uint32Array(4),c=0;4>c;c++)b[c]=a.getUint32(4*c);return b},BT=function(){this.a=null},CT=function(){this.j={};
this.l=!1;this.g=new _.K("clpp.crypto")},ET=function(a,b){return function(c){var d,e,f;return _.I(function(g){if(1==g.a){d=c.request||null;if(!(d&&2===d.type&&d.keyInfo&&c.data))return g.F(2);e=d.uris[0];a.g.debug("Decrypting AES-128-encrypted video segment",e);f=c;return _.y(g,DT(a,b,c.data,d.keyInfo,e),3)}2!=g.a&&(f.data=g.f);return g["return"](c)})}},FT=function(a,b,c){var d,e,f,g,h,l;return _.I(function(m){if(1==m.a){d=_.Mj(c);if(e=(new _.Ji(c)).Pa.endsWith(".drmtoday.com"))f=b.getConfiguration(),
_.rn(d,f);g=c+JSON.stringify(d.headers);if(a.j[g])return m["return"](a.j[g]);_.D(m,2);return _.y(m,b.getNetworkEngine().fetch(d).P,4)}if(2!=m.a)return h=m.f,a.j[g]=h.data,m["return"](h.data);l=_.E(m);e&&1001===l.code&&412===l.data.status&&a.g.warn("Wrong DRMtoday credentials, server responded with 412.");throw l;})},DT=function(a,b,c,d,e){var f,g,h,l,m;return _.I(function(n){switch(n.a){case 1:return f=new ArrayBuffer(0),_.D(n,2),_.y(n,FT(a,b,d.url),4);case 4:f=n.f;_.th(n,3);break;case 2:return g=
_.E(n),a.g.warn("Could not fetch AES key",g),b.onError(new _.N(1,7,7104,null,g)),n["return"](c);case 3:return _.D(n,5),h=a.l?new BT:new zT,_.y(n,h.importKey(f),7);case 7:return _.y(n,h.decrypt(c,d.iv),8);case 8:return l=n.f,n["return"](l);case 5:return m=_.E(n),a.g.warn("Could not decrypt segment data!",e,m),b.onError(new _.N(1,3,3103,null,m)),n["return"](c)}})};
zT.prototype.importKey=function(a){a=AT(a);for(var b=!0,c=0;c<a.length&&b;)b=a[c]===this.w[c],c++;if(b)return new Promise(function(n){return n()});this.w=a;this.a=a.length;if(4!==this.a&&6!==this.a&&8!==this.a)throw Error("Invalid aes key size\x3d"+this.a);this.h=4*(this.a+7);this.f=new Uint32Array(this.h);this.j=new Uint32Array(this.h);b=this.A;var d=this.B;var e=this.l;c=e[0];var f=e[1],g=e[2],h=e[3],l=0,m=0;for(e=0;e<this.h;e++)e<this.a?l=this.f[e]=a[e]:(m=l,0===e%this.a?(m=m<<8|m>>>24,m=b[m>>>
24]<<24|b[m>>>16&255]<<16|b[m>>>8&255]<<8|b[m&255],m^=d[e/this.a|0]<<24):6<this.a&&4===e%this.a&&(m=b[m>>>24]<<24|b[m>>>16&255]<<16|b[m>>>8&255]<<8|b[m&255]),l=(this.f[e-this.a]^m)>>>0,this.f[e]=l);for(a=0;a<this.h;a++)e=this.h-a,m=a&3?this.f[e]:this.f[e-4],this.j[a]=4>a||4>=e?m:c[b[m>>>24]]^f[b[m>>>16&255]]^g[b[m>>>8&255]]^h[b[m&255]],this.j[a]>>>=0;return new Promise(function(n){return n()})};
zT.prototype.decrypt=function(a,b){var c=0,d=this.a+6,e=this.j,f=this.o,g=this.l,h=g[0],l=g[1],m=g[2];g=g[3];var n=AT(b),p=n[0],q=n[1],u=n[2];n=n[3];for(var v=_.uj(a),z=new Int32Array(v.length),A,G,F,C,H,Q,R,na,da,Ba,ab,bb,Qa,Ca=this.G.bind(this);c<v.length;){na=Ca(v[c]);da=Ca(v[c+1]);Ba=Ca(v[c+2]);ab=Ca(v[c+3]);H=na^e[0];Q=ab^e[1];R=Ba^e[2];C=da^e[3];bb=4;for(Qa=1;Qa<d;Qa++)A=h[H>>>24]^l[Q>>16&255]^m[R>>8&255]^g[C&255]^e[bb],G=h[Q>>>24]^l[R>>16&255]^m[C>>8&255]^g[H&255]^e[bb+1],F=h[R>>>24]^l[C>>
16&255]^m[H>>8&255]^g[Q&255]^e[bb+2],C=h[C>>>24]^l[H>>16&255]^m[Q>>8&255]^g[R&255]^e[bb+3],H=A,Q=G,R=F,bb+=4;A=f[H>>>24]<<24^f[Q>>16&255]<<16^f[R>>8&255]<<8^f[C&255]^e[bb];G=f[Q>>>24]<<24^f[R>>16&255]<<16^f[C>>8&255]<<8^f[H&255]^e[bb+1];F=f[R>>>24]<<24^f[C>>16&255]<<16^f[H>>8&255]<<8^f[Q&255]^e[bb+2];C=f[C>>>24]<<24^f[H>>16&255]<<16^f[Q>>8&255]<<8^f[R&255]^e[bb+3];bb+=3;z[c]=Ca(A^p);z[c+1]=Ca(C^q);z[c+2]=Ca(F^u);z[c+3]=Ca(G^n);p=na;q=da;u=Ba;n=ab;c+=4}return new Promise(function(fb){var pc=z.buffer;
var Eg=pc.byteLength,Fg=Eg&&(new DataView(pc)).getUint8(Eg-1);pc=Fg?pc.slice(0,Eg-Fg):pc;fb(pc)})};zT.prototype.destroy=function(){this.B=this.j=this.f=this.l=this.D=this.o=this.A=this.h=this.a=this.w=null;return new Promise(function(a){return a()})};zT.prototype.G=function(a){return a<<24|(a&65280)<<8|(a&16711680)>>8|a>>>24};BT.prototype.importKey=function(a){var b=this,c;return _.I(function(d){if(1==d.a)return c=b,_.y(d,crypto.subtle.importKey("raw",a,{name:"AES-CBC"},!1,["decrypt"]),2);c.a=d.f;_.B(d)})};BT.prototype.decrypt=function(a,b){var c=this,d;return _.I(function(e){if(1==e.a)return _.y(e,crypto.subtle.decrypt({name:"AES-CBC",iv:b},c.a,a),2);d=e.f;return e["return"](d)})};BT.prototype.destroy=function(){this.a=null;return new Promise(function(a){return a()})};_.x(CT,_.Ts);CT.prototype.f=function(){if(window.crypto&&crypto.subtle){var a=crypto.subtle.decrypt;a=typeof crypto.subtle.importKey===_.we&&typeof a===_.we}else a=!1;(this.l=a)||this.g.warn("No WebCrypto APIs found. Will fallback to software AES")};CT.prototype.o=function(a){var b=ET(this,a);a.getNetworkEngine().Nc(b)};CT.prototype.a=function(){this.j={}};CT.prototype.id=function(){return"crypto"};_.J("clpp.crypto.CryptoComponent",CT);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();