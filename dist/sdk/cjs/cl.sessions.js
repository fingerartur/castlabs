(function(){var g={}; var _ = _ || {}
var f=function(window){var mz="apiUrl config is missing",nz="prestoplay-web",oz=function(a,b){a.j=a.j.filter(function(c){return c!==b})},pz=function(a){var b=0>a;a=Math.abs(a);var c=a>>>0;a=Math.floor((a-c)/4294967296);a>>>=0;b&&(a=~a>>>0,c=(~c>>>0)+1,4294967295<c&&(c=0,a++,4294967295<a&&(a=0)));return[c,a]},qz=function(){this.a=[]},tz=function(a,b,c){rz(a,b,c,function(d,e){sz(d,e)})},sz=function(a,b){if(0<=b)uz(a,b);else{for(var c=b,d=0;9>d;d++)a.a.push(c&127|128),c>>=7;a.a.push(1)}},wz=function(a,b,c){rz(a,b,c,function(d,
e){if(0<=e){var f=_.w(pz(e)),g=f.next().value;f=f.next().value;vz(d,g,f)}else f=_.w(pz(e)),g=f.next().value,f=f.next().value,vz(d,g,f)})},yz=function(a,b,c){xz(a,b,c,function(d,e){for(var f=0;f<e.length;f++){var g=e.charCodeAt(f);if(128>g)d.a.push(g);else if(2048>g)d.a.push(g>>6|192),d.a.push(g&63|128);else if(65536>g)if(55296<=g&&56319>=g&&f+1<e.length){var h=e.charCodeAt(f+1);56320<=h&&57343>=h&&(g=1024*(g-55296)+h-56320+65536,d.a.push(g>>18|240),d.a.push(g>>12&63|128),d.a.push(g>>6&63|128),d.a.push(g&
63|128),f++)}else d.a.push(g>>12|224),d.a.push(g>>6&63|128),d.a.push(g&63|128)}})},Az=function(a,b,c){xz(a,b,c,function(d,e){zz(d,e.a())})},Bz=function(a,b,c){xz(a,b,c,function(d,e){zz(d,e)})},zz=function(a,b){a.a.push.apply(a.a,b)},rz=function(a,b,c,d){if(!(null===c||void 0===c||typeof c===_.k&&0===c||typeof c===_.mg&&0===c.length||Array.isArray(c)&&0===c.length))if(Array.isArray(c)){uz(a,b<<3|2);b=new qz;for(var e=0;e<c.length;e++)d(b,c[e]);sz(a,b.length());zz(a,b.end())}else uz(a,b<<3|0),d(a,c)},
xz=function(a,b,c,d){if(!(null===c||void 0===c||typeof c===_.k&&0===c||typeof c===_.mg&&0===c.length||Array.isArray(c)&&0===c.length))if(Array.isArray(c))for(var e=0;e<c.length;e++){uz(a,b<<3|2);var f=new qz;d(f,c[e]);sz(a,f.length());zz(a,f.end())}else uz(a,b<<3|2),b=new qz,d(b,c),sz(a,b.length()),zz(a,b.end())},uz=function(a,b){for(;127<b;)a.a.push(b&127|128),b>>>=7;a.a.push(b)},vz=function(a,b,c){for(;0<c||127<b;)a.a.push(b&127|128),b=(b>>>7|c<<25)>>>0,c>>>=7;a.a.push(b)},Cz=function(a,b,c,d){this.downloadId=
a;this.h=b;this.duration=c;this.j=d;this.f=[]},Dz=function(a,b){this.f=a;this.url=b;this.downloadId=null;this.headers=[];this.size=this.duration=null},Ez=function(a,b){this.h=a;this.f=b},Fz=function(a){this.cause=a;this.f=this.message=this.severity=this.errorCode=null},Gz=function(a,b){this.key=a;this.value=b},Hz=function(){this.cause=this.severity=this.code=null},Iz=function(){this.data=null},Jz=function(){this.data=null;var a=new Uint8Array(16);crypto.getRandomValues(a);a[6]=a[6]&15|64;a[8]=a[8]&
63|128;this.data=a},Kz=function(){this.headers=[]},Lz=function(){},Mz=function(a){this.j=a;this.f=this.h=this.time=this.sessionId=null},Nz=function(){this.f=null;this.events=[]},Oz=function(){this.f=this.h=null},Pz=function(){this.f=this.h=null},Qz=function(a){var b=new Pz;b.h=Math.floor(a/1E3);b.f=a%1E3*1E6;return b},Tz=function(a,b,c,d,e){var f=new Uint8Array([]),g=this;var h=void 0===h?2500:h;this.o=f;this.l=e;this.w=new Jz;this.A=new Jz;this.a=[];this.h=setInterval(function(){return Rz(g)},h);
this.f=null;this.j=!1;Sz(this,a,b,c,d)},Sz=function(a,b,c,d,e){var f=new Kz;f.headers=[new Gz("CL-BROWSER-NAME",b),new Gz("CL-BROWSER-VERSION",c),new Gz("CL-OS-FAMILY",d),new Gz("CL-OS-VERSION",e),new Gz("CL-SDK-NAME",nz),new Gz("CL-SDK-NAME",nz),new Gz("CL-SDK-VERSION",_.ja)];Uz(a,f)},Rz=function(a){var b,c,d,e;return _.I(function(f){if(1==f.a){if(a.j||a.f)return f["return"]();0===a.a.length&&Uz(a,new Lz);b=function(){};a.f=new Promise(function(g){b=g});_.sh(f);c=new Nz;c.f=a.o;c.events.push.apply(c.events,
_.fh(a.a));d=_.fh(a.a).concat();return _.y(f,fetch(a.l,{method:_.Mb,headers:{"Content-Type":"application/proto"},body:new Uint8Array(c.a())}),4)}if(2!=f.a)if(e=f.f,e.ok)a.a=a.a.filter(function(g){return!d.includes(g)});else throw Error("An error occurred while sending telemetry events to the API, status\x3d'"+(e.status+"' statusText\x3d'"+e.statusText+"'"));_.uh(f);b();a.f=null;return _.vh(f,0)})},Uz=function(a,b){if(!a.j){var c=new Mz(a.w);c.sessionId=a.A;var d=Date.now(),e=new Oz;e.h=Math.floor(d/
1E3);e.f=d%1E3*1E6;c.time=e;c.h=b.getId();c.f=new Uint8Array(b.a());a.a.push(c)}},Vz=function(){this.reason=this.currentState=this.previousState=null},Wz=function(){this.m=null;this.a=this.l=!1;this.f=new _.Xh;this.h=null;this.g=new _.K("clpp.sessions.SessionsPlugin");this.o=this.gm.bind(this);this.j=this.fm.bind(this)},dA=function(a){switch(a){case _.np:return Xz;case _.zp:return Yz;case _.sp:return Zz;case _.Bp:return $z;case _.Ap:return aA;case _.up:return bA;case _.yp:return cA;default:return null}},
lA=function(a,b){switch(a){case 1:return eA;case 2:return b===_.r?fA:b===_.cd?gA:b===_.P?hA:b===_.Be?iA:jA;case 3:return kA;default:return jA}},mA=function(a){var b;_.I(function(c){if(1==c.a)return a.g.info("Destroy the session and stop sending events."),_.$h(a.f),a.a=!1,b=a.m.getNetworkEngine(),b.cg(a.o),b.Yd(a.j),oz(b,a.j),a.h?_.y(c,a.h.dispose(),3):c.F(0);a.h=null;_.B(c)})},nA=function(a,b){a.g.debug("Sending event",b);Uz(a.h,b)},oA=function(){};qz.prototype.length=function(){return this.a.length};qz.prototype.end=function(){var a=this.a;this.a=[];return a};Cz.prototype.a=function(){var a=new qz;Az(a,1,this.downloadId);tz(a,2,this.h);Az(a,3,this.duration);tz(a,4,this.j);Az(a,5,this.f);return a.end()};Cz.prototype.getId=function(){return 4};Dz.prototype.a=function(){var a=new qz;tz(a,1,this.f);Az(a,2,this.downloadId);yz(a,3,this.url);Az(a,4,this.headers);yz(a,5,null);Az(a,6,null);Az(a,7,this.duration);wz(a,8,this.size);return a.end()};Dz.prototype.getId=function(){return 2};Ez.prototype.a=function(){var a=new qz;tz(a,1,this.h);Bz(a,2,this.f);return a.end()};Fz.prototype.a=function(){var a=new qz;tz(a,1,this.errorCode);tz(a,2,this.severity);yz(a,3,this.message);yz(a,4,this.f);Az(a,5,this.cause);return a.end()};Fz.prototype.getId=function(){return 7};Gz.prototype.a=function(){var a=new qz;yz(a,1,this.key);yz(a,2,this.value);return a.end()};Hz.prototype.a=function(){var a=new qz;tz(a,1,this.code);tz(a,2,this.severity);Az(a,3,this.cause);return a.end()};Hz.prototype.getId=function(){return 12};Iz.prototype.a=function(){var a=new qz;Bz(a,1,this.data);return a.end()};_.x(Jz,Iz);Jz.prototype.toString=function(){for(var a=[],b=0;256>b;++b)a.push((b+256).toString(16).slice(1));return a[this.data[0]]+a[this.data[1]]+a[this.data[2]]+a[this.data[3]]+"-"+a[this.data[4]]+a[this.data[5]]+"-"+a[this.data[6]]+a[this.data[7]]+"-"+a[this.data[8]]+a[this.data[9]]+"-"+a[this.data[10]]+a[this.data[11]]+a[this.data[12]]+a[this.data[13]]+a[this.data[14]]+a[this.data[15]]};Kz.prototype.a=function(){var a=new qz;Az(a,1,this.headers);return a.end()};Kz.prototype.getId=function(){return 1};Lz.prototype.a=function(){return(new qz).end()};Lz.prototype.getId=function(){return 6};Mz.prototype.a=function(){var a=new qz;Az(a,1,this.j);Az(a,2,this.sessionId);Az(a,3,this.time);wz(a,4,null);yz(a,5,null);tz(a,6,this.h);Bz(a,7,this.f);return a.end()};Nz.prototype.a=function(){var a=new qz;Bz(a,1,this.f);Az(a,2,this.events);return a.end()};Oz.prototype.a=function(){var a=new qz;wz(a,1,this.h);tz(a,2,this.f);return a.end()};Pz.prototype.a=function(){var a=new qz;wz(a,1,this.h);tz(a,2,this.f);return a.end()};Tz.prototype.dispose=function(){var a=this;return _.I(function(b){switch(b.a){case 1:a.h&&(clearInterval(a.h),a.h=null);if(!a.f){b.F(2);break}return _.y(b,a.f,2);case 2:if(!(0<a.a.length)){b.F(4);break}return _.y(b,Rz(a),5);case 5:a.a=[];case 4:a.j=!0,_.B(b)}})};Vz.prototype.a=function(){var a=new qz;tz(a,1,this.previousState);tz(a,2,this.currentState);tz(a,3,this.reason);Az(a,4,null);Az(a,5,null);Az(a,6,null);return a.end()};Vz.prototype.getId=function(){return 5};_.x(Wz,_.Gu);_.t=Wz.prototype;_.t.onPlayerCreated=function(a){this.m=a};
_.t.onContentWillLoad=function(a){var b=a.getConfiguration().sessions;(b=!(!b||typeof b!==_.$e))||this.g.warn("Sessions plugin is loaded but not configured. Will do nothing.");if(this.l=b)b=a.getConfiguration().sessions,b.apiUrl?(this.g.debug(_.xa),this.g.info("Create a session and start sending events."),a=_.ak(),this.h=new Tz(a.browser,a.browserVersion.name,a.os,a.osVersion.name,b.apiUrl),this.f.on(this.m,_.jg,this.Xj.bind(this)),this.f.on(this.m,_.bg,this.Wj.bind(this)),this.f.on(this.m,_.ag,this.Vj.bind(this)),
this.f.on(this.m,_.te,this.T.bind(this)),a=this.m.getNetworkEngine(),a.jf(this.o),a.Nc(this.j),a.j.push(this.j)):(this.g.warn(mz),a.onError(new _.N(1,9,15E3,mz)))};_.t.onPlayerWillRelease=function(){mA(this)};_.t.id=function(){return"sessions"};_.t.Xj=function(a){if(!this.a){a=a.detail;var b=a.currentState,c=new Vz;c.previousState=dA(a.previousState);c.currentState=dA(b);nA(this,c)}};
_.t.Wj=function(){if(!this.a){var a=new Vz;a.previousState=dA(this.m.getState());a.currentState=pA;nA(this,a);this.a=!0}};_.t.Vj=function(){if(this.a){var a=new Vz;a.previousState=pA;a.currentState=dA(this.m.getState());nA(this,a);this.a=!1}};_.t.T=function(a){a=a.detail;var b=new Hz;b=new Fz(new Ez(b.getId(),new Uint8Array(b.a())));b.errorCode=a.code;b.message=a.message;b.f=a.stack;b.severity=a.severity===_.O?qA:rA;nA(this,b)};
_.t.gm=function(a){var b=new Jz;a.downloadId=b;var c=new Dz(lA(a.type,a.contentType),a.uris[0]);c.downloadId=b;c.headers=Object.keys(a.headers).map(function(d){return new Gz(d,a.headers[d])});nA(this,c)};_.t.fm=function(a){var b=a.request.downloadId;b?(b=new Cz(b,a.data.byteLength,Qz(a.timeMs||0),a.status||-1),b.f=Object.keys(a.headers).map(function(c){return new Gz(c,a.headers[c])}),nA(this,b)):this.g.warn("Download ID is missing on download completed event.")};oA.prototype.create=function(){return new Wz};
_.br(new oA);var rA=1,qA=2;var Xz=0,Yz=2,cA=3,pA=5,Zz=6,$z=8,aA=10,bA=11;var eA=0,fA=1,gA=2,hA=3,iA=4,kA=5,jA=9;};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();