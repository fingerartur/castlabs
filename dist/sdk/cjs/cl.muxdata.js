(function(){var g={}; var _ = _ || {}
var f=function(window){var SA=function(a){switch(a.type){case 1:return PA;case 2:return QA;case 3:return RA}},UA=function(a){var b=Object.keys(a).find(function(c){return TA.includes(c.toLowerCase())});return void 0!==b?a[b]:void 0},VA=function(a,b){this.m=a;this.o=this.f=null;this.B=("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6);this.a=new _.Xh;this.g=b;this.A=this.l=this.h=!1;this.w=null;this.j=a.getNetworkEngine();this.G=this.Tj.bind(this);this.D=this.$m.bind(this)},XA=function(a){var b={debug:!0,
data:WA(a)};a.f&&a.f.muxOptionsOverride&&_.M.cd(a.f.muxOptionsOverride)&&(b=_.M.pa(b,a.f.muxOptionsOverride));b=_.M.pa(b,{getPlayheadTime:function(){return 1E3*a.m.getPosition()},getStateData:function(){a.g.debug("getStateData()");var c=a.m.getLoadedSource(),d=a.m.getTrackManager(),e=a.m.getSurface(),f={player_is_paused:a.m.isPaused(),player_is_fullscreen:e.isFullscreen(),video_source_duration:1E3*a.m.getDuration(),player_autoplay_on:!!a.m.getConfiguration().autoplay};if(c){var g=new _.tk(c.url);
f.video_source_url=_.uk(g);f.video_source_mime_type=c.type;c.name&&(f.video_title=c.name)}if(c=e.getContainer())f.player_width=c.offsetWidth,f.player_height=c.offsetHeight;(c=a.m.getSurface().getMedia())?c={videoWidth:c.videoWidth,videoHeight:c.videoHeight}:(c=a.m.getTrackManager().na(),c={videoWidth:c.width,videoHeight:c.height});e=c;c=e.videoWidth;e=e.videoHeight;a.g.debug("Video dimensions: "+c+"x"+e);c&&e&&(f.video_source_height=c,f.video_source_width=e);(d=d.ma())&&d.language&&(f.player_language_code=
d.language);return f}});a.g.debug("Mux SDK options",b);return b},WA=function(a){var b={env_key:a.f.envKey,video_title:a.o&&a.o.name||"",player_name:_.wa,player_software_name:_.wa,player_software_version:_.ja,player_mux_plugin_name:"CastlabsPlayer built-in Mux Plugin",player_mux_plugin_version:_.ja};(a=a.m.getConfiguration().viewerId)&&(b.viewer_user_id=a);return b},YA=function(a){a.a.on(a.m,_.ug,function(){var b={player_playhead_time:1E3*a.m.getPosition()};a.emit(_.ug,b)});a.a.on(a.m,_.of,function(){return a.emit(_.of)});
a.a.on(a.m,_.ld,a.Qj.bind(a));a.a.on(a.m,_.jg,a.Sj.bind(a));a.a.on(a.m,_.Gg,function(){return a.emit(_.bg)});a.a.on(a.m,_.Dg,function(){return a.emit(_.ag)});a.a.on(a.m,_.te,a.Rj.bind(a));a.a.on(a.m,_.zc,function(){return a.emit("adbreakstart")});a.a.on(a.m,_.Ac,function(){return a.emit("adbreakend")});a.a.on(a.m,_.Mc,function(){a.emit("adplay");a.emit("adplaying")});a.a.on(a.m,_.Ic,function(){return a.emit("adpause")});a.a.on(a.m,_.Kc,function(){a.emit("adplay");a.emit("adplaying")});a.a.on(a.m,
_.Nc,function(){return a.emit("adended")});a.a.on(a.m,_.Ec,function(){return a.emit("adfirstquartile")});a.a.on(a.m,_.Hc,function(){return a.emit("admidpoint")});a.a.on(a.m,_.Oc,function(){return a.emit("adthirdquartile")});a.j.Nc(a.G);a.j.jf(a.D);a.a.on(a.m,_.te,function(b){var c=b.detail;if(c&&1===c.category&&(b=(b=c.data)&&b.request,void 0!==b&&!0===(1===b.type||2===b.type||3===b.type)))if(7001===c.code){c=b.requestStartTimestamp;var d=new _.tk(b.uris[b.uriIndex]);b={request_start:c,request_type:SA(b),
request_hostname:d.a};a.g.debug("onRequestCanceled()","Track event: requestcanceled",b);a.emit("requestcanceled",b)}else{d=b.requestStartTimestamp;var e=new _.tk(b.uris[b.uriIndex]),f=c.data;b={request_start:d,request_type:SA(b),request_hostname:e.a,request_error:""+SA(b)+"LoadError",request_error_code:void 0===f?-1:void 0!==f.response?f.response.status:void 0!==f.status?f.status:-1,request_error_text:c.toString()};a.g.debug("onRequestFailed()","Track event: requestfailed",b);a.emit("requestfailed",
b)}})},ZA=function(a){_.$h(a.a);a.j.Yd(a.G);a.j.cg(a.D)},$A=function(){this.f=this.m=null;this.a=!1;this.g=new _.K("clpp.muxdata")},aB=function(a){return!_.M.S(a)&&typeof a.init===_.we&&typeof a.emit===_.we},bB=function(){},PA="manifest",QA="media",RA="encryption",TA=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"];_.t=VA.prototype;_.t.initialize=function(a,b,c){this.f=a;this.o=b;this.w=c;if(!this.h){try{this.h=!0,this.w.init(this.B,XA(this))}catch(d){throw this.h=!1,ZA(this),new _.N(1,9,9302,null,d);}this.emit("playerready")}this.l&&!this.A&&(a=WA(this),this.emit("videochange",a),this.l=!1);YA(this)};_.t.release=function(){this.g.debug("release()");this.l?this.g.debug(_.ma):(ZA(this),this.l=!0,this.o=this.f=null)};_.t.destroy=function(){this.g.debug(_.$d);this.A?this.g.debug(_.la):(this.A=!0,this.emit("destroy"))};
_.t.emit=function(a,b){if(null===this.w)throw new _.N(1,9,9301);this.w.emit(this.B,a,b)};_.t.Qj=function(a){this.g.debug(_.af);var b=a.detail;a=this.m.getTrackManager();b&&b.bandwidth&&(b=b.bandwidth,(a=a.Qa())&&a.bandwidth&&(b+=a.bandwidth),this.emit("renditionchange",{video_source_bitrate:b}))};_.t.Sj=function(a){this.g.debug(_.ef);switch(a.detail.currentState){case _.zp:this.m.getConfiguration().autoplay&&this.emit(_.of);break;case _.Bp:this.emit(_.zf);break;case _.Ap:this.emit(_.kf);break;case _.up:this.emit(_.se)}};
_.t.Rj=function(a){this.g.debug(_.bf);if(this.h&&(a=a.detail||null))if(10003===a.code)this.emit("aderror");else if(a.severity===_.O){var b=a.message||"Player error";if(1===a.category||6100===a.code||6007===a.code)b="Download error",6100===a.code?b="Certificate request error":6007===a.code&&(b="License request error"),b=b+" castlabs-error-data:"+JSON.stringify(a.data);this.emit(_.te,{player_error_code:a.code,player_error_message:b})}};
_.t.Tj=function(a){var b=a.request;if(b=void 0!==b&&!0===(1===b.type||2===b.type||3===b.type))b=a.status,b=void 0!==b&&200<=b&&299>=b;if(b){b=a.request;var c=a.headers,d=b.bytesLoaded,e=b.requestStartTimestamp,f=b.startTime,g=b.endTime,h=e+a.responseStartMs;a=e+a.timeMs;f=f&&g?g-f:void 0;g=new _.tk(b.uris[b.uriIndex]);a={request_start:e,request_type:SA(b),request_hostname:g.a,request_id:UA(c),request_bytes_loaded:d,request_response_start:h,request_response_end:a,request_response_headers:c,request_media_duration:f,
request_url:_.uk(g)};this.g.debug("onRequestCompleted()","Track event: requestcompleted",a);this.emit("requestcompleted",a)}};_.t.$m=function(a){a.requestStartTimestamp=Date.now()};_.x($A,_.Gu);_.t=$A.prototype;_.t.onPlayerCreated=function(a){this.m=a;this.f=new VA(a,this.g)};
_.t.onContentWillLoad=function(a,b){var c=a.getConfiguration();c=_.M.Oa(c.muxdata);try{var d=[];typeof c===_.$e&&(c.envKey||d.push("envKey"));if(0<d.length)throw new _.N(1,9,9300,{missingKeys:d});var e=a.getConfiguration();d=null;if(this.a=!_.M.S(e.muxdata)&&typeof e.muxdata===_.$e){var f=e.muxdata;d=aB(f.muxLib)?f.muxLib:window.mux;if(!aB(d)){this.g.warn("Mux SDK is not loaded. Will do nothing.");this.a=!1;var g=new _.N(1,9,9301);this.T(a,g)}}else this.g.warn("Mux plugin is loaded but not configured. Will do nothing.");
var h=d;null!==h&&this.f.initialize(c,b,h)}catch(l){this.a=!1,this.T(a,l)}};_.t.onContentLoaded=function(){};_.t.onPlayerWillDestroy=function(){this.a&&(this.f.destroy(),this.m=this.f=null)};_.t.onPlayerWillRelease=function(){this.a&&this.f.release()};_.t.id=function(){return"mux"};_.t.emit=function(a,b){try{this.f.emit(a,b)}catch(c){throw null!==this.m&&this.T(this.m,c),c;}};_.t.T=function(a,b){a.trigger(new _.L(_.te,{detail:b}))};_.J("clpp.muxdata.MuxDataPlugin",$A);$A.prototype.emit=$A.prototype.emit;
$A.Id="mux";bB.prototype.create=function(){return new $A};_.br(new bB);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();