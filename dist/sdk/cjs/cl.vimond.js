(function(){var g={}; var _ = _ || {}
var f=function(window){var Kw="Registering listeners",Lw="clpp.vimond.VimondPlugin",Mw=function(a,b,c,d,e){this.G=a;this.H=b;this.I=c;this.m=d;this.D=e;this.a=new _.Xh;this.l=!0;this.f=this.j=this.A=!1;this.B=null;this.h=new _.Zk(this.ih.bind(this));this.g=new _.K("clpp.vimond.VimondDispatcher");this.o=this.w=0;this.m&&this.a&&(this.g.debug(Kw),this.a.on(this.m,_.jg,this.mk.bind(this)),this.a.on(this.m,_.ug,this.nk.bind(this)),this.a.on(this.m,_.zc,this.kk.bind(this)),this.a.on(this.m,_.Ac,this.lk.bind(this)))},Nw=function(a,
b){a.m.trigger(new _.L(_.Pg,{detail:b}))},Ow=function(a,b,c){b&&(a.A=!0,a.h.stop());a.m.onError(new _.N(b?_.O:1,9,9201,c))},Pw=function(a,b,c,d,e){this.l=a;this.o=c;this.h=b;this.a=d;this.j=e;this.g=new _.K("clpp.vimond.VimondService");this.f=0},Qw=function(a){this.m=a;this.a=new _.Xh;this.g=new _.K("clpp.vimond.VimondAdapter");this.f=this.h=!1;this.m&&this.a&&(this.g.debug(Kw),this.a.on(this.m,_.Sf,this.sm.bind(this)),this.a.on(this.m,_.zc,this.ik.bind(this)),this.a.on(this.m,_.Ac,this.jk.bind(this)))},
Rw=function(a,b){var c=a.m.getState();if(1===b)return["str-start",_.zf];if(a.h)return[_.re,_.kf];if(c===_.up)return[_.re,null];if(c===_.yp)return[_.te,_.kf];var d=_.kf;if(c===_.sp||c===_.Bp||a.f)d=_.zf;return["period",d]},Sw=function(){this.a=!1;this.g=new _.K(Lw);this.j=this.h=this.f=null},Tw=function(){};_.t=Mw.prototype;_.t.nk=function(){this.f||(this.f=1<Math.abs(this.w-this.m.getPosition()));this.w=this.m.getPosition()};_.t.kk=function(){this.g.debug("Ad break started");this.j=!0};
_.t.lk=function(){this.g.debug("Ad break stopped");this.j=!1};
_.t.mk=function(a){var b=this,c,d,e,f,g;return _.I(function(h){if(1==h.a){c=a.detail;d=_.wp;e=c.currentState;f=c.previousState;b.g.debug("State changed, prev: "+f+" curr: "+e);if(b.A||b.j)return h["return"]();if(e===b.B&&!b.f)return b.g.debug("Ignore transition"),h["return"]();if(b.l&&e!==d.PLAYING)return h["return"]();if(b.f&&[d.PAUSED,d.BUFFERING].includes(e))return b.g.debug("Seeking"),h["return"]();b.f&&e===d.PLAYING&&(b.g.debug("Seeked"),b.f=!1);g=[d.PLAYING,d.PAUSED,d.ERROR,d.ENDED];if(!g.includes(e))return h.F(0);
b.B=e;return _.y(h,b.ih(),3)}e===d.ENDED&&b.h.stop();_.B(h)})};
_.t.ih=function(){var a=this,b,c,d,e,f,g;return _.I(function(h){if(1==h.a){var l=Math.floor(Date.now()/1E3);0<a.o&&a.g.debug("Last event was "+(l-a.o)+" seconds ago");a.o=l;a.h.stop();a.h.da(a.l?10:a.G);a.l=!1;_.D(h,2);l=a.D;l.f++;var m=_.M.pa(l.o);m.client.buildName=_.wa;m.client.buildVersion=_.ja;var n=m.client,p=l.a.m.getDrmInfo();n.drm=p?p.keySystem:"";m.client.pageUrl=document.location.href;m.client.streamUrl=l.a.m.getLoadedSource().url;m.client.userAgent=navigator.userAgent;m.client.videoFormat=
l.a.m.getLoadedSource().type||"";n=m.client;p=l.a.m.getLoadedSource();p=((new _.tk(p.url)).scheme||"").replace(":","");n.videoProtocol=p;n=Rw(l.a,l.f);m.client.playerEvent=n[0]||"";m.client.playerState=n[1]||"";m.progress.vod&&(m.progress.vod.position=l.a.getPosition());if(n=m.progress.live){p=l.a;var q=p.m.getPresentationStartTime()||0;p=Math.floor(q+p.m.getPosition());p=(new Date(1E3*p)).toISOString();n.position=p;q=l.a;p=q.m.getPosition();q=q.m.getSeekRange().end;n.onLiveEdge=30>Math.abs(q-p);
typeof n.liveResumePossible!==_.md&&(n.liveResumePossible=!0)}m.progress.eventNumber=l.f;m.timestamp=(new Date).toISOString();l.g.debug("Fire an event");n=_.Mj(l.l);n.method=_.Mb;n.contentType="application/json";n.headers.Authorization="Bearer "+l.h;n.body=_.S.jd(JSON.stringify(m));l=l.j.fetch(n).P;return _.y(h,l,4)}if(2!=h.a)return b=h.f,Nw(a,b),_.th(h,0);d=c=_.E(h);e=d.code;f=d.data;g=[1002,1003];g.includes(e)?(a.g.debug("Unreachable service"),Nw(a,f),Ow(a,a.H,f)):1001===e?(a.g.debug("Generic service error"),
Nw(a,f),Ow(a,a.I,f)):a.g.error(c.toString());_.B(h)})};_.t.dispose=function(){this.g.debug(_.kc);_.$h(this.a);this.h.stop()};Pw.prototype.sg=function(a){this.h=a};_.t=Qw.prototype;_.t.getPosition=function(){return Math.floor(this.m.getPosition())};_.t.sm=function(){this.h=!0};_.t.ik=function(){this.f=!0};_.t.jk=function(){this.f=!1};_.t.dispose=function(){this.g.debug(_.kc);_.$h(this.a)};_.x(Sw,_.Gu);_.t=Sw.prototype;_.t.onPlayerCreated=function(){};
_.t.onContentWillLoad=function(a){var b=a.getConfiguration();(this.a=!_.M.S(b.vimond)&&typeof b.vimond===_.$e)?a.namespace()===_.Hd&&(this.a=!1,this.g.info("Vimond does not report when casting.")):this.g.warn("Vimond plugin is loaded but not configured. Will do nothing.");if(this.a){b=a.getConfiguration().vimond;for(var c=_.w(["authToken","playerEventRequest"]),d=c.next();!d.done;d=c.next())if(d=d.value,!b[d]){this.g.warn(d+" key is missing");a.onError(new _.N(1,9,9200));return}this.g.debug(_.xa);
c=b.failIfUnreachable;typeof c!==_.md&&(c=!0);d=b.failOnError;typeof d!==_.md&&(d=!0);this.f=new Qw(a);this.h=new Pw(b.playerEventRequest.uri,b.authToken,b.playerEventRequest.body,this.f,a.getNetworkEngine());this.j=new Mw(b.playerEventRequest.eventInterval,c,d,a,this.h)}};_.t.onPlayerWillRelease=function(){this.a&&(this.f&&this.f.dispose(),this.j&&this.j.dispose(),this.j=this.h=this.f=null)};_.t.onPlayerWillDestroy=function(){};_.t.id=function(){return"vimond"};
_.t.sg=function(a){this.a&&this.h&&this.h.sg(a)};_.J(Lw,Sw);Sw.prototype.updateAuthToken=Sw.prototype.sg;Sw.Id="vimond";Tw.prototype.create=function(){return new Sw};_.br(new Tw);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();