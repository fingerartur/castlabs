import {clpp} from "./cl.core.js";let g={};const _ = clpp._;var f=function(window){'use strict';var UR=function(a){a.a.one(a.m,_.re,()=>TR(a))},TR=function(a){const b=a.m.getSurface().getMedia();if(b)if(a.h){a.a.on(b.textTracks,_.tc,d=>VR(a,d));var c=Array.from(b.textTracks);c.filter(d=>d.kind===_.ye).forEach(d=>{VR(a,{track:d})});!WR(c)&&a.l&&(a.g.warn("The metadata track is not present. Changing an audio track in order to enforce the creation of the metadata track."),YR(a,b))}else a.g.warn("The clpp.ttml.TextParser class is not available. Please register the ttml component first.");
else a.g.warn("A video element is not available. Skipping.")},VR=function(a,b){b=b.track;b.kind===_.ye&&(a.g.info("The metadata track has been added."),b.mode=_.$d,a.a.on(b,_.Cd,c=>ZR(a,c)))},WR=function(a){return a.some(b=>b.kind===_.ye)},YR=function(a,b){const c=a.m.getTrackManager(),d=c.na(),e=c.getAudioTracks().find(g=>g!==d);if(e){var f=()=>c.wa(d);a.a.on(b.textTracks,_.tc,g=>{g.track.kind===_.ye&&(a.a.off(b.textTracks,_.tc,f),c.wa(d))});c.wa(e)}else a.g.warn("Can't enforce the creation of the metadata track if single audio track. Skipping.")},
ZR=function(a,b){const c=$R(a);c&&Array.from(b.target.activeCues||[]).forEach(d=>{if(d!==a.f&&Number.isFinite(d.startTime)&&Number.isFinite(d.endTime)&&"org.id3"===d.type&&d.value&&"TXXX"===d.value.key){var e=new aS(d);if(e.f===c&&null!==e.a){a.f=d;d=a.h.parseMedia(_.si(e.a),{periodStart:a.j,segmentStart:e.startTime,segmentEnd:e.endTime});const f=a.m.getTextDisplayer();f.remove(0,e.startTime);f.append(d.cues,d.styles)}}})},$R=function(a){return(a=a.m.getTrackManager().ua())&&a.language&&a.language.toLowerCase()},
aS=class{constructor(a){this.startTime=a.startTime;this.endTime=a.endTime;this.a=this.f=null;a=a.value;if(!_.A(a)){a:{var b=a.info;if(_.Wg(b)&&(b=b.toLowerCase().match(/lang:(\w+)/))&&b[1]){b=b[1].toLowerCase();break a}b=null}this.f=b;a=a.data;this.a=a=_.Wg(a)?a:null}}};var bS=class{constructor(a,b,c){this.m=a;this.l=b;this.j=c;this.a=new _.ts;this.h=(a=_.hs(_.Dc))?new a(this.m.getConfiguration()):null;this.g=new _.R("clpp.hlssmpte.ImageCueHandler");this.f=null;UR(this)}destroy(){this.a.release();this.f=null;return Promise.resolve()}};var cS=class extends _.Au{constructor(){super();this.a=null;this.f=!1}onPlayerCreated(){}onContentWillLoad(a){if(this.f=_.hk()){var b=a.getConfiguration();b=_.Qg(b.hlssmpte||{});typeof b.patchMetadataTrack!==_.Pc&&(b.patchMetadataTrack=!1);_.Xg(b.timestampOffset)||(b.timestampOffset=0);this.a=new bS(a,b.patchMetadataTrack,b.timestampOffset)}}onPlayerWillDestroy(){const a=this;return _.x(function*(){a.a&&(yield a.a.destroy(),a.a=null)})}id(){return"hlssmpte"}};_.z("clpp.hlssmpte.HlsSmptePlugin",cS);
cS.Id="hlssmpte";_.dp(new class{create(){return new cS}});};f.call(g, window);