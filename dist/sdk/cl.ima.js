import {clpp} from "./cl.core.js";let g={};const _ = clpp._;var f=function(window){'use strict';var tQ="clpp.ima.AdsManagerFactory",uQ=function(a){a=a.I;const b=new google.ima.AdsRenderingSettings;b.restoreCustomPlaybackStateOnAdBreakComplete=!1;typeof a.bitrate===_.t&&(b.bitrate=a.bitrate);b.enablePreloading=typeof a.enablePreloading===_.Pc?a.enablePreloading:!0;typeof a.loadVideoTimeout===_.t&&(b.loadVideoTimeout=a.loadVideoTimeout);Array.isArray(a.mimeTypes)&&(b.mimeTypes=a.mimeTypes);typeof a.playAdsAfterTime===_.t&&(b.playAdsAfterTime=a.playAdsAfterTime);typeof a.useStyledLinearAds===
_.Pc&&(b.useStyledLinearAds=a.useStyledLinearAds);b.uiElements=Array.isArray(a.uiElements)?a.uiElements:[];return b},vQ=function(a){return!1===a.I.disableCustomPlayback&&a.a.isCustomPlaybackUsed()&&_.Xj()},wQ=function(a){const b=a.a,c=a.w,d=google.ima.AdEvent.Type;c.on(b,d.AD_BREAK_READY,a.ea.bind(a));c.on(b,d.LOADED,a.W.bind(a));c.on(b,d.CONTENT_PAUSE_REQUESTED,a.cc.bind(a));c.on(b,d.STARTED,a.Z.bind(a));c.on(b,d.LOG,a.Ma.bind(a));c.on(b,d.AD_PROGRESS,a.Va.bind(a));c.on(b,d.AD_BUFFERING,a.la.bind(a));
c.on(b,d.FIRST_QUARTILE,a.S.bind(a));c.on(b,d.MIDPOINT,a.Na.bind(a));c.on(b,d.THIRD_QUARTILE,a.aa.bind(a));c.on(b,d.PAUSED,a.Oa.bind(a));c.on(b,d.RESUMED,a.lb.bind(a));c.on(b,d.CLICK,a.O.bind(a));c.on(b,d.SKIPPED,a.X.bind(a));c.on(b,d.IMPRESSION,a.T.bind(a));c.on(b,d.COMPLETE,a.Fa.bind(a));c.on(b,d.CONTENT_RESUME_REQUESTED,a.ec.bind(a));c.on(b,d.ALL_ADS_COMPLETED,a.$b.bind(a))},xQ=function(a,b){const c=b?a.ga.create(b.getErrorCode()):null;a.m.onError(new _.H(1,9,10003,{errorType:c},b))},yQ=function(a,
b,c){c=c&&c.getAd();let d=null;c&&(d={ad:new X(c,a.F,a.C)});a.m.trigger(new _.E(b,d))},zQ=function(a){a.B=null;yQ(a,_.rc);a.o&&a.m.getSurface().hide(a.o)},AQ=function(a){_.wo(a.A,{visibility:"visible"})},CQ=function(a){return _.x(function*(){a.N.initialize();const b=!!a.m.getConfiguration().muted;(yield a.K.canPlay(b))||vQ(a)?BQ(a):(yQ(a,_.Mc),a.g.warn(_.ka))})},DQ=function(a,b){return _.x(function*(){a.N.initialize();yield b.play();BQ(a)})},BQ=function(a){a.a.init(a.A.offsetWidth,a.A.offsetHeight,
google.ima.ViewMode.NORMAL);a.a.start();a.H=!0},EQ=function(){return!window.google||!google.ima||!google.ima.AdsLoader},X=class{constructor(a,b,c){this.a=a;this.f=a.getAdPodInfo();this.j=b;this.h=c}yb(){return"Google IMA SDK"}zb(){return google.ima.VERSION}Fb(){return 0}getId(){return this.a.getAdId()}getCreativeId(){return this.a.getCreativeId()}getApiFramework(){return this.a.getApiFramework()}getAdSystem(){return this.a.getAdSystem()}getAdvertiserName(){return this.a.getAdvertiserName()}getTitle(){return this.a.getTitle()}getDuration(){return this.a.getDuration()}getSkipTimeOffset(){return this.a.getSkipTimeOffset()}kc(){return this.f?
this.f.getIsBumper():!1}Qb(){let a=null;const b=this.a,c=Object.keys(b).find(d=>typeof b[d]===_.Fe&&typeof b[d].clickThroughUrl===_.Qf);c&&(a=b[c].clickThroughUrl);return a}getMediaUrl(){return this.a.getMediaUrl()}Cb(){return this.a.getVastMediaWidth()}Bb(){return this.a.getVastMediaHeight()}qb(){return this.a.getVastMediaBitrate()}eb(){return this.h?2:this.j?1:0}getPodIndex(){return this.f?this.f.getPodIndex():0}Rb(){return this.f?this.f.getTimeOffset():0}Sb(){return this.f?this.f.getAdPosition():
1}Eb(){return this.f?this.f.getTotalAds():1}getWrapperAdIds(){return this.a.getWrapperAdIds()}getWrapperAdSystems(){return this.a.getWrapperAdSystems()}getWrapperCreativeIds(){return this.a.getWrapperCreativeIds()}};X.prototype.getWrapperCreativeIds=X.prototype.getWrapperCreativeIds;X.prototype.getWrapperAdSystems=X.prototype.getWrapperAdSystems;X.prototype.getWrapperAdIds=X.prototype.getWrapperAdIds;X.prototype.getSequenceLength=X.prototype.Eb;X.prototype.getPositionInSequence=X.prototype.Sb;
X.prototype.getPodTimeOffset=X.prototype.Rb;X.prototype.getPodIndex=X.prototype.getPodIndex;X.prototype.getPodType=X.prototype.eb;X.prototype.getMediaBitrate=X.prototype.qb;X.prototype.getMediaHeight=X.prototype.Bb;X.prototype.getMediaWidth=X.prototype.Cb;X.prototype.getMediaUrl=X.prototype.getMediaUrl;X.prototype.getClickThroughUrl=X.prototype.Qb;X.prototype.isBumper=X.prototype.kc;X.prototype.getSkipTimeOffset=X.prototype.getSkipTimeOffset;X.prototype.getDuration=X.prototype.getDuration;
X.prototype.getTitle=X.prototype.getTitle;X.prototype.getAdvertiserName=X.prototype.getAdvertiserName;X.prototype.getAdSystem=X.prototype.getAdSystem;X.prototype.getApiFramework=X.prototype.getApiFramework;X.prototype.getCreativeId=X.prototype.getCreativeId;X.prototype.getId=X.prototype.getId;X.prototype.getTechnology=X.prototype.Fb;X.prototype.getAdManagerVersion=X.prototype.zb;X.prototype.getAdManagerName=X.prototype.yb;var FQ=class{create(a){const b=google.ima.AdError.ErrorCode;switch(a){case b.VAST_LOAD_TIMEOUT:case b.VAST_MEDIA_LOAD_TIMEOUT:case b.FAILED_TO_REQUEST_ADS:return 0;case b.VIDEO_PLAY_ERROR:return 1;default:return 2}}};var GQ=class{constructor(a){this.a=a}getCuePoints(){return this.a}Tb(){return 0<=this.a.indexOf(0)||0===this.a.length}sb(){return 0<=this.a.indexOf(-1)}};GQ.prototype.hasPostroll=GQ.prototype.sb;GQ.prototype.hasPreroll=GQ.prototype.Tb;GQ.prototype.getCuePoints=GQ.prototype.getCuePoints;var HQ=class{constructor(a){this.m=a;this.A=a.getSurface().getMedia();a=this.m.getConfiguration();a=_.Qg(a.ima||{});this.I=a=_.Pg({disableCustomPlayback:!1},a);this.o=this.m.gc("ima").Ac();this.N=this.m.gc("ima").h;this.l=this.m.gc("ima").a;this.K=new _.qu;this.g=new _.R("clpp.ima");this.h=this.a=null;this.f=new _.dn;this.H=!1;this.w=new _.ts;this.ga=new FQ;this.B=null;this.L=this.G=this.C=this.F=!1;this.J=this.j=null;{a=this.w;const b=google.ima.AdErrorEvent.Type.AD_ERROR;a.one(this.l,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
this.Ob.bind(this));a.on(this.l,b,this.mb.bind(this));a.on(this.m,_.Vd,this.bc.bind(this))}}Ob(a){this.a=a.getAdsManager(this.A,uQ(this));this.a.isCustomPlaybackUsed()&&!vQ(this)?(this.g.warn("IMA plugin is disabled for this platform with single video element. Disposing."),this.m.onError(new _.H(1,9,10002)),this.dispose()):(this.h=new _.ou(this.m.getSurface(),(b,c,d)=>{this.a.resize(b,c,d?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),a=this.a.getCuePoints(),this.j=new GQ(a),this.m.trigger(new _.E(_.uc,
{adsTimeline:this.j})),wQ(this));this.f.resolve()}mb(a){xQ(this,a.getError());this.f.resolve()}cc(a){const b=this;return _.x(function*(){b.G=!0;if(vQ(b)){b.J=b.m.getPosition();yield b.m.detach();var c=b.m;c.a&&c.a.stopForwardingEventsTo(c)}else yield b.m.pause(),_.wo(b.A,{visibility:_.$d});yQ(b,_.cc,a);b.h.start()})}ea(){const a=this;return _.x(function*(){a.a.start()})}W(a){a.getAd().isLinear()?yQ(this,_.jc,a):(this.a.discardAdBreak(),this.F||(this.F=!0,this.m.play()))}Z(a){this.B=a.getAd().getDuration();
yQ(this,_.qc,a);this.m.getSurface().show(this.o)}Ma(a){a=a.getAdData();xQ(this,a?a.adError:null);zQ(this)}Va(a){yQ(this,_.nc,a)}la(a){yQ(this,_.ec,a)}S(a){yQ(this,_.hc,a)}Na(a){yQ(this,_.lc,a)}aa(a){yQ(this,_.sc,a)}Oa(a){yQ(this,_.mc,a)}lb(a){yQ(this,_.oc,a)}O(a){this.pause();yQ(this,_.fc,a)}X(a){yQ(this,_.pc,a);zQ(this)}T(a){yQ(this,_.ic,a)}Fa(a){yQ(this,_.gc,a);zQ(this)}ec(){const a=this;return _.x(function*(){a.F=!0;if(vQ(a)&&null!==a.J){var b=a.m;b.a&&b.a.forwardEventsTo(b);yield _.tp(a.m);a.C||
(yield a.m.seek(a.J))}else{if(!a.G)return a.m.play();AQ(a)}a.G=!1;a.h&&a.h.stop();a.C||(yield a.m.play());yQ(a,_.dc)})}$b(){this.L=!0}bc(){this.C=!0;this.l.contentComplete()}load(){const a=this;return _.x(function*(){var b=a.m;const c=a.I;try{if(typeof c.adTagUrl!==_.Qf)throw new _.H(1,9,10001,{missingKeys:"adTagUrl"});}catch(f){return b.onError(f),a.f.resolve(),a.f}if(!c.adTagUrl)return a.f.resolve(),a.f;b=yield a.K.canPlay(!1);const d=yield a.K.canPlay(!0),e=new google.ima.AdsRequest;e.adTagUrl=
c.adTagUrl;e.setAdWillAutoPlay(b);e.setAdWillPlayMuted(d);a.l.getSettings().setAutoPlayAdBreaks(!1);a.l.requestAds(e);return a.f})}start(a){const b=this;return _.x(function*(){b.a&&b.j&&!b.H?b.j.Tb()?yield CQ(b):yield DQ(b,a):yield a.play()})}resume(){this.a&&this.a.resume()}pause(){this.a&&this.a.pause()}skip(){this.a&&this.a.skip()}getVolume(){return this.a?this.a.getVolume():1}setVolume(a){this.a&&this.a.setVolume(a)}getPosition(){if(!this.a||null===this.B)return-1;const a=this.a.getRemainingTime();
return 0>a?0:this.B-a}dispose(){return(new Promise(a=>{this.H&&this.j&&this.j.sb()&&!this.L?(this.w.one(this.a,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,()=>{a();this.o&&this.m.getSurface().hide(this.o)}),_.qh(this.w,this.a,[google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.STARTED],()=>{this.a&&this.a.discardAdBreak()})):a();this.a.discardAdBreak();this.l.contentComplete()})).then(()=>{AQ(this);this.w.release();this.h&&(this.h.stop(),this.h=null);this.a&&(this.a.destroy(),this.a=null)})}};
HQ.prototype.getPosition=HQ.prototype.getPosition;HQ.prototype.setVolume=HQ.prototype.setVolume;HQ.prototype.getVolume=HQ.prototype.getVolume;HQ.prototype.skip=HQ.prototype.skip;HQ.prototype.pause=HQ.prototype.pause;HQ.prototype.resume=HQ.prototype.resume;var IQ=class extends _.Au{constructor(){super();this.a=this.h=this.f=null}onPlayerCreated(a){if(EQ())return a.onError(new _.H(1,9,1E4));this.f=_.uo(_.Gd,{"class":"clpp-ima clpp-hidden"});a.getSurface().addElementToContainer(this.f);this.h=new google.ima.AdDisplayContainer(this.f,a.getSurface().getMedia());this.a=new google.ima.AdsLoader(this.h);this.a.getSettings().setPlayerType(_.ra);this.a.getSettings().setPlayerVersion(_.fa);this.a.getSettings().setAutoPlayAdBreaks(!0)}onPlayerWillDestroy(a){this.a&&
(this.a.destroy(),this.a=null);this.h&&(this.h.destroy(),this.h=null);this.f&&(a.getSurface().removeElementFromContainer(this.f),this.f=null)}zg(){return this.a}xg(){return this.h}Ac(){return this.f}id(){return"ima"}};_.z("clpp.ima.ImaPlugin",IQ);IQ.prototype.getAdContainer=IQ.prototype.Ac;IQ.prototype.getAdDisplayContainer=IQ.prototype.xg;IQ.prototype.getAdsLoader=IQ.prototype.zg;IQ.Id="ima";IQ.isSdkMissing=EQ;_.dp(new class{create(){return new IQ}});var JQ=class{constructor(){this.a=new _.R(tQ)}name(){return tQ}isSupported(a,b){return a.namespace()===_.kd?!1:EQ()?(this.a.warn("IMA SDK is not loaded."),!1):!(!b||!b.ima)}create(a){return new HQ(a)}};JQ.prototype.create=JQ.prototype.create;JQ.prototype.isSupported=JQ.prototype.isSupported;JQ.prototype.name=JQ.prototype.name;_.ro(new JQ);};f.call(g, window);